"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={exports:{}};!function(e,t){var r,n=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e={}){var t,n,s=e;s.ready=new Promise(((e,r)=>{t=e,n=r}));var a=Object.assign({},s),o=(e,t)=>{throw t},_="";"undefined"!=typeof document&&document.currentScript&&(_=document.currentScript.src),r&&(_=r),_=0!==_.indexOf("blob:")?_.substr(0,_.replace(/[?#].*/,"").lastIndexOf("/")+1):"";var i,c=s.print||console.log.bind(console),u=s.printErr||console.error.bind(console);Object.assign(s,a),a=null,s.quit&&(o=s.quit),s.wasmBinary&&(i=s.wasmBinary),"object"!=typeof WebAssembly&&x("no native wasm support detected");var f,l,d,h,v,w,b,m=!1;function p(){var e=f.buffer;s.HEAP8=d=new Int8Array(e),s.HEAP16=v=new Int16Array(e),s.HEAPU8=h=new Uint8Array(e),s.HEAPU16=new Uint16Array(e),s.HEAP32=w=new Int32Array(e),s.HEAPU32=b=new Uint32Array(e),s.HEAPF32=new Float32Array(e),s.HEAPF64=new Float64Array(e)}var y=[],E=[],P=[];function g(){var e=s.preRun.shift();y.unshift(e)}var I=0,A=null;function x(e){throw s.onAbort?.(e),u(e="Aborted("+e+")"),m=!0,l=1,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),n(e),e}var C,T,N,R=e=>e.startsWith("data:application/octet-stream;base64,");if(!R(C="libratchet.browser.wasm")){var S=C;C=s.locateFile?s.locateFile(S,_):_+S}function k(e){if(e==C&&i)return new Uint8Array(i);throw"both async and sync fetching of the wasm failed"}function F(e,t,r){return function(e){return i||"function"!=typeof fetch?Promise.resolve().then((()=>k(e))):fetch(e,{credentials:"same-origin"}).then((t=>{if(!t.ok)throw"failed to load wasm binary file at '"+e+"'";return t.arrayBuffer()})).catch((()=>k(e)))}(e).then((e=>WebAssembly.instantiate(e,t))).then((e=>e)).then(r,(e=>{u(`failed to asynchronously prepare wasm: ${e}`),x(e)}))}function L(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var K,D=e=>{for(;0<e.length;)e.shift()(s)},O=s.noExitRuntime||!0,B=(e,t)=>{for(var r=0,n=e.length-1;0<=n;n--){var s=e[n];"."===s?e.splice(n,1):".."===s?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},M=e=>{var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=B(e.split("/").filter((e=>!!e)),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},U=e=>{var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&=t.substr(0,t.length-1),e+t):"."},Y=e=>{if("/"===e)return"/";var t=(e=(e=M(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},H=e=>(H=(()=>{if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues)return e=>crypto.getRandomValues(e);x("initRandomDevice")})())(e);function z(){for(var e="",t=!1,r=arguments.length-1;-1<=r&&!t;r--){if("string"!=typeof(t=0<=r?arguments[r]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t="/"===t.charAt(0)}return(t?"/":"")+(e=B(e.split("/").filter((e=>!!e)),!t).join("/"))||"."}var G="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,$=(e,t)=>{for(var r=t+NaN,n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.buffer&&G)return G.decode(e.subarray(t,n));for(r="";t<n;){var s=e[t++];if(128&s){var a=63&e[t++];if(192==(224&s))r+=String.fromCharCode((31&s)<<6|a);else{var o=63&e[t++];65536>(s=224==(240&s)?(15&s)<<12|a<<6|o:(7&s)<<18|a<<12|o<<6|63&e[t++])?r+=String.fromCharCode(s):(s-=65536,r+=String.fromCharCode(55296|s>>10,56320|1023&s))}}else r+=String.fromCharCode(s)}return r},q=[],V=[];function Z(e,t){V[e]={input:[],qb:[],ub:t},Ee(e,j)}var j={open(e){var t=V[e.node.Fb];if(!t)throw new _e(43);e.ob=t,e.seekable=!1},close(e){e.ob.ub.Bb(e.ob)},Bb(e){e.ob.ub.Bb(e.ob)},read(e,t,r,n){if(!e.ob||!e.ob.ub.Ob)throw new _e(60);for(var s=0,a=0;a<n;a++){try{var o=e.ob.ub.Ob(e.ob)}catch(e){throw new _e(29)}if(void 0===o&&0===s)throw new _e(6);if(null==o)break;s++,t[r+a]=o}return s&&(e.node.timestamp=Date.now()),s},write(e,t,r,n){if(!e.ob||!e.ob.ub.Ib)throw new _e(60);try{for(var s=0;s<n;s++)e.ob.ub.Ib(e.ob,t[r+s])}catch(e){throw new _e(29)}return n&&(e.node.timestamp=Date.now()),s}},W={Ob(){e:{if(!q.length){var e=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(e=window.prompt("Input: "))&&(e+="\n"):"function"==typeof readline&&null!==(e=readline())&&(e+="\n"),!e){var t=null;break e}for(var r=t=0;r<e.length;++r){var n=e.charCodeAt(r);127>=n?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3}var s=(t=Array(t+1)).length;if(r=0,0<s){n=r,s=r+s-1;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),127>=o){if(r>=s)break;t[r++]=o}else{if(2047>=o){if(r+1>=s)break;t[r++]=192|o>>6}else{if(65535>=o){if(r+2>=s)break;t[r++]=224|o>>12}else{if(r+3>=s)break;t[r++]=240|o>>18,t[r++]=128|o>>12&63}t[r++]=128|o>>6&63}t[r++]=128|63&o}}t[r]=0,e=r-n}else e=0;t.length=e,q=t}t=q.shift()}return t},Ib(e,t){null===t||10===t?(c($(e.qb,0)),e.qb=[]):0!=t&&e.qb.push(t)},Bb(e){e.qb&&0<e.qb.length&&(c($(e.qb,0)),e.qb=[])},Yb:()=>({kc:25856,mc:5,jc:191,lc:35387,ic:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),Zb:()=>0,$b:()=>[24,80]},X={Ib(e,t){null===t||10===t?(u($(e.qb,0)),e.qb=[]):0!=t&&e.qb.push(t)},Bb(e){e.qb&&0<e.qb.length&&(u($(e.qb,0)),e.qb=[])}};function Q(e,t){var r=e.mb?e.mb.length:0;r>=t||(t=Math.max(t,r*(1048576>r?2:1.125)>>>0),0!=r&&(t=Math.max(t,256)),r=e.mb,e.mb=new Uint8Array(t),0<e.pb&&e.mb.set(r.subarray(0,e.pb),0))}var J={rb:null,tb:()=>J.createNode(null,"/",16895,0),createNode(e,t,r,n){if(24576==(61440&r)||4096==(61440&r))throw new _e(63);return J.rb||(J.rb={dir:{node:{wb:J.lb.wb,sb:J.lb.sb,zb:J.lb.zb,Db:J.lb.Db,Tb:J.lb.Tb,Vb:J.lb.Vb,Ub:J.lb.Ub,Sb:J.lb.Sb,Gb:J.lb.Gb},stream:{yb:J.nb.yb}},file:{node:{wb:J.lb.wb,sb:J.lb.sb},stream:{yb:J.nb.yb,read:J.nb.read,write:J.nb.write,Kb:J.nb.Kb,Pb:J.nb.Pb,Rb:J.nb.Rb}},link:{node:{wb:J.lb.wb,sb:J.lb.sb,Ab:J.lb.Ab},stream:{}},Lb:{node:{wb:J.lb.wb,sb:J.lb.sb},stream:ye}}),16384==(61440&(r=de(e,t,r,n)).mode)?(r.lb=J.rb.dir.node,r.nb=J.rb.dir.stream,r.mb={}):32768==(61440&r.mode)?(r.lb=J.rb.file.node,r.nb=J.rb.file.stream,r.pb=0,r.mb=null):40960==(61440&r.mode)?(r.lb=J.rb.link.node,r.nb=J.rb.link.stream):8192==(61440&r.mode)&&(r.lb=J.rb.Lb.node,r.nb=J.rb.Lb.stream),r.timestamp=Date.now(),e&&(e.mb[t]=r,e.timestamp=r.timestamp),r},pc:e=>e.mb?e.mb.subarray?e.mb.subarray(0,e.pb):new Uint8Array(e.mb):new Uint8Array(0),lb:{wb(e){var t={};return t.oc=8192==(61440&e.mode)?e.id:1,t.rc=e.id,t.mode=e.mode,t.tc=1,t.uid=0,t.qc=0,t.Fb=e.Fb,16384==(61440&e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.pb:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.fc=new Date(e.timestamp),t.sc=new Date(e.timestamp),t.nc=new Date(e.timestamp),t.Wb=4096,t.hc=Math.ceil(t.size/t.Wb),t},sb(e,t){if(void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&(t=t.size,e.pb!=t))if(0==t)e.mb=null,e.pb=0;else{var r=e.mb;e.mb=new Uint8Array(t),r&&e.mb.set(r.subarray(0,Math.min(t,e.pb))),e.pb=t}},zb(){throw ie[44]},Db:(e,t,r,n)=>J.createNode(e,t,r,n),Tb(e,t,r){if(16384==(61440&e.mode)){try{var n=le(t,r)}catch(e){}if(n)for(var s in n.mb)throw new _e(55)}delete e.parent.mb[e.name],e.parent.timestamp=Date.now(),e.name=r,t.mb[r]=e,t.timestamp=e.parent.timestamp,e.parent=t},Vb(e,t){delete e.mb[t],e.timestamp=Date.now()},Ub(e,t){var r,n=le(e,t);for(r in n.mb)throw new _e(55);delete e.mb[t],e.timestamp=Date.now()},Sb(e){var t,r=[".",".."];for(t of Object.keys(e.mb))r.push(t);return r},Gb:(e,t,r)=>((e=J.createNode(e,t,41471,0)).link=r,e),Ab(e){if(40960!=(61440&e.mode))throw new _e(28);return e.link}},nb:{read(e,t,r,n,s){var a=e.node.mb;if(s>=e.node.pb)return 0;if(8<(e=Math.min(e.node.pb-s,n))&&a.subarray)t.set(a.subarray(s,s+e),r);else for(n=0;n<e;n++)t[r+n]=a[s+n];return e},write(e,t,r,n,s,a){if(t.buffer===d.buffer&&(a=!1),!n)return 0;if((e=e.node).timestamp=Date.now(),t.subarray&&(!e.mb||e.mb.subarray)){if(a)return e.mb=t.subarray(r,r+n),e.pb=n;if(0===e.pb&&0===s)return e.mb=t.slice(r,r+n),e.pb=n;if(s+n<=e.pb)return e.mb.set(t.subarray(r,r+n),s),n}if(Q(e,s+n),e.mb.subarray&&t.subarray)e.mb.set(t.subarray(r,r+n),s);else for(a=0;a<n;a++)e.mb[s+a]=t[r+a];return e.pb=Math.max(e.pb,s+n),n},yb(e,t,r){if(1===r?t+=e.position:2===r&&32768==(61440&e.node.mode)&&(t+=e.node.pb),0>t)throw new _e(28);return t},Kb(e,t,r){Q(e.node,t+r),e.node.pb=Math.max(e.node.pb,t+r)},Pb(e,t,r,n,s){if(32768!=(61440&e.node.mode))throw new _e(43);if(e=e.node.mb,2&s||e.buffer!==d.buffer){if((0<r||r+t<e.length)&&(e=e.subarray?e.subarray(r,r+t):Array.prototype.slice.call(e,r,r+t)),r=!0,x(),!(t=void 0))throw new _e(48);d.set(e,t)}else r=!1,t=e.byteOffset;return{vc:t,ec:r}},Rb:(e,t,r,n)=>(J.nb.write(e,t,0,n,r,!1),0)}},ee=(e,t)=>{var r=0;return e&&(r|=365),t&&(r|=146),r},te=null,re={},ne=[],se=1,ae=null,oe=!0,_e=null,ie={};function ce(e,t={}){if(!(e=z(e)))return{path:"",node:null};if(8<(t=Object.assign({Nb:!0,Jb:0},t)).Jb)throw new _e(32);e=e.split("/").filter((e=>!!e));for(var r=te,n="/",s=0;s<e.length;s++){var a=s===e.length-1;if(a&&t.parent)break;if(r=le(r,e[s]),n=M(n+"/"+e[s]),r.Eb&&(!a||a&&t.Nb)&&(r=r.Eb.root),!a||t.Mb)for(a=0;40960==(61440&r.mode);)if(r=Ce(n),r=ce(n=z(U(n),r),{Jb:t.Jb+1}).node,40<a++)throw new _e(32)}return{path:n,node:r}}function ue(e){for(var t;;){if(e===e.parent)return e=e.tb.Qb,t?"/"!==e[e.length-1]?`${e}/${t}`:e+t:e;t=t?`${e.name}/${t}`:e.name,e=e.parent}}function fe(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%ae.length}function le(e,t){var r;if(r=(r=ve(e,"x"))?r:e.lb.zb?0:2)throw new _e(r,e);for(r=ae[fe(e.id,t)];r;r=r.bc){var n=r.name;if(r.parent.id===e.id&&n===t)return r}return e.lb.zb(e,t)}function de(e,t,r,n){return t=fe((e=new He(e,t,r,n)).parent.id,e.name),e.bc=ae[t],ae[t]=e}function he(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t}function ve(e,t){return oe?0:!t.includes("r")||292&e.mode?t.includes("w")&&!(146&e.mode)||t.includes("x")&&!(73&e.mode)?2:0:2}function we(e,t){try{return le(e,t),20}catch(e){}return ve(e,"wx")}function be(e){if(!(e=ne[e]))throw new _e(8);return e}function me(e,t=-1){return Fe||((Fe=function(){this.Cb={}}).prototype={},Object.defineProperties(Fe.prototype,{object:{get(){return this.node},set(e){this.node=e}},flags:{get(){return this.Cb.flags},set(e){this.Cb.flags=e}},position:{get(){return this.Cb.position},set(e){this.Cb.position=e}}})),e=Object.assign(new Fe,e),-1==t&&(t=function(){for(var e=0;4096>=e;e++)if(!ne[e])return e;throw new _e(33)}()),e.vb=t,ne[t]=e}var pe,ye={open(e){e.nb=re[e.node.Fb].nb,e.nb.open?.(e)},yb(){throw new _e(70)}};function Ee(e,t){re[e]={nb:t}}function Pe(e,t){var r="/"===t,n=!t;if(r&&te)throw new _e(10);if(!r&&!n){var s=ce(t,{Nb:!1});if(t=s.path,(s=s.node).Eb)throw new _e(10);if(16384!=(61440&s.mode))throw new _e(54)}t={type:e,uc:{},Qb:t,ac:[]},(e=e.tb(t)).tb=t,t.root=e,r?te=e:s&&(s.Eb=t,s.tb&&s.tb.ac.push(t))}function ge(e,t,r){var n=ce(e,{parent:!0}).node;if(!(e=Y(e))||"."===e||".."===e)throw new _e(28);var s=we(n,e);if(s)throw new _e(s);if(!n.lb.Db)throw new _e(63);return n.lb.Db(n,e,t,r)}function Ie(e){return ge(e,16895,0)}function Ae(e,t,r){void 0===r&&(r=t,t=438),ge(e,8192|t,r)}function xe(e,t){if(!z(e))throw new _e(44);var r=ce(t,{parent:!0}).node;if(!r)throw new _e(44);var n=we(r,t=Y(t));if(n)throw new _e(n);if(!r.lb.Gb)throw new _e(63);r.lb.Gb(r,t,e)}function Ce(e){if(!(e=ce(e).node))throw new _e(44);if(!e.lb.Ab)throw new _e(28);return z(ue(e.parent),e.lb.Ab(e))}function Te(e,t,r){if(""===e)throw new _e(44);if("string"==typeof t){var n={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[t];if(void 0===n)throw Error(`Unknown file open mode: ${t}`);t=n}if(r=64&t?4095&(void 0===r?438:r)|32768:0,"object"==typeof e)var a=e;else{e=M(e);try{a=ce(e,{Mb:!(131072&t)}).node}catch(e){}}if(n=!1,64&t)if(a){if(128&t)throw new _e(20)}else a=ge(e,r,0),n=!0;if(!a)throw new _e(44);if(8192==(61440&a.mode)&&(t&=-513),65536&t&&16384!=(61440&a.mode))throw new _e(54);if(!n&&(r=a?40960==(61440&a.mode)?32:16384==(61440&a.mode)&&("r"!==he(t)||512&t)?31:ve(a,he(t)):44))throw new _e(r);if(512&t&&!n){if(!(r="string"==typeof(r=a)?ce(r,{Mb:!0}).node:r).lb.sb)throw new _e(63);if(16384==(61440&r.mode))throw new _e(31);if(32768!=(61440&r.mode))throw new _e(28);if(n=ve(r,"w"))throw new _e(n);r.lb.sb(r,{size:0,timestamp:Date.now()})}return t&=-131713,(a=me({node:a,path:ue(a),flags:t,seekable:!0,position:0,nb:a.nb,dc:[],error:!1})).nb.open&&a.nb.open(a),!s.logReadFiles||1&t||(Le||={},e in Le||(Le[e]=1)),a}function Ne(e,t,r){if(null===e.vb)throw new _e(8);if(!e.seekable||!e.nb.yb)throw new _e(70);if(0!=r&&1!=r&&2!=r)throw new _e(28);e.position=e.nb.yb(e,t,r),e.dc=[]}function Re(){_e||((_e=function(e,t){this.name="ErrnoError",this.node=t,this.cc=function(e){this.xb=e},this.cc(e),this.message="FS error"}).prototype=Error(),_e.prototype.constructor=_e,[44].forEach((e=>{ie[e]=new _e(e),ie[e].stack="<generic error, no stack>"})))}function Se(e,t,r){e=M("/dev/"+e);var n=ee(!!t,!!r);ke||=64;var s=ke++<<8|0;Ee(s,{open(e){e.seekable=!1},close(){r?.buffer?.length&&r(10)},read(e,r,n,s){for(var a=0,o=0;o<s;o++){try{var _=t()}catch(e){throw new _e(29)}if(void 0===_&&0===a)throw new _e(6);if(null==_)break;a++,r[n+o]=_}return a&&(e.node.timestamp=Date.now()),a},write(e,t,n,s){for(var a=0;a<s;a++)try{r(t[n+a])}catch(e){throw new _e(29)}return s&&(e.node.timestamp=Date.now()),a}}),Ae(e,n,s)}var ke,Fe,Le,Ke={},De=void 0;function Oe(){var e=w[+De>>2];return De+=4,e}var Be,Me={},Ue=0,Ye=e=>{l=e,O||0<Ue||(s.onExit?.(e),m=!0),o(e,new L(e))};function He(e,t,r,n){e||=this,this.parent=e,this.tb=e.tb,this.Eb=null,this.id=se++,this.name=t,this.mode=r,this.lb={},this.nb={},this.Fb=n}Be=()=>performance.now(),Object.defineProperties(He.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}}}),Re(),ae=Array(4096),Pe(J,"/"),Ie("/tmp"),Ie("/home"),Ie("/home/web_user"),function(){Ie("/dev"),Ee(259,{read:()=>0,write:(e,t,r,n)=>n}),Ae("/dev/null",259),Z(1280,W),Z(1536,X),Ae("/dev/tty",1280),Ae("/dev/tty1",1536);var e=new Uint8Array(1024),t=0,r=()=>(0===t&&(t=H(e).byteLength),e[--t]);Se("random",r),Se("urandom",r),Ie("/dev/shm"),Ie("/dev/shm/tmp")}(),function(){Ie("/proc");var e=Ie("/proc/self");Ie("/proc/self/fd"),Pe({tb(){var t=de(e,"fd",16895,73);return t.lb={zb(e,t){var r=be(+t);return(e={parent:null,tb:{Qb:"fake"},lb:{Ab:()=>r.path}}).parent=e}},t}},"/proc/self/fd")}();var ze={f:(e,t)=>K.get(e)(t),c:function(e,t,r){De=r;try{var n=be(e);switch(t){case 0:var s=Oe();if(0>s)return-28;for(;ne[s];)s++;return me(n,s).vb;case 1:case 2:case 6:case 7:return 0;case 3:return n.flags;case 4:return s=Oe(),n.flags|=s,0;case 5:return s=Oe(),v[s+0>>1]=2,0;case 16:case 8:default:return-28;case 9:return w[qe()>>2]=28,-1}}catch(e){if(void 0===Ke||"ErrnoError"!==e.name)throw e;return-e.xb}},n:function(e,t,r){De=r;try{var n=be(e);switch(t){case 21509:case 21510:case 21511:case 21512:case 21524:case 21515:return n.ob?0:-59;case 21505:if(!n.ob)return-59;if(n.ob.ub.Yb){t=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var s=Oe();w[s>>2]=25856,w[s+4>>2]=5,w[s+8>>2]=191,w[s+12>>2]=35387;for(var a=0;32>a;a++)d[s+a+17>>0]=t[a]||0}return 0;case 21506:case 21507:case 21508:if(!n.ob)return-59;if(n.ob.ub.Zb)for(s=Oe(),t=[],a=0;32>a;a++)t.push(d[s+a+17>>0]);return 0;case 21519:return n.ob?(s=Oe(),w[s>>2]=0):-59;case 21520:return n.ob?-28:-59;case 21531:if(s=Oe(),!n.nb.Xb)throw new _e(59);return n.nb.Xb(n,t,s);case 21523:return n.ob?(n.ob.ub.$b&&(a=[24,80],s=Oe(),v[s>>1]=a[0],v[s+2>>1]=a[1]),0):-59;default:return-28}}catch(e){if(void 0===Ke||"ErrnoError"!==e.name)throw e;return-e.xb}},e:function(e,t,r,n){De=n;try{var s=t=t?$(h,t):"";if("/"===s.charAt(0))t=s;else{var a=-100===e?"/":be(e).path;if(0==s.length)throw new _e(44);t=M(a+"/"+s)}return Te(t,r,n?Oe():0).vb}catch(e){if(void 0===Ke||"ErrnoError"!==e.name)throw e;return-e.xb}},h:()=>{O=!1,Ue=0},i:(e,t)=>{if(Me[e]&&(clearTimeout(Me[e].id),delete Me[e]),!t)return 0;var r=setTimeout((()=>{delete Me[e],(e=>{if(!m)try{if(e(),!(O||0<Ue))try{l=e=l,Ye(e)}catch(e){e instanceof L||"unwind"==e||o(1,e)}}catch(e){e instanceof L||"unwind"==e||o(1,e)}})((()=>Ve(e,Be())))}),t);return Me[e]={id:r,wc:t},0},a:()=>{x("")},j:()=>Date.now(),o:(e,t,r)=>h.copyWithin(e,t,t+r),k:e=>{var t=h.length;if(2147483648<(e>>>=0))return!1;for(var r=1;4>=r;r*=2){var n=t*(1+.2/r);n=Math.min(n,e+100663296);var s=Math;n=Math.max(e,n);e:{s=(s.min.call(s,2147483648,n+(65536-n%65536)%65536)-f.buffer.byteLength+65535)/65536;try{f.grow(s),p();var a=1;break e}catch(e){}a=void 0}if(a)return!0}return!1},b:function(e){try{var t=be(e);if(null===t.vb)throw new _e(8);t.Hb&&(t.Hb=null);try{t.nb.close&&t.nb.close(t)}catch(e){throw e}finally{ne[t.vb]=null}return t.vb=null,0}catch(e){if(void 0===Ke||"ErrnoError"!==e.name)throw e;return e.xb}},m:function(e,t,r,n){try{e:{var s=be(e);e=t;for(var a,o=t=0;o<r;o++){var _=b[e>>2],i=b[e+4>>2];e+=8;var c=s,u=_,f=i,l=a,h=d;if(0>f||0>l)throw new _e(28);if(null===c.vb)throw new _e(8);if(1==(2097155&c.flags))throw new _e(8);if(16384==(61440&c.node.mode))throw new _e(31);if(!c.nb.read)throw new _e(28);var v=void 0!==l;if(v){if(!c.seekable)throw new _e(70)}else l=c.position;var w=c.nb.read(c,h,u,f,l);v||(c.position+=w);var m=w;if(0>m){var p=-1;break e}if(t+=m,m<i)break;void 0!==a&&(a+=m)}p=t}return b[n>>2]=p,0}catch(e){if(void 0===Ke||"ErrnoError"!==e.name)throw e;return e.xb}},l:function(e,t,r,n,s){t=r+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*r:NaN;try{if(isNaN(t))return 61;var a=be(e);return Ne(a,t,n),N=[a.position>>>0,(T=a.position,1<=+Math.abs(T)?0<T?+Math.floor(T/4294967296)>>>0:~~+Math.ceil((T-+(~~T>>>0))/4294967296)>>>0:0)],w[s>>2]=N[0],w[s+4>>2]=N[1],a.Hb&&0===t&&0===n&&(a.Hb=null),0}catch(e){if(void 0===Ke||"ErrnoError"!==e.name)throw e;return e.xb}},d:function(e,t,r,n){try{e:{var s=be(e);e=t;for(var a,o=t=0;o<r;o++){var _=b[e>>2],i=b[e+4>>2];e+=8;var c=s,u=_,f=i,l=a,h=d;if(0>f||0>l)throw new _e(28);if(null===c.vb)throw new _e(8);if(0==(2097155&c.flags))throw new _e(8);if(16384==(61440&c.node.mode))throw new _e(31);if(!c.nb.write)throw new _e(28);c.seekable&&1024&c.flags&&Ne(c,0,2);var v=void 0!==l;if(v){if(!c.seekable)throw new _e(70)}else l=c.position;var w=c.nb.write(c,h,u,f,l,void 0);v||(c.position+=w);var m=w;if(0>m){var p=-1;break e}t+=m,void 0!==a&&(a+=m)}p=t}return b[n>>2]=p,0}catch(e){if(void 0===Ke||"ErrnoError"!==e.name)throw e;return e.xb}},g:Ye},Ge=function(){function e(e){return Ge=e.exports,f=Ge.p,p(),K=Ge.kb,E.unshift(Ge.q),I--,s.monitorRunDependencies?.(I),0==I&&A&&(e=A,A=null,e()),Ge}var t={a:ze};if(I++,s.monitorRunDependencies?.(I),s.instantiateWasm)try{return s.instantiateWasm(t,e)}catch(e){u(`Module.instantiateWasm callback failed with error: ${e}`),n(e)}return function(e,t){var r=C;return i||"function"!=typeof WebAssembly.instantiateStreaming||R(r)||"function"!=typeof fetch?F(r,e,t):fetch(r,{credentials:"same-origin"}).then((n=>WebAssembly.instantiateStreaming(n,e).then(t,(function(n){return u(`wasm streaming compile failed: ${n}`),u("falling back to ArrayBuffer instantiation"),F(r,e,t)}))))}(t,(function(t){e(t.instance)})).catch(n),{}}();s._vscr_error_ctx_size=()=>(s._vscr_error_ctx_size=Ge.r)(),s._vscr_error_reset=e=>(s._vscr_error_reset=Ge.s)(e),s._vscr_error_status=e=>(s._vscr_error_status=Ge.t)(e),s._vscr_ratchet_message_new=()=>(s._vscr_ratchet_message_new=Ge.u)(),s._vscr_ratchet_message_delete=e=>(s._vscr_ratchet_message_delete=Ge.v)(e),s._vscr_ratchet_message_shallow_copy=e=>(s._vscr_ratchet_message_shallow_copy=Ge.w)(e),s._vscr_ratchet_message_get_type=e=>(s._vscr_ratchet_message_get_type=Ge.x)(e),s._vscr_ratchet_message_get_counter=e=>(s._vscr_ratchet_message_get_counter=Ge.y)(e),s._vscr_ratchet_message_get_sender_identity_key_id=(e,t)=>(s._vscr_ratchet_message_get_sender_identity_key_id=Ge.z)(e,t),s._vscr_ratchet_message_get_receiver_identity_key_id=(e,t)=>(s._vscr_ratchet_message_get_receiver_identity_key_id=Ge.A)(e,t),s._vscr_ratchet_message_get_receiver_long_term_key_id=(e,t)=>(s._vscr_ratchet_message_get_receiver_long_term_key_id=Ge.B)(e,t),s._vscr_ratchet_message_get_receiver_one_time_key_id=(e,t)=>(s._vscr_ratchet_message_get_receiver_one_time_key_id=Ge.C)(e,t),s._vscr_ratchet_message_serialize_len=e=>(s._vscr_ratchet_message_serialize_len=Ge.D)(e),s._vscr_ratchet_message_serialize=(e,t)=>(s._vscr_ratchet_message_serialize=Ge.E)(e,t),s._vscr_ratchet_message_deserialize=(e,t)=>(s._vscr_ratchet_message_deserialize=Ge.F)(e,t),s._vscr_ratchet_session_release_rng=e=>(s._vscr_ratchet_session_release_rng=Ge.G)(e),s._vscr_ratchet_session_new=()=>(s._vscr_ratchet_session_new=Ge.H)(),s._vscr_ratchet_session_delete=e=>(s._vscr_ratchet_session_delete=Ge.I)(e),s._vscr_ratchet_session_shallow_copy=e=>(s._vscr_ratchet_session_shallow_copy=Ge.J)(e),s._vscr_ratchet_session_use_rng=(e,t)=>(s._vscr_ratchet_session_use_rng=Ge.K)(e,t),s._vscr_ratchet_session_setup_defaults=e=>(s._vscr_ratchet_session_setup_defaults=Ge.L)(e),s._vscr_ratchet_session_initiate=(e,t,r,n,a,o,_,i,c,u)=>(s._vscr_ratchet_session_initiate=Ge.M)(e,t,r,n,a,o,_,i,c,u),s._vscr_ratchet_session_initiate_no_one_time_key=(e,t,r,n,a,o,_,i)=>(s._vscr_ratchet_session_initiate_no_one_time_key=Ge.N)(e,t,r,n,a,o,_,i),s._vscr_ratchet_session_respond=(e,t,r,n,a,o,_)=>(s._vscr_ratchet_session_respond=Ge.O)(e,t,r,n,a,o,_),s._vscr_ratchet_session_respond_no_one_time_key=(e,t,r,n,a,o)=>(s._vscr_ratchet_session_respond_no_one_time_key=Ge.P)(e,t,r,n,a,o),s._vscr_ratchet_session_is_initiator=e=>(s._vscr_ratchet_session_is_initiator=Ge.Q)(e),s._vscr_ratchet_session_is_pqc_enabled=e=>(s._vscr_ratchet_session_is_pqc_enabled=Ge.R)(e),s._vscr_ratchet_session_received_first_response=e=>(s._vscr_ratchet_session_received_first_response=Ge.S)(e),s._vscr_ratchet_session_receiver_has_one_time_public_key=e=>(s._vscr_ratchet_session_receiver_has_one_time_public_key=Ge.T)(e),s._vscr_ratchet_session_encrypt=(e,t,r)=>(s._vscr_ratchet_session_encrypt=Ge.U)(e,t,r),s._vscr_ratchet_session_decrypt_len=(e,t)=>(s._vscr_ratchet_session_decrypt_len=Ge.V)(e,t),s._vscr_ratchet_session_decrypt=(e,t,r)=>(s._vscr_ratchet_session_decrypt=Ge.W)(e,t,r),s._vscr_ratchet_session_serialize=e=>(s._vscr_ratchet_session_serialize=Ge.X)(e),s._vscr_ratchet_session_deserialize=(e,t)=>(s._vscr_ratchet_session_deserialize=Ge.Y)(e,t),s._vscf_impl_api=(e,t)=>(s._vscf_impl_api=Ge.Z)(e,t),s._vscf_impl_tag=e=>(s._vscf_impl_tag=Ge._)(e),s._vscf_impl_shallow_copy=e=>(s._vscf_impl_shallow_copy=Ge.$)(e),s._vscf_ctr_drbg_setup_defaults=e=>(s._vscf_ctr_drbg_setup_defaults=Ge.aa)(e),s._vscf_ctr_drbg_enable_prediction_resistance=e=>(s._vscf_ctr_drbg_enable_prediction_resistance=Ge.ba)(e),s._vscf_ctr_drbg_set_reseed_interval=(e,t)=>(s._vscf_ctr_drbg_set_reseed_interval=Ge.ca)(e,t),s._vscf_ctr_drbg_set_entropy_len=(e,t)=>(s._vscf_ctr_drbg_set_entropy_len=Ge.da)(e,t),s._vscf_ctr_drbg_random=(e,t,r)=>(s._vscf_ctr_drbg_random=Ge.ea)(e,t,r),s._vscf_ctr_drbg_reseed=e=>(s._vscf_ctr_drbg_reseed=Ge.fa)(e),s._vscf_ctr_drbg_release_entropy_source=e=>(s._vscf_ctr_drbg_release_entropy_source=Ge.ga)(e),s._vscf_ctr_drbg_new=()=>(s._vscf_ctr_drbg_new=Ge.ha)(),s._vscf_ctr_drbg_delete=e=>(s._vscf_ctr_drbg_delete=Ge.ia)(e),s._vscf_ctr_drbg_shallow_copy=e=>(s._vscf_ctr_drbg_shallow_copy=Ge.ja)(e),s._vscf_ctr_drbg_use_entropy_source=(e,t)=>(s._vscf_ctr_drbg_use_entropy_source=Ge.ka)(e,t),s._vscf_hkdf_alg_id=e=>(s._vscf_hkdf_alg_id=Ge.la)(e),s._vscf_hkdf_produce_alg_info=e=>(s._vscf_hkdf_produce_alg_info=Ge.ma)(e),s._vscf_hkdf_restore_alg_info=(e,t)=>(s._vscf_hkdf_restore_alg_info=Ge.na)(e,t),s._vscf_hkdf_derive=(e,t,r,n)=>(s._vscf_hkdf_derive=Ge.oa)(e,t,r,n),s._vscf_hkdf_reset=(e,t,r)=>(s._vscf_hkdf_reset=Ge.pa)(e,t,r),s._vscf_hkdf_set_info=(e,t)=>(s._vscf_hkdf_set_info=Ge.qa)(e,t),s._vscf_hkdf_release_hash=e=>(s._vscf_hkdf_release_hash=Ge.ra)(e),s._vscf_hkdf_new=()=>(s._vscf_hkdf_new=Ge.sa)(),s._vscf_hkdf_delete=e=>(s._vscf_hkdf_delete=Ge.ta)(e),s._vscf_hkdf_shallow_copy=e=>(s._vscf_hkdf_shallow_copy=Ge.ua)(e),s._vscf_hkdf_use_hash=(e,t)=>(s._vscf_hkdf_use_hash=Ge.va)(e,t),s._vscf_hmac_alg_id=e=>(s._vscf_hmac_alg_id=Ge.wa)(e),s._vscf_hmac_produce_alg_info=e=>(s._vscf_hmac_produce_alg_info=Ge.xa)(e),s._vscf_hmac_restore_alg_info=(e,t)=>(s._vscf_hmac_restore_alg_info=Ge.ya)(e,t),s._vscf_hmac_digest_len=e=>(s._vscf_hmac_digest_len=Ge.za)(e),s._vscf_hmac_mac=(e,t,r,n)=>(s._vscf_hmac_mac=Ge.Aa)(e,t,r,n),s._vscf_hmac_start=(e,t)=>(s._vscf_hmac_start=Ge.Ba)(e,t),s._vscf_hmac_finish=(e,t)=>(s._vscf_hmac_finish=Ge.Ca)(e,t),s._vscf_hmac_update=(e,t)=>(s._vscf_hmac_update=Ge.Da)(e,t),s._vscf_hmac_reset=e=>(s._vscf_hmac_reset=Ge.Ea)(e),s._vscf_hmac_release_hash=e=>(s._vscf_hmac_release_hash=Ge.Fa)(e),s._vscf_hmac_new=()=>(s._vscf_hmac_new=Ge.Ga)(),s._vscf_hmac_delete=e=>(s._vscf_hmac_delete=Ge.Ha)(e),s._vscf_hmac_shallow_copy=e=>(s._vscf_hmac_shallow_copy=Ge.Ia)(e),s._vscf_hmac_use_hash=(e,t)=>(s._vscf_hmac_use_hash=Ge.Ja)(e,t),s._vscf_sha512_alg_id=e=>(s._vscf_sha512_alg_id=Ge.Ka)(e),s._vscf_sha512_produce_alg_info=e=>(s._vscf_sha512_produce_alg_info=Ge.La)(e),s._vscf_sha512_restore_alg_info=(e,t)=>(s._vscf_sha512_restore_alg_info=Ge.Ma)(e,t),s._vscf_sha512_hash=(e,t)=>(s._vscf_sha512_hash=Ge.Na)(e,t),s._vscf_sha512_finish=(e,t)=>(s._vscf_sha512_finish=Ge.Oa)(e,t),s._vscf_sha512_start=e=>(s._vscf_sha512_start=Ge.Pa)(e),s._vscf_sha512_update=(e,t)=>(s._vscf_sha512_update=Ge.Qa)(e,t),s._vscf_sha512_new=()=>(s._vscf_sha512_new=Ge.Ra)(),s._vscf_sha512_delete=e=>(s._vscf_sha512_delete=Ge.Sa)(e),s._vscf_sha512_shallow_copy=e=>(s._vscf_sha512_shallow_copy=Ge.Ta)(e),s._vscf_error_ctx_size=()=>(s._vscf_error_ctx_size=Ge.Ua)(),s._vscf_error_reset=e=>(s._vscf_error_reset=Ge.Va)(e),s._vscf_error_status=e=>(s._vscf_error_status=Ge.Wa)(e),s._vsc_buffer_new=()=>(s._vsc_buffer_new=Ge.Xa)(),s._vsc_buffer_new_with_capacity=e=>(s._vsc_buffer_new_with_capacity=Ge.Ya)(e),s._vsc_buffer_delete=e=>(s._vsc_buffer_delete=Ge.Za)(e),s._vsc_buffer_data=(e,t)=>(s._vsc_buffer_data=Ge._a)(e,t),s._vsc_buffer_make_secure=e=>(s._vsc_buffer_make_secure=Ge.$a)(e),s._vsc_buffer_bytes=e=>(s._vsc_buffer_bytes=Ge.ab)(e),s._vsc_buffer_len=e=>(s._vsc_buffer_len=Ge.bb)(e),s._vsc_data_ctx_size=()=>(s._vsc_data_ctx_size=Ge.cb)(),s._vsc_data=(e,t,r)=>(s._vsc_data=Ge.db)(e,t,r),s._vsc_data_len=e=>(s._vsc_data_len=Ge.eb)(e),s._vsc_data_bytes=e=>(s._vsc_data_bytes=Ge.fb)(e);var $e,qe=()=>(qe=Ge.gb)(),Ve=(e,t)=>(Ve=Ge.hb)(e,t);function Ze(){function e(){if(!$e&&($e=!0,s.calledRun=!0,!m)){if(s.noFSInit||pe||(pe=!0,Re(),s.stdin=s.stdin,s.stdout=s.stdout,s.stderr=s.stderr,s.stdin?Se("stdin",s.stdin):xe("/dev/tty","/dev/stdin"),s.stdout?Se("stdout",null,s.stdout):xe("/dev/tty","/dev/stdout"),s.stderr?Se("stderr",null,s.stderr):xe("/dev/tty1","/dev/stderr"),Te("/dev/stdin",0),Te("/dev/stdout",1),Te("/dev/stderr",1)),oe=!1,D(E),t(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),s.postRun)for("function"==typeof s.postRun&&(s.postRun=[s.postRun]);s.postRun.length;){var e=s.postRun.shift();P.unshift(e)}D(P)}}if(!(0<I)){if(s.preRun)for("function"==typeof s.preRun&&(s.preRun=[s.preRun]);s.preRun.length;)g();D(y),0<I||(s.setStatus?(s.setStatus("Running..."),setTimeout((function(){setTimeout((function(){s.setStatus("")}),1),e()}),1)):e())}}if(s._malloc=e=>(s._malloc=Ge.ib)(e),s._free=e=>(s._free=Ge.jb)(e),A=function e(){$e||Ze(),$e||(A=e)},s.preInit)for("function"==typeof s.preInit&&(s.preInit=[s.preInit]);0<s.preInit.length;)s.preInit.pop()();return Ze(),e.ready});e.exports=n}(t);var r=t.exports;var n=(e,t)=>{class r extends Error{constructor(e){super(e),this.name="FoundationError",this.message=e}static handleStatusCode(e){if(0!=e){if(-1==e)throw new r("This error should not be returned if assertions is enabled.");if(-2==e)throw new r("Can be used to define that not all context prerequisites are satisfied. Note, this error should not be returned if assertions is enabled.");if(-3==e)throw new r("Define that error code from one of third-party module was not handled. Note, this error should not be returned if assertions is enabled.");if(-101==e)throw new r("Buffer capacity is not enough to hold result.");if(-200==e)throw new r("Unsupported algorithm.");if(-201==e)throw new r("Authentication failed during decryption.");if(-202==e)throw new r("Attempt to read data out of buffer bounds.");if(-203==e)throw new r("ASN.1 encoded data is corrupted.");if(-204==e)throw new r("Attempt to read ASN.1 type that is bigger then requested C type.");if(-205==e)throw new r("ASN.1 representation of PKCS#1 public key is corrupted.");if(-206==e)throw new r("ASN.1 representation of PKCS#1 private key is corrupted.");if(-207==e)throw new r("ASN.1 representation of PKCS#8 public key is corrupted.");if(-208==e)throw new r("ASN.1 representation of PKCS#8 private key is corrupted.");if(-209==e)throw new r("Encrypted data is corrupted.");if(-210==e)throw new r("Underlying random operation returns error.");if(-211==e)throw new r("Generation of the private or secret key failed.");if(-212==e)throw new r("One of the entropy sources failed.");if(-213==e)throw new r("Requested data to be generated is too big.");if(-214==e)throw new r("Base64 encoded string contains invalid characters.");if(-215==e)throw new r("PEM data is corrupted.");if(-216==e)throw new r("Exchange key return zero.");if(-217==e)throw new r("Ed25519 public key is corrupted.");if(-218==e)throw new r("Ed25519 private key is corrupted.");if(-219==e)throw new r("CURVE25519 public key is corrupted.");if(-220==e)throw new r("CURVE25519 private key is corrupted.");if(-221==e)throw new r("Elliptic curve public key format is corrupted see RFC 5480.");if(-222==e)throw new r("Elliptic curve public key format is corrupted see RFC 5915.");if(-223==e)throw new r("ASN.1 representation of a public key is corrupted.");if(-224==e)throw new r("ASN.1 representation of a private key is corrupted.");if(-225==e)throw new r("Key algorithm does not accept given type of public key.");if(-226==e)throw new r("Key algorithm does not accept given type of private key.");if(-227==e)throw new r("Post-quantum Falcon-Sign public key is corrupted.");if(-228==e)throw new r("Post-quantum Falcon-Sign private key is corrupted.");if(-229==e)throw new r("Generic Round5 library error.");if(-230==e)throw new r("Post-quantum NIST Round5 public key is corrupted.");if(-231==e)throw new r("Post-quantum NIST Round5 private key is corrupted.");if(-232==e)throw new r("Compound public key is corrupted.");if(-233==e)throw new r("Compound private key is corrupted.");if(-234==e)throw new r("Compound public hybrid key is corrupted.");if(-235==e)throw new r("Compound private hybrid key is corrupted.");if(-236==e)throw new r("ASN.1 AlgorithmIdentifer is corrupted.");if(-237==e)throw new r("ASN.1 AlgorithmIdentifer with ECParameters is corrupted.");if(-238==e)throw new r("ASN.1 AlgorithmIdentifer with CompoundKeyParams is corrupted.");if(-239==e)throw new r("ASN.1 AlgorithmIdentifer with HybridKeyParams is corrupted.");if(-301==e)throw new r("Decryption failed, because message info was not given explicitly, and was not part of an encrypted message.");if(-302==e)throw new r("Message Info is corrupted.");if(-303==e)throw new r("Recipient defined with id is not found within message info during data decryption.");if(-304==e)throw new r("Content encryption key can not be decrypted with a given private key.");if(-305==e)throw new r("Content encryption key can not be decrypted with a given password.");if(-306==e)throw new r("Custom parameter with a given key is not found within message info.");if(-307==e)throw new r("A custom parameter with a given key is found, but the requested value type does not correspond to the actual type.");if(-308==e)throw new r("Signature format is corrupted.");if(-309==e)throw new r("Message Info footer is corrupted.");if(-401==e)throw new r("Brainkey password length is out of range.");if(-402==e)throw new r("Brainkey number length should be 32 byte.");if(-403==e)throw new r("Brainkey point length should be 65 bytes.");if(-404==e)throw new r("Brainkey name is out of range.");if(-405==e)throw new r("Brainkey internal error.");if(-406==e)throw new r("Brainkey point is invalid.");if(-407==e)throw new r("Brainkey number buffer length capacity should be >= 32 byte.");if(-408==e)throw new r("Brainkey point buffer length capacity should be >= 32 byte.");if(-409==e)throw new r("Brainkey seed buffer length capacity should be >= 32 byte.");if(-410==e)throw new r("Brainkey identity secret is invalid.");if(-411==e)throw new r("KEM encapsulated key is invalid or does not correspond to the private key.");if(-501==e)throw new r("Invalid padding.");if(-601==e)throw new r("Protobuf error.");if(-701==e)throw new r("Session id doesnt match.");if(-702==e)throw new r("Epoch not found.");if(-703==e)throw new r("Wrong key type.");if(-704==e)throw new r("Invalid signature.");if(-705==e)throw new r("Ed25519 error.");if(-706==e)throw new r("Duplicate epoch.");if(-707==e)throw new r("Plain text too long.");throw new r("Unexpected status code:"+e)}}}return r};var s=(e,t)=>class{static newAndTakeCContext(r){const n=e._vscf_impl_tag(r);switch(n){case t.FoundationImplTag.SHA224:return t.Sha224.newAndTakeCContext(r);case t.FoundationImplTag.SHA256:return t.Sha256.newAndTakeCContext(r);case t.FoundationImplTag.SHA384:return t.Sha384.newAndTakeCContext(r);case t.FoundationImplTag.SHA512:return t.Sha512.newAndTakeCContext(r);case t.FoundationImplTag.AES256_GCM:return t.Aes256Gcm.newAndTakeCContext(r);case t.FoundationImplTag.AES256_CBC:return t.Aes256Cbc.newAndTakeCContext(r);case t.FoundationImplTag.ASN1RD:return t.Asn1rd.newAndTakeCContext(r);case t.FoundationImplTag.ASN1WR:return t.Asn1wr.newAndTakeCContext(r);case t.FoundationImplTag.RSA_PUBLIC_KEY:return t.RsaPublicKey.newAndTakeCContext(r);case t.FoundationImplTag.RSA_PRIVATE_KEY:return t.RsaPrivateKey.newAndTakeCContext(r);case t.FoundationImplTag.RSA:return t.Rsa.newAndTakeCContext(r);case t.FoundationImplTag.ECC_PUBLIC_KEY:return t.EccPublicKey.newAndTakeCContext(r);case t.FoundationImplTag.ECC_PRIVATE_KEY:return t.EccPrivateKey.newAndTakeCContext(r);case t.FoundationImplTag.ECC:return t.Ecc.newAndTakeCContext(r);case t.FoundationImplTag.ENTROPY_ACCUMULATOR:return t.EntropyAccumulator.newAndTakeCContext(r);case t.FoundationImplTag.CTR_DRBG:return t.CtrDrbg.newAndTakeCContext(r);case t.FoundationImplTag.HMAC:return t.Hmac.newAndTakeCContext(r);case t.FoundationImplTag.HKDF:return t.Hkdf.newAndTakeCContext(r);case t.FoundationImplTag.KDF1:return t.Kdf1.newAndTakeCContext(r);case t.FoundationImplTag.KDF2:return t.Kdf2.newAndTakeCContext(r);case t.FoundationImplTag.FAKE_RANDOM:return t.FakeRandom.newAndTakeCContext(r);case t.FoundationImplTag.PKCS5_PBKDF2:return t.Pkcs5Pbkdf2.newAndTakeCContext(r);case t.FoundationImplTag.PKCS5_PBES2:return t.Pkcs5Pbes2.newAndTakeCContext(r);case t.FoundationImplTag.SEED_ENTROPY_SOURCE:return t.SeedEntropySource.newAndTakeCContext(r);case t.FoundationImplTag.KEY_MATERIAL_RNG:return t.KeyMaterialRng.newAndTakeCContext(r);case t.FoundationImplTag.RAW_PUBLIC_KEY:return t.RawPublicKey.newAndTakeCContext(r);case t.FoundationImplTag.RAW_PRIVATE_KEY:return t.RawPrivateKey.newAndTakeCContext(r);case t.FoundationImplTag.PKCS8_SERIALIZER:return t.Pkcs8Serializer.newAndTakeCContext(r);case t.FoundationImplTag.SEC1_SERIALIZER:return t.Sec1Serializer.newAndTakeCContext(r);case t.FoundationImplTag.KEY_ASN1_SERIALIZER:return t.KeyAsn1Serializer.newAndTakeCContext(r);case t.FoundationImplTag.KEY_ASN1_DESERIALIZER:return t.KeyAsn1Deserializer.newAndTakeCContext(r);case t.FoundationImplTag.ED25519:return t.Ed25519.newAndTakeCContext(r);case t.FoundationImplTag.CURVE25519:return t.Curve25519.newAndTakeCContext(r);case t.FoundationImplTag.FALCON:return t.Falcon.newAndTakeCContext(r);case t.FoundationImplTag.ROUND5:return t.Round5.newAndTakeCContext(r);case t.FoundationImplTag.COMPOUND_KEY_ALG_INFO:return t.CompoundKeyAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.COMPOUND_PUBLIC_KEY:return t.CompoundPublicKey.newAndTakeCContext(r);case t.FoundationImplTag.COMPOUND_PRIVATE_KEY:return t.CompoundPrivateKey.newAndTakeCContext(r);case t.FoundationImplTag.COMPOUND_KEY_ALG:return t.CompoundKeyAlg.newAndTakeCContext(r);case t.FoundationImplTag.HYBRID_KEY_ALG_INFO:return t.HybridKeyAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.HYBRID_PUBLIC_KEY:return t.HybridPublicKey.newAndTakeCContext(r);case t.FoundationImplTag.HYBRID_PRIVATE_KEY:return t.HybridPrivateKey.newAndTakeCContext(r);case t.FoundationImplTag.HYBRID_KEY_ALG:return t.HybridKeyAlg.newAndTakeCContext(r);case t.FoundationImplTag.SIMPLE_ALG_INFO:return t.SimpleAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.HASH_BASED_ALG_INFO:return t.HashBasedAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.CIPHER_ALG_INFO:return t.CipherAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.SALTED_KDF_ALG_INFO:return t.SaltedKdfAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.PBE_ALG_INFO:return t.PbeAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.ECC_ALG_INFO:return t.EccAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.ALG_INFO_DER_SERIALIZER:return t.AlgInfoDerSerializer.newAndTakeCContext(r);case t.FoundationImplTag.ALG_INFO_DER_DESERIALIZER:return t.AlgInfoDerDeserializer.newAndTakeCContext(r);case t.FoundationImplTag.MESSAGE_INFO_DER_SERIALIZER:return t.MessageInfoDerSerializer.newAndTakeCContext(r);case t.FoundationImplTag.RANDOM_PADDING:return t.RandomPadding.newAndTakeCContext(r);default:throw new Error("Unexpected implementation tag found: "+n)}}static newAndUseCContext(r){return new t.FoundationInterface.newAndTakeCContext(e._vscf_impl_shallow_copy(r))}static isImplemented(t,r){return 0!=e._vscf_impl_api(t,r)}};var a=(e,t)=>Object.freeze({ALG:1,ALG_INFO:2,ALG_INFO_DESERIALIZER:3,ALG_INFO_SERIALIZER:4,ASN1_READER:5,ASN1_WRITER:6,AUTH_DECRYPT:7,AUTH_ENCRYPT:8,CIPHER:9,CIPHER_AUTH:10,CIPHER_AUTH_INFO:11,CIPHER_INFO:12,COMPUTE_SHARED_KEY:13,DECRYPT:14,ENCRYPT:15,ENTROPY_SOURCE:16,HASH:17,KDF:18,KEM:19,KEY:20,KEY_ALG:21,KEY_CIPHER:22,KEY_DESERIALIZER:23,KEY_SERIALIZER:24,KEY_SIGNER:25,MAC:26,MESSAGE_INFO_FOOTER_SERIALIZER:27,MESSAGE_INFO_SERIALIZER:28,PADDING:29,PRIVATE_KEY:30,PUBLIC_KEY:31,RANDOM:32,SALTED_KDF:33});var o=(e,t)=>Object.freeze({AES256_CBC:1,AES256_GCM:2,ALG_INFO_DER_DESERIALIZER:3,ALG_INFO_DER_SERIALIZER:4,ASN1RD:5,ASN1WR:6,CIPHER_ALG_INFO:7,COMPOUND_KEY_ALG:8,COMPOUND_KEY_ALG_INFO:9,COMPOUND_PRIVATE_KEY:10,COMPOUND_PUBLIC_KEY:11,CTR_DRBG:12,CURVE25519:13,ECC:14,ECC_ALG_INFO:15,ECC_PRIVATE_KEY:16,ECC_PUBLIC_KEY:17,ED25519:18,ENTROPY_ACCUMULATOR:19,FAKE_RANDOM:20,FALCON:21,HASH_BASED_ALG_INFO:22,HKDF:23,HMAC:24,HYBRID_KEY_ALG:25,HYBRID_KEY_ALG_INFO:26,HYBRID_PRIVATE_KEY:27,HYBRID_PUBLIC_KEY:28,KDF1:29,KDF2:30,KEY_ASN1_DESERIALIZER:31,KEY_ASN1_SERIALIZER:32,KEY_MATERIAL_RNG:33,MESSAGE_INFO_DER_SERIALIZER:34,PBE_ALG_INFO:35,PKCS5_PBES2:36,PKCS5_PBKDF2:37,PKCS8_SERIALIZER:38,RANDOM_PADDING:39,RAW_PRIVATE_KEY:40,RAW_PUBLIC_KEY:41,ROUND5:42,RSA:43,RSA_PRIVATE_KEY:44,RSA_PUBLIC_KEY:45,SALTED_KDF_ALG_INFO:46,SEC1_SERIALIZER:47,SEED_ENTROPY_SOURCE:48,SHA224:49,SHA256:50,SHA384:51,SHA512:52,SIMPLE_ALG_INFO:53}),_={};function i(e,t){if(!("number"==typeof t||t instanceof Number))throw new TypeError(`'${e}' is not a number`);if(Number.isNaN(t))throw new TypeError(`'${e}' is NaN`);if(t===1/0)throw new TypeError(`'${e}' is Infinity`);if(t===-1/0)throw new TypeError(`'${e}' is -Infinity`)}function c(e,t){if(i(e,t),0==t)throw new TypeError(`'${e}' is NULL`)}_.ensureNumber=i,_.ensureString=function(e,t){if(!("string"==typeof t||t instanceof String))throw new TypeError(`'${e}' is not a string`)},_.ensureBoolean=function(e,t){if("boolean"!=typeof t)throw new TypeError(`'${e}' is not a boolean`)},_.ensureByteArray=function(e,t){if(!(t instanceof Uint8Array))throw new TypeError(`'${e}' is not an Uint8Array`)},_.ensureClass=function(e,t,r){if(!(t instanceof r))throw new TypeError(`'${e}' is not an instance of the class ${r.name}`);c(e,t.ctxPtr)},_.ensureNotNull=c,_.ensureImplementInterface=function(e,t,r,n,s){if(c(e,t.ctxPtr),!s.isImplemented(t.ctxPtr,n))throw new TypeError(`'${e}' does not implement interface '${r}'`)};const u=_;var f=(e,t)=>{class r{static get RESEED_INTERVAL(){return 1e4}get RESEED_INTERVAL(){return r.RESEED_INTERVAL}static get ENTROPY_LEN(){return 48}get ENTROPY_LEN(){return r.ENTROPY_LEN}constructor(t){this.name="CtrDrbg",this.ctxPtr=void 0===t?e._vscf_ctr_drbg_new():t}static newAndUseCContext(t){return new r(e._vscf_ctr_drbg_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscf_ctr_drbg_delete(this.ctxPtr),this.ctxPtr=null)}set entropySource(r){u.ensureNotNull("this.ctxPtr",this.ctxPtr),u.ensureImplementInterface("entropySource",r,"Foundation.EntropySource",t.FoundationInterfaceTag.ENTROPY_SOURCE,t.FoundationInterface),e._vscf_ctr_drbg_release_entropy_source(this.ctxPtr);const n=e._vscf_ctr_drbg_use_entropy_source(this.ctxPtr,r.ctxPtr);t.FoundationError.handleStatusCode(n)}random(r){u.ensureNotNull("this.ctxPtr",this.ctxPtr),u.ensureNumber("dataLen",r);const n=r,s=e._vsc_buffer_new_with_capacity(n);try{const n=e._vscf_ctr_drbg_random(this.ctxPtr,r,s);t.FoundationError.handleStatusCode(n);const a=e._vsc_buffer_bytes(s),o=e._vsc_buffer_len(s);return e.HEAPU8.slice(a,a+o)}finally{e._vsc_buffer_delete(s)}}reseed(){u.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=e._vscf_ctr_drbg_reseed(this.ctxPtr);t.FoundationError.handleStatusCode(r)}setupDefaults(){u.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=e._vscf_ctr_drbg_setup_defaults(this.ctxPtr);t.FoundationError.handleStatusCode(r)}enablePredictionResistance(){u.ensureNotNull("this.ctxPtr",this.ctxPtr),e._vscf_ctr_drbg_enable_prediction_resistance(this.ctxPtr)}setReseedInterval(t){u.ensureNotNull("this.ctxPtr",this.ctxPtr),u.ensureNumber("interval",t),e._vscf_ctr_drbg_set_reseed_interval(this.ctxPtr,t)}setEntropyLen(t){u.ensureNotNull("this.ctxPtr",this.ctxPtr),u.ensureNumber("len",t),e._vscf_ctr_drbg_set_entropy_len(this.ctxPtr,t)}}return r};const l=_;var d=(e,t)=>{class r{constructor(t){this.name="Hmac",this.ctxPtr=void 0===t?e._vscf_hmac_new():t}static newAndUseCContext(t){return new r(e._vscf_hmac_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscf_hmac_delete(this.ctxPtr),this.ctxPtr=null)}set hash(r){l.ensureNotNull("this.ctxPtr",this.ctxPtr),l.ensureImplementInterface("hash",r,"Foundation.Hash",t.FoundationInterfaceTag.HASH,t.FoundationInterface),e._vscf_hmac_release_hash(this.ctxPtr),e._vscf_hmac_use_hash(this.ctxPtr,r.ctxPtr)}algId(){let t;return l.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscf_hmac_alg_id(this.ctxPtr),t}produceAlgInfo(){let r;l.ensureNotNull("this.ctxPtr",this.ctxPtr),r=e._vscf_hmac_produce_alg_info(this.ctxPtr);return t.FoundationInterface.newAndTakeCContext(r)}restoreAlgInfo(r){l.ensureNotNull("this.ctxPtr",this.ctxPtr),l.ensureImplementInterface("algInfo",r,"Foundation.AlgInfo",t.FoundationInterfaceTag.ALG_INFO,t.FoundationInterface);const n=e._vscf_hmac_restore_alg_info(this.ctxPtr,r.ctxPtr);t.FoundationError.handleStatusCode(n)}digestLen(){let t;return l.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscf_hmac_digest_len(this.ctxPtr),t}mac(t,r){l.ensureNotNull("this.ctxPtr",this.ctxPtr),l.ensureByteArray("key",t),l.ensureByteArray("data",r);const n=t.length*t.BYTES_PER_ELEMENT,s=e._malloc(n);e.HEAP8.set(t,s);const a=e._vsc_data_ctx_size(),o=e._malloc(a);e._vsc_data(o,s,n);const _=r.length*r.BYTES_PER_ELEMENT,i=e._malloc(_);e.HEAP8.set(r,i);const c=e._vsc_data_ctx_size(),u=e._malloc(c);e._vsc_data(u,i,_);const f=this.digestLen(),d=e._vsc_buffer_new_with_capacity(f);try{e._vscf_hmac_mac(this.ctxPtr,o,u,d);const t=e._vsc_buffer_bytes(d),r=e._vsc_buffer_len(d);return e.HEAPU8.slice(t,t+r)}finally{e._free(s),e._free(o),e._free(i),e._free(u),e._vsc_buffer_delete(d)}}start(t){l.ensureNotNull("this.ctxPtr",this.ctxPtr),l.ensureByteArray("key",t);const r=t.length*t.BYTES_PER_ELEMENT,n=e._malloc(r);e.HEAP8.set(t,n);const s=e._vsc_data_ctx_size(),a=e._malloc(s);e._vsc_data(a,n,r);try{e._vscf_hmac_start(this.ctxPtr,a)}finally{e._free(n),e._free(a)}}update(t){l.ensureNotNull("this.ctxPtr",this.ctxPtr),l.ensureByteArray("data",t);const r=t.length*t.BYTES_PER_ELEMENT,n=e._malloc(r);e.HEAP8.set(t,n);const s=e._vsc_data_ctx_size(),a=e._malloc(s);e._vsc_data(a,n,r);try{e._vscf_hmac_update(this.ctxPtr,a)}finally{e._free(n),e._free(a)}}finish(){l.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=this.digestLen(),r=e._vsc_buffer_new_with_capacity(t);try{e._vscf_hmac_finish(this.ctxPtr,r);const t=e._vsc_buffer_bytes(r),n=e._vsc_buffer_len(r);return e.HEAPU8.slice(t,t+n)}finally{e._vsc_buffer_delete(r)}}reset(){l.ensureNotNull("this.ctxPtr",this.ctxPtr),e._vscf_hmac_reset(this.ctxPtr)}}return r};const h=_;var v=(e,t)=>{class r{constructor(t){this.name="Hkdf",this.ctxPtr=void 0===t?e._vscf_hkdf_new():t}static newAndUseCContext(t){return new r(e._vscf_hkdf_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscf_hkdf_delete(this.ctxPtr),this.ctxPtr=null)}set hash(r){h.ensureNotNull("this.ctxPtr",this.ctxPtr),h.ensureImplementInterface("hash",r,"Foundation.Hash",t.FoundationInterfaceTag.HASH,t.FoundationInterface),e._vscf_hkdf_release_hash(this.ctxPtr),e._vscf_hkdf_use_hash(this.ctxPtr,r.ctxPtr)}algId(){let t;return h.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscf_hkdf_alg_id(this.ctxPtr),t}produceAlgInfo(){let r;h.ensureNotNull("this.ctxPtr",this.ctxPtr),r=e._vscf_hkdf_produce_alg_info(this.ctxPtr);return t.FoundationInterface.newAndTakeCContext(r)}restoreAlgInfo(r){h.ensureNotNull("this.ctxPtr",this.ctxPtr),h.ensureImplementInterface("algInfo",r,"Foundation.AlgInfo",t.FoundationInterfaceTag.ALG_INFO,t.FoundationInterface);const n=e._vscf_hkdf_restore_alg_info(this.ctxPtr,r.ctxPtr);t.FoundationError.handleStatusCode(n)}derive(t,r){h.ensureNotNull("this.ctxPtr",this.ctxPtr),h.ensureByteArray("data",t),h.ensureNumber("keyLen",r);const n=t.length*t.BYTES_PER_ELEMENT,s=e._malloc(n);e.HEAP8.set(t,s);const a=e._vsc_data_ctx_size(),o=e._malloc(a);e._vsc_data(o,s,n);const _=r,i=e._vsc_buffer_new_with_capacity(_);try{e._vscf_hkdf_derive(this.ctxPtr,o,r,i);const t=e._vsc_buffer_bytes(i),n=e._vsc_buffer_len(i);return e.HEAPU8.slice(t,t+n)}finally{e._free(s),e._free(o),e._vsc_buffer_delete(i)}}reset(t,r){h.ensureNotNull("this.ctxPtr",this.ctxPtr),h.ensureByteArray("salt",t),h.ensureNumber("iterationCount",r);const n=t.length*t.BYTES_PER_ELEMENT,s=e._malloc(n);e.HEAP8.set(t,s);const a=e._vsc_data_ctx_size(),o=e._malloc(a);e._vsc_data(o,s,n);try{e._vscf_hkdf_reset(this.ctxPtr,o,r)}finally{e._free(s),e._free(o)}}setInfo(t){h.ensureNotNull("this.ctxPtr",this.ctxPtr),h.ensureByteArray("info",t);const r=t.length*t.BYTES_PER_ELEMENT,n=e._malloc(r);e.HEAP8.set(t,n);const s=e._vsc_data_ctx_size(),a=e._malloc(s);e._vsc_data(a,n,r);try{e._vscf_hkdf_set_info(this.ctxPtr,a)}finally{e._free(n),e._free(a)}}}return r};const w=_;var b=(e,t)=>{class r{static get DIGEST_LEN(){return 64}get DIGEST_LEN(){return r.DIGEST_LEN}static get BLOCK_LEN(){return 128}get BLOCK_LEN(){return r.BLOCK_LEN}constructor(t){this.name="Sha512",this.ctxPtr=void 0===t?e._vscf_sha512_new():t}static newAndUseCContext(t){return new r(e._vscf_sha512_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscf_sha512_delete(this.ctxPtr),this.ctxPtr=null)}algId(){let t;return w.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscf_sha512_alg_id(this.ctxPtr),t}produceAlgInfo(){let r;w.ensureNotNull("this.ctxPtr",this.ctxPtr),r=e._vscf_sha512_produce_alg_info(this.ctxPtr);return t.FoundationInterface.newAndTakeCContext(r)}restoreAlgInfo(r){w.ensureNotNull("this.ctxPtr",this.ctxPtr),w.ensureImplementInterface("algInfo",r,"Foundation.AlgInfo",t.FoundationInterfaceTag.ALG_INFO,t.FoundationInterface);const n=e._vscf_sha512_restore_alg_info(this.ctxPtr,r.ctxPtr);t.FoundationError.handleStatusCode(n)}hash(t){w.ensureByteArray("data",t);const r=t.length*t.BYTES_PER_ELEMENT,n=e._malloc(r);e.HEAP8.set(t,n);const s=e._vsc_data_ctx_size(),a=e._malloc(s);e._vsc_data(a,n,r);const o=this.DIGEST_LEN,_=e._vsc_buffer_new_with_capacity(o);try{e._vscf_sha512_hash(a,_);const t=e._vsc_buffer_bytes(_),r=e._vsc_buffer_len(_);return e.HEAPU8.slice(t,t+r)}finally{e._free(n),e._free(a),e._vsc_buffer_delete(_)}}start(){w.ensureNotNull("this.ctxPtr",this.ctxPtr),e._vscf_sha512_start(this.ctxPtr)}update(t){w.ensureNotNull("this.ctxPtr",this.ctxPtr),w.ensureByteArray("data",t);const r=t.length*t.BYTES_PER_ELEMENT,n=e._malloc(r);e.HEAP8.set(t,n);const s=e._vsc_data_ctx_size(),a=e._malloc(s);e._vsc_data(a,n,r);try{e._vscf_sha512_update(this.ctxPtr,a)}finally{e._free(n),e._free(a)}}finish(){w.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=this.DIGEST_LEN,r=e._vsc_buffer_new_with_capacity(t);try{e._vscf_sha512_finish(this.ctxPtr,r);const t=e._vsc_buffer_bytes(r),n=e._vsc_buffer_len(r);return e.HEAPU8.slice(t,t+n)}finally{e._vsc_buffer_delete(r)}}}return r};var m=(e,t)=>{class r extends Error{constructor(e){super(e),this.name="RatchetError",this.message=e}static handleStatusCode(e){if(0!=e){if(-1==e)throw new r("Error during protobuf deserialization.");if(-2==e)throw new r("Bad message type.");if(-3==e)throw new r("AES error.");if(-4==e)throw new r("RNG failed.");if(-5==e)throw new r("Curve25519 error.");if(-6==e)throw new r("Curve25519 error.");if(-7==e)throw new r("Key deserialization failed.");if(-8==e)throw new r("Invalid key type.");if(-9==e)throw new r("Identity key doesn't match.");if(-10==e)throw new r("Message already decrypted.");if(-11==e)throw new r("Too many lost messages.");if(-12==e)throw new r("Sender chain missing.");if(-13==e)throw new r("Skipped message missing.");if(-14==e)throw new r("Session is not initialized.");if(-15==e)throw new r("Exceeded max plain text len.");if(-16==e)throw new r("Too many messages for sender chain.");if(-17==e)throw new r("Too many messages for receiver chain.");if(-18==e)throw new r("Invalid padding.");if(-19==e)throw new r("Too many participants.");if(-20==e)throw new r("Too few participants.");if(-21==e)throw new r("Sender not found.");if(-22==e)throw new r("Cannot decrypt own messages.");if(-23==e)throw new r("Invalid signature.");if(-24==e)throw new r("Cannot remove myself.");if(-25==e)throw new r("Epoch mismatch.");if(-26==e)throw new r("Epoch not found.");if(-27==e)throw new r("Session id mismatch.");if(-28==e)throw new r("Simultaneous group user operation.");if(-29==e)throw new r("Myself is included in info.");if(-30==e)throw new r("Round5 error.");if(-31==e)throw new r("Falcon error.");if(-32==e)throw new r("Decaps signature is invalid.");if(-33==e)throw new r("Error importing round5 key.");throw new r("Unexpected status code:"+e)}}}return r};var p=(e,t)=>Object.freeze({REGULAR:0,PREKEY:1});var y=(e,t)=>Object.freeze({GROUP_INFO:0,REGULAR:1}),E={};function P(e,t){if(!("number"==typeof t||t instanceof Number))throw new TypeError(`'${e}' is not a number`);if(Number.isNaN(t))throw new TypeError(`'${e}' is NaN`);if(t===1/0)throw new TypeError(`'${e}' is Infinity`);if(t===-1/0)throw new TypeError(`'${e}' is -Infinity`)}function g(e,t){if(P(e,t),0==t)throw new TypeError(`'${e}' is NULL`)}E.ensureNumber=P,E.ensureString=function(e,t){if(!("string"==typeof t||t instanceof String))throw new TypeError(`'${e}' is not a string`)},E.ensureBoolean=function(e,t){if("boolean"!=typeof t)throw new TypeError(`'${e}' is not a boolean`)},E.ensureByteArray=function(e,t){if(!(t instanceof Uint8Array))throw new TypeError(`'${e}' is not an Uint8Array`)},E.ensureClass=function(e,t,r){if(!(t instanceof r))throw new TypeError(`'${e}' is not an instance of the class ${r.name}`);g(e,t.ctxPtr)},E.ensureNotNull=g,E.ensureImplementInterface=function(e,t,r,n,s){if(g(e,t.ctxPtr),!s.isImplemented(t.ctxPtr,n))throw new TypeError(`'${e}' does not implement interface '${r}'`)};const I=E;const A=E;const x=r,C=n,T=s,N=a,R=o,S=f,k=d,F=v,L=b,K=m,D=p,O=y,B=(e,t)=>{class r{static get MAX_PLAIN_TEXT_LEN(){return 3e4}get MAX_PLAIN_TEXT_LEN(){return r.MAX_PLAIN_TEXT_LEN}static get MAX_MESSAGE_LEN(){return 35583}get MAX_MESSAGE_LEN(){return r.MAX_MESSAGE_LEN}static get KEY_ID_LEN(){return 8}get KEY_ID_LEN(){return r.KEY_ID_LEN}static get PARTICIPANT_ID_LEN(){return 32}get PARTICIPANT_ID_LEN(){return r.PARTICIPANT_ID_LEN}static get SESSION_ID_LEN(){return 32}get SESSION_ID_LEN(){return r.SESSION_ID_LEN}static get MAX_PARTICIPANTS_COUNT(){return 100}get MAX_PARTICIPANTS_COUNT(){return r.MAX_PARTICIPANTS_COUNT}static get MIN_PARTICIPANTS_COUNT(){return 2}get MIN_PARTICIPANTS_COUNT(){return r.MIN_PARTICIPANTS_COUNT}static get MAX_GROUP_MESSAGE_LEN(){return 32918}get MAX_GROUP_MESSAGE_LEN(){return r.MAX_GROUP_MESSAGE_LEN}}return r},M=(e,t)=>{class r{constructor(t){this.name="RatchetMessage",this.ctxPtr=void 0===t?e._vscr_ratchet_message_new():t}static newAndUseCContext(t){return new r(e._vscr_ratchet_message_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscr_ratchet_message_delete(this.ctxPtr),this.ctxPtr=null)}getType(){let t;return I.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_message_get_type(this.ctxPtr),t}getCounter(){let t;return I.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_message_get_counter(this.ctxPtr),t}getSenderIdentityKeyId(){I.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=e._vsc_data_ctx_size(),r=e._malloc(t);try{e._vscr_ratchet_message_get_sender_identity_key_id(r,this.ctxPtr);const t=e._vsc_data_len(r),n=e._vsc_data_bytes(r);return e.HEAPU8.slice(n,n+t)}finally{e._free(r)}}getReceiverIdentityKeyId(){I.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=e._vsc_data_ctx_size(),r=e._malloc(t);try{e._vscr_ratchet_message_get_receiver_identity_key_id(r,this.ctxPtr);const t=e._vsc_data_len(r),n=e._vsc_data_bytes(r);return e.HEAPU8.slice(n,n+t)}finally{e._free(r)}}getReceiverLongTermKeyId(){I.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=e._vsc_data_ctx_size(),r=e._malloc(t);try{e._vscr_ratchet_message_get_receiver_long_term_key_id(r,this.ctxPtr);const t=e._vsc_data_len(r),n=e._vsc_data_bytes(r);return e.HEAPU8.slice(n,n+t)}finally{e._free(r)}}getReceiverOneTimeKeyId(){I.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=e._vsc_data_ctx_size(),r=e._malloc(t);try{e._vscr_ratchet_message_get_receiver_one_time_key_id(r,this.ctxPtr);const t=e._vsc_data_len(r),n=e._vsc_data_bytes(r);return e.HEAPU8.slice(n,n+t)}finally{e._free(r)}}serializeLen(){let t;return I.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_message_serialize_len(this.ctxPtr),t}serialize(){I.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=this.serializeLen(),r=e._vsc_buffer_new_with_capacity(t);try{e._vscr_ratchet_message_serialize(this.ctxPtr,r);const t=e._vsc_buffer_bytes(r),n=e._vsc_buffer_len(r);return e.HEAPU8.slice(t,t+n)}finally{e._vsc_buffer_delete(r)}}static deserialize(n){I.ensureByteArray("input",n);const s=n.length*n.BYTES_PER_ELEMENT,a=e._malloc(s);e.HEAP8.set(n,a);const o=e._vsc_data_ctx_size(),_=e._malloc(o);e._vsc_data(_,a,s);const i=e._vscr_error_ctx_size(),c=e._malloc(i);let u;e._vscr_error_reset(c);try{u=e._vscr_ratchet_message_deserialize(_,c);const n=e._vscr_error_status(c);t.RatchetError.handleStatusCode(n);return r.newAndTakeCContext(u)}finally{e._free(a),e._free(_),e._free(c)}}}return r},U=(e,t)=>{class r{constructor(t){this.name="RatchetSession",this.ctxPtr=void 0===t?e._vscr_ratchet_session_new():t}static newAndUseCContext(t){return new r(e._vscr_ratchet_session_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscr_ratchet_session_delete(this.ctxPtr),this.ctxPtr=null)}set rng(r){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureImplementInterface("rng",r,"Foundation.Random",t.FoundationInterfaceTag.RANDOM,t.FoundationInterface),e._vscr_ratchet_session_release_rng(this.ctxPtr),e._vscr_ratchet_session_use_rng(this.ctxPtr,r.ctxPtr)}setupDefaults(){A.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=e._vscr_ratchet_session_setup_defaults(this.ctxPtr);t.RatchetError.handleStatusCode(r)}initiate(r,n,s,a,o,_,i,c,u){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureImplementInterface("senderIdentityPrivateKey",r,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureByteArray("senderIdentityKeyId",n),A.ensureImplementInterface("receiverIdentityPublicKey",s,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureByteArray("receiverIdentityKeyId",a),A.ensureImplementInterface("receiverLongTermPublicKey",o,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureByteArray("receiverLongTermKeyId",_),A.ensureImplementInterface("receiverOneTimePublicKey",i,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureByteArray("receiverOneTimeKeyId",c),A.ensureBoolean("enablePostQuantum",u);const f=n.length*n.BYTES_PER_ELEMENT,l=e._malloc(f);e.HEAP8.set(n,l);const d=e._vsc_data_ctx_size(),h=e._malloc(d);e._vsc_data(h,l,f);const v=a.length*a.BYTES_PER_ELEMENT,w=e._malloc(v);e.HEAP8.set(a,w);const b=e._vsc_data_ctx_size(),m=e._malloc(b);e._vsc_data(m,w,v);const p=_.length*_.BYTES_PER_ELEMENT,y=e._malloc(p);e.HEAP8.set(_,y);const E=e._vsc_data_ctx_size(),P=e._malloc(E);e._vsc_data(P,y,p);const g=c.length*c.BYTES_PER_ELEMENT,I=e._malloc(g);e.HEAP8.set(c,I);const x=e._vsc_data_ctx_size(),C=e._malloc(x);e._vsc_data(C,I,g);try{const n=e._vscr_ratchet_session_initiate(this.ctxPtr,r.ctxPtr,h,s.ctxPtr,m,o.ctxPtr,P,i.ctxPtr,C,u);t.RatchetError.handleStatusCode(n)}finally{e._free(l),e._free(h),e._free(w),e._free(m),e._free(y),e._free(P),e._free(I),e._free(C)}}initiateNoOneTimeKey(r,n,s,a,o,_,i){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureImplementInterface("senderIdentityPrivateKey",r,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureByteArray("senderIdentityKeyId",n),A.ensureImplementInterface("receiverIdentityPublicKey",s,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureByteArray("receiverIdentityKeyId",a),A.ensureImplementInterface("receiverLongTermPublicKey",o,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureByteArray("receiverLongTermKeyId",_),A.ensureBoolean("enablePostQuantum",i);const c=n.length*n.BYTES_PER_ELEMENT,u=e._malloc(c);e.HEAP8.set(n,u);const f=e._vsc_data_ctx_size(),l=e._malloc(f);e._vsc_data(l,u,c);const d=a.length*a.BYTES_PER_ELEMENT,h=e._malloc(d);e.HEAP8.set(a,h);const v=e._vsc_data_ctx_size(),w=e._malloc(v);e._vsc_data(w,h,d);const b=_.length*_.BYTES_PER_ELEMENT,m=e._malloc(b);e.HEAP8.set(_,m);const p=e._vsc_data_ctx_size(),y=e._malloc(p);e._vsc_data(y,m,b);try{const n=e._vscr_ratchet_session_initiate_no_one_time_key(this.ctxPtr,r.ctxPtr,l,s.ctxPtr,w,o.ctxPtr,y,i);t.RatchetError.handleStatusCode(n)}finally{e._free(u),e._free(l),e._free(h),e._free(w),e._free(m),e._free(y)}}respond(r,n,s,a,o,_){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureImplementInterface("senderIdentityPublicKey",r,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureImplementInterface("receiverIdentityPrivateKey",n,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureImplementInterface("receiverLongTermPrivateKey",s,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureImplementInterface("receiverOneTimePrivateKey",a,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureClass("message",o,t.RatchetMessage),A.ensureBoolean("enablePostQuantum",_);const i=e._vscr_ratchet_session_respond(this.ctxPtr,r.ctxPtr,n.ctxPtr,s.ctxPtr,a.ctxPtr,o.ctxPtr,_);t.RatchetError.handleStatusCode(i)}respondNoOneTimeKey(r,n,s,a,o){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureImplementInterface("senderIdentityPublicKey",r,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureImplementInterface("receiverIdentityPrivateKey",n,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureImplementInterface("receiverLongTermPrivateKey",s,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureClass("message",a,t.RatchetMessage),A.ensureBoolean("enablePostQuantum",o);const _=e._vscr_ratchet_session_respond_no_one_time_key(this.ctxPtr,r.ctxPtr,n.ctxPtr,s.ctxPtr,a.ctxPtr,o);t.RatchetError.handleStatusCode(_)}isInitiator(){let t;A.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_session_is_initiator(this.ctxPtr);return!!t}isPqcEnabled(){let t;A.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_session_is_pqc_enabled(this.ctxPtr);return!!t}receivedFirstResponse(){let t;A.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_session_received_first_response(this.ctxPtr);return!!t}receiverHasOneTimePublicKey(){let t;A.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_session_receiver_has_one_time_public_key(this.ctxPtr);return!!t}encrypt(r){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureByteArray("plainText",r);const n=r.length*r.BYTES_PER_ELEMENT,s=e._malloc(n);e.HEAP8.set(r,s);const a=e._vsc_data_ctx_size(),o=e._malloc(a);e._vsc_data(o,s,n);const _=e._vscr_error_ctx_size(),i=e._malloc(_);let c;e._vscr_error_reset(i);try{c=e._vscr_ratchet_session_encrypt(this.ctxPtr,o,i);const r=e._vscr_error_status(i);t.RatchetError.handleStatusCode(r);return t.RatchetMessage.newAndTakeCContext(c)}finally{e._free(s),e._free(o),e._free(i)}}decryptLen(r){let n;return A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureClass("message",r,t.RatchetMessage),n=e._vscr_ratchet_session_decrypt_len(this.ctxPtr,r.ctxPtr),n}decrypt(r){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureClass("message",r,t.RatchetMessage);const n=this.decryptLen(r),s=e._vsc_buffer_new_with_capacity(n);try{const n=e._vscr_ratchet_session_decrypt(this.ctxPtr,r.ctxPtr,s);t.RatchetError.handleStatusCode(n);const a=e._vsc_buffer_bytes(s),o=e._vsc_buffer_len(s);return e.HEAPU8.slice(a,a+o)}finally{e._vsc_buffer_delete(s)}}serialize(){let t;A.ensureNotNull("this.ctxPtr",this.ctxPtr);try{t=e._vscr_ratchet_session_serialize(this.ctxPtr);const r=e._vsc_buffer_len(t),n=e._vsc_buffer_bytes(t);return e.HEAPU8.slice(n,n+r)}finally{e._vsc_buffer_delete(t)}}static deserialize(n){A.ensureByteArray("input",n);const s=n.length*n.BYTES_PER_ELEMENT,a=e._malloc(s);e.HEAP8.set(n,a);const o=e._vsc_data_ctx_size(),_=e._malloc(o);e._vsc_data(_,a,s);const i=e._vscr_error_ctx_size(),c=e._malloc(i);let u;e._vscr_error_reset(c);try{u=e._vscr_ratchet_session_deserialize(_,c);const n=e._vscr_error_status(c);t.RatchetError.handleStatusCode(n);return r.newAndTakeCContext(u)}finally{e._free(a),e._free(_),e._free(c)}}}return r};var Y=e((e=>new Promise(((t,r)=>{x(e).then((e=>{const r={};r.FoundationError=C(),r.FoundationInterface=T(e,r),r.FoundationInterfaceTag=N(),r.FoundationImplTag=R(),r.CtrDrbg=S(e,r),r.Hmac=k(e,r),r.Hkdf=F(e,r),r.Sha512=L(e,r),r.RatchetError=K(),r.MsgType=D(),r.GroupMsgType=O(),r.RatchetCommon=B(),r.RatchetMessage=M(e,r),r.RatchetSession=U(e,r),t(r)})).catch((e=>{r(e)}))}))));module.exports=Y;
