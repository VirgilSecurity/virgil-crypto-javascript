"use strict";function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var libratchet=createCommonjsModule((function(t,e){var r=function(){"undefined"!=typeof document&&document.currentScript&&document.currentScript.src;return function(t){var e;t=t||{},e||(e=void 0!==t?t:{});var r,n={};for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);var s,c,o,i,a;s=__dirname+"/",c=function(t){return i||(i=require("fs")),a||(a=require("path")),t=a.normalize(t),i.readFileSync(t,null)},o=function(t){return(t=c(t)).buffer||(t=new Uint8Array(t)),t.buffer||z("Assertion failed: undefined"),t},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",(function(t){throw t})),process.on("unhandledRejection",z),e.inspect=function(){return"[Emscripten Module object]"};var _=e.print||console.log.bind(console),u=e.printErr||console.warn.bind(console);for(r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);n=null;var l,f={"f64-rem":function(t,e){return t%e},debugger:function(){}};e.wasmBinary&&(l=e.wasmBinary),"object"!=typeof WebAssembly&&u("no native wasm support detected");var p,h,d,m,y,v=new WebAssembly.Table({initial:358,maximum:358,element:"anyfunc"}),w=!1,g="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function P(t,e,r){var n=e+r;for(r=e;t[r]&&!(r>=n);)++r;if(16<r-e&&t.subarray&&g)return g.decode(t.subarray(e,r));for(n="";e<r;){var s=t[e++];if(128&s){var c=63&t[e++];if(192==(224&s))n+=String.fromCharCode((31&s)<<6|c);else{var o=63&t[e++];65536>(s=224==(240&s)?(15&s)<<12|c<<6|o:(7&s)<<18|c<<12|o<<6|63&t[e++])?n+=String.fromCharCode(s):(s-=65536,n+=String.fromCharCode(55296|s>>10,56320|1023&s))}}else n+=String.fromCharCode(s)}return n}function E(t){return 0<t%65536&&(t+=65536-t%65536),t}function x(t){h=t,e.HEAP8=d=new Int8Array(t),e.HEAP16=new Int16Array(t),e.HEAP32=y=new Int32Array(t),e.HEAPU8=m=new Uint8Array(t),e.HEAPU16=new Uint16Array(t),e.HEAPU32=new Uint32Array(t),e.HEAPF32=new Float32Array(t),e.HEAPF64=new Float64Array(t)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var A=e.TOTAL_MEMORY||16777216;function N(t){for(;0<t.length;){var r=t.shift();if("function"==typeof r)r();else{var n=r.Nc;"number"==typeof n?void 0===r.rc?e.dynCall_v(n):e.dynCall_vi(n,r.rc):n(void 0===r.rc?null:r.rc)}}}(p=e.wasmMemory?e.wasmMemory:new WebAssembly.Memory({initial:A/65536}))&&(h=p.buffer),A=h.byteLength,x(h),y[17580]=5313392;var b=[],I=[],C=[],T=[];function R(){var t=e.preRun.shift();b.unshift(t)}var S=Math.abs,k=Math.ceil,F=Math.floor,L=Math.min,M=0,$=null,B=null;function z(t){throw e.onAbort&&e.onAbort(t),_(t),u(t),w=!0,new WebAssembly.RuntimeError("abort("+t+"). Build with -s ASSERTIONS=1 for more info.")}function H(){var t=K;return String.prototype.startsWith?t.startsWith("data:application/octet-stream;base64,"):0===t.indexOf("data:application/octet-stream;base64,")}e.preloadedImages={},e.preloadedAudios={};var D,G,K="libratchet.wasm";if(!H()){var O=K;K=e.locateFile?e.locateFile(O,s):s+O}function U(t,e){for(var r=0,n=t.length-1;0<=n;n--){var s=t[n];"."===s?t.splice(n,1):".."===s?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r;r--)t.unshift("..");return t}function Y(t){var e="/"===t.charAt(0),r="/"===t.substr(-1);return(t=U(t.split("/").filter((function(t){return!!t})),!e).join("/"))||e||(t="."),t&&r&&(t+="/"),(e?"/":"")+t}function j(t){var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1);return t=e[0],e=e[1],t||e?(e&&(e=e.substr(0,e.length-1)),t+e):"."}function W(t){if("/"===t)return"/";var e=t.lastIndexOf("/");return-1===e?t:t.substr(e+1)}function Z(){for(var t="",e=!1,r=arguments.length-1;-1<=r&&!e;r--){if("string"!=typeof(e=0<=r?arguments[r]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!e)return"";t=e+"/"+t,e="/"===e.charAt(0)}return(e?"/":"")+(t=U(t.split("/").filter((function(t){return!!t})),!e).join("/"))||"."}e.asm=function(){function t(t){e.asm=t.exports,M--,e.monitorRunDependencies&&e.monitorRunDependencies(M),0==M&&(null!==$&&(clearInterval($),$=null),B&&(t=B,B=null,t()))}function r(e){t(e.instance)}function n(t){return new Promise((function(t){t:{try{if(l){var e=new Uint8Array(l);break t}if(o){e=o(K);break t}throw"both async and sync fetching of the wasm failed"}catch(t){z(t)}e=void 0}t(e)})).then((function(t){return WebAssembly.instantiate(t,s)})).then(t,(function(t){u("failed to asynchronously prepare wasm: "+t),z(t)}))}var s={env:jt,wasi_unstable:jt,global:{NaN:NaN,Infinity:1/0},"global.Math":Math,asm2wasm:f};if(M++,e.monitorRunDependencies&&e.monitorRunDependencies(M),e.instantiateWasm)try{return e.instantiateWasm(s,t)}catch(t){return u("Module.instantiateWasm callback failed with error: "+t),!1}return function(){if(l||"function"!=typeof WebAssembly.instantiateStreaming||H()||"function"!=typeof fetch)return n(r);fetch(K,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,s).then(r,(function(t){u("wasm streaming compile failed: "+t),u("falling back to ArrayBuffer instantiation"),n(r)}))}))}(),{}};var V=[];function X(t,e){V[t]={input:[],output:[],oc:e},Et(t,q)}var q={open:function(t){var e=V[t.node.rdev];if(!e)throw new at(43);t.tty=e,t.seekable=!1},close:function(t){t.tty.oc.flush(t.tty)},flush:function(t){t.tty.oc.flush(t.tty)},read:function(t,e,r,n){if(!t.tty||!t.tty.oc.Ac)throw new at(60);for(var s=0,c=0;c<n;c++){try{var o=t.tty.oc.Ac(t.tty)}catch(t){throw new at(29)}if(void 0===o&&0===s)throw new at(6);if(null==o)break;s++,e[r+c]=o}return s&&(t.node.timestamp=Date.now()),s},write:function(t,e,r,n){if(!t.tty||!t.tty.oc.tc)throw new at(60);try{for(var s=0;s<n;s++)t.tty.oc.tc(t.tty,e[r+s])}catch(t){throw new at(29)}return n&&(t.node.timestamp=Date.now()),s}},J={Ac:function(t){if(!t.input.length){var e=null,r=Buffer.Fc?Buffer.Fc(256):new Buffer(256),n=0;try{n=i.readSync(process.stdin.fd,r,0,256,null)}catch(t){if(-1==t.toString().indexOf("EOF"))throw t;n=0}if(!(e=0<n?r.slice(0,n).toString("utf-8"):null))return null;for(n=r=0;n<e.length;++n){var s=e.charCodeAt(n);55296<=s&&57343>=s&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++n)),127>=s?++r:r=2047>=s?r+2:65535>=s?r+3:r+4}var c=(r=Array(r+1)).length;if(n=0,0<c){s=n,c=n+c-1;for(var o=0;o<e.length;++o){var a=e.charCodeAt(o);if(55296<=a&&57343>=a)a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o);if(127>=a){if(n>=c)break;r[n++]=a}else{if(2047>=a){if(n+1>=c)break;r[n++]=192|a>>6}else{if(65535>=a){if(n+2>=c)break;r[n++]=224|a>>12}else{if(n+3>=c)break;r[n++]=240|a>>18,r[n++]=128|a>>12&63}r[n++]=128|a>>6&63}r[n++]=128|63&a}}r[n]=0,e=n-s}else e=0;r.length=e,t.input=r}return t.input.shift()},tc:function(t,e){null===e||10===e?(_(P(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&0<t.output.length&&(_(P(t.output,0)),t.output=[])}},Q={tc:function(t,e){null===e||10===e?(u(P(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&0<t.output.length&&(u(P(t.output,0)),t.output=[])}},tt={ic:null,kc:function(){return tt.createNode(null,"/",16895,0)},createNode:function(t,e,r,n){if(24576==(61440&r)||4096==(61440&r))throw new at(63);return tt.ic||(tt.ic={dir:{node:{lc:tt.fc.lc,jc:tt.fc.jc,lookup:tt.fc.lookup,pc:tt.fc.pc,rename:tt.fc.rename,unlink:tt.fc.unlink,rmdir:tt.fc.rmdir,readdir:tt.fc.readdir,symlink:tt.fc.symlink},stream:{mc:tt.gc.mc}},file:{node:{lc:tt.fc.lc,jc:tt.fc.jc},stream:{mc:tt.gc.mc,read:tt.gc.read,write:tt.gc.write,vc:tt.gc.vc,Bc:tt.gc.Bc,Dc:tt.gc.Dc}},link:{node:{lc:tt.fc.lc,jc:tt.fc.jc,readlink:tt.fc.readlink},stream:{}},wc:{node:{lc:tt.fc.lc,jc:tt.fc.jc},stream:Pt}}),16384==(61440&(r=ht(t,e,r,n)).mode)?(r.fc=tt.ic.dir.node,r.gc=tt.ic.dir.stream,r.ec={}):32768==(61440&r.mode)?(r.fc=tt.ic.file.node,r.gc=tt.ic.file.stream,r.hc=0,r.ec=null):40960==(61440&r.mode)?(r.fc=tt.ic.link.node,r.gc=tt.ic.link.stream):8192==(61440&r.mode)&&(r.fc=tt.ic.wc.node,r.gc=tt.ic.wc.stream),r.timestamp=Date.now(),t&&(t.ec[e]=r),r},Oc:function(t){if(t.ec&&t.ec.subarray){for(var e=[],r=0;r<t.hc;++r)e.push(t.ec[r]);return e}return t.ec},Pc:function(t){return t.ec?t.ec.subarray?t.ec.subarray(0,t.hc):new Uint8Array(t.ec):new Uint8Array},xc:function(t,e){var r=t.ec?t.ec.length:0;r>=e||(e=Math.max(e,r*(1048576>r?2:1.125)|0),0!=r&&(e=Math.max(e,256)),r=t.ec,t.ec=new Uint8Array(e),0<t.hc&&t.ec.set(r.subarray(0,t.hc),0))},Jc:function(t,e){if(t.hc!=e)if(0==e)t.ec=null,t.hc=0;else{if(!t.ec||t.ec.subarray){var r=t.ec;t.ec=new Uint8Array(new ArrayBuffer(e)),r&&t.ec.set(r.subarray(0,Math.min(e,t.hc)))}else if(t.ec||(t.ec=[]),t.ec.length>e)t.ec.length=e;else for(;t.ec.length<e;)t.ec.push(0);t.hc=e}},fc:{lc:function(t){var e={};return e.dev=8192==(61440&t.mode)?t.id:1,e.ino=t.id,e.mode=t.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=t.rdev,16384==(61440&t.mode)?e.size=4096:32768==(61440&t.mode)?e.size=t.hc:40960==(61440&t.mode)?e.size=t.link.length:e.size=0,e.atime=new Date(t.timestamp),e.mtime=new Date(t.timestamp),e.ctime=new Date(t.timestamp),e.Ec=4096,e.blocks=Math.ceil(e.size/e.Ec),e},jc:function(t,e){void 0!==e.mode&&(t.mode=e.mode),void 0!==e.timestamp&&(t.timestamp=e.timestamp),void 0!==e.size&&tt.Jc(t,e.size)},lookup:function(){throw _t[44]},pc:function(t,e,r,n){return tt.createNode(t,e,r,n)},rename:function(t,e,r){if(16384==(61440&t.mode)){try{var n=pt(e,r)}catch(t){}if(n)for(var s in n.ec)throw new at(55)}delete t.parent.ec[t.name],t.name=r,e.ec[r]=t,t.parent=e},unlink:function(t,e){delete t.ec[e]},rmdir:function(t,e){var r,n=pt(t,e);for(r in n.ec)throw new at(55);delete t.ec[e]},readdir:function(t){var e,r=[".",".."];for(e in t.ec)t.ec.hasOwnProperty(e)&&r.push(e);return r},symlink:function(t,e,r){return(t=tt.createNode(t,e,41471,0)).link=r,t},readlink:function(t){if(40960!=(61440&t.mode))throw new at(28);return t.link}},gc:{read:function(t,e,r,n,s){var c=t.node.ec;if(s>=t.node.hc)return 0;if(8<(t=Math.min(t.node.hc-s,n))&&c.subarray)e.set(c.subarray(s,s+t),r);else for(n=0;n<t;n++)e[r+n]=c[s+n];return t},write:function(t,e,r,n,s,c){if(e.buffer===d.buffer&&(c=!1),!n)return 0;if((t=t.node).timestamp=Date.now(),e.subarray&&(!t.ec||t.ec.subarray)){if(c)return t.ec=e.subarray(r,r+n),t.hc=n;if(0===t.hc&&0===s)return t.ec=new Uint8Array(e.subarray(r,r+n)),t.hc=n;if(s+n<=t.hc)return t.ec.set(e.subarray(r,r+n),s),n}if(tt.xc(t,s+n),t.ec.subarray&&e.subarray)t.ec.set(e.subarray(r,r+n),s);else for(c=0;c<n;c++)t.ec[s+c]=e[r+c];return t.hc=Math.max(t.hc,s+n),n},mc:function(t,e,r){if(1===r?e+=t.position:2===r&&32768==(61440&t.node.mode)&&(e+=t.node.hc),0>e)throw new at(28);return e},vc:function(t,e,r){tt.xc(t.node,e+r),t.node.hc=Math.max(t.node.hc,e+r)},Bc:function(t,e,r,n,s,c,o){if(32768!=(61440&t.node.mode))throw new at(43);if(r=t.node.ec,2&o||r.buffer!==e.buffer){if((0<s||s+n<t.node.hc)&&(r=r.subarray?r.subarray(s,s+n):Array.prototype.slice.call(r,s,s+n)),t=!0,s=e.buffer==d.buffer,!(n=Vt(n)))throw new at(48);(s?d:e).set(r,n)}else t=!1,n=r.byteOffset;return{Rc:n,Mc:t}},Dc:function(t,e,r,n,s){if(32768!=(61440&t.node.mode))throw new at(43);return 2&s?0:(tt.gc.write(t,e,0,n,r,!1),0)}}},et=null,rt={},nt=[],st=1,ct=null,ot=!0,it={},at=null,_t={};function ut(t,e){if(e=e||{},!(t=Z("/",t)))return{path:"",node:null};var r,n={zc:!0,uc:0};for(r in n)void 0===e[r]&&(e[r]=n[r]);if(8<e.uc)throw new at(32);t=U(t.split("/").filter((function(t){return!!t})),!1);var s=et;for(n="/",r=0;r<t.length;r++){var c=r===t.length-1;if(c&&e.parent)break;if(s=pt(s,t[r]),n=Y(n+"/"+t[r]),s.qc&&(!c||c&&e.zc)&&(s=s.qc.root),!c||e.yc)for(c=0;40960==(61440&s.mode);)if(s=Ct(n),s=ut(n=Z(j(n),s),{uc:e.uc}).node,40<c++)throw new at(32)}return{path:n,node:s}}function lt(t){for(var e;;){if(t===t.parent)return t=t.kc.Cc,e?"/"!==t[t.length-1]?t+"/"+e:t+e:t;e=e?t.name+"/"+e:t.name,t=t.parent}}function ft(t,e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)|0;return(t+r>>>0)%ct.length}function pt(t,e){var r;if(r=(r=yt(t,"x"))?r:t.fc.lookup?0:2)throw new at(r,t);for(r=ct[ft(t.id,e)];r;r=r.Ic){var n=r.name;if(r.parent.id===t.id&&n===e)return r}return t.fc.lookup(t,e)}function ht(t,e,r,n){return Lt||((Lt=function(t,e,r,n){t||(t=this),this.parent=t,this.kc=t.kc,this.qc=null,this.id=st++,this.name=e,this.mode=r,this.fc={},this.gc={},this.rdev=n}).prototype={},Object.defineProperties(Lt.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(t){t?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(t){t?this.mode|=146:this.mode&=-147}}})),function(t){var e=ft(t.parent.id,t.name);t.Ic=ct[e],ct[e]=t}(t=new Lt(t,e,r,n)),t}var dt={r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218};function mt(t){var e=["r","w","rw"][3&t];return 512&t&&(e+="w"),e}function yt(t,e){return ot?0:(-1===e.indexOf("r")||292&t.mode)&&(-1===e.indexOf("w")||146&t.mode)&&(-1===e.indexOf("x")||73&t.mode)?0:2}function vt(t,e){try{return pt(t,e),20}catch(t){}return yt(t,"wx")}function wt(t){Mt||((Mt=function(){}).prototype={},Object.defineProperties(Mt.prototype,{object:{get:function(){return this.node},set:function(t){this.node=t}}}));var e,r=new Mt;for(e in t)r[e]=t[e];return t=r,r=function(){for(var t=0;t<=4096;t++)if(!nt[t])return t;throw new at(33)}(),t.fd=r,nt[r]=t}var gt,Pt={open:function(t){t.gc=rt[t.node.rdev].gc,t.gc.open&&t.gc.open(t)},mc:function(){throw new at(70)}};function Et(t,e){rt[t]={gc:e}}function xt(t,e){var r="/"===e,n=!e;if(r&&et)throw new at(10);if(!r&&!n){var s=ut(e,{zc:!1});if(e=s.path,(s=s.node).qc)throw new at(10);if(16384!=(61440&s.mode))throw new at(54)}e={type:t,Qc:{},Cc:e,Hc:[]},(t=t.kc(e)).kc=e,e.root=t,r?et=t:s&&(s.qc=e,s.kc&&s.kc.Hc.push(e))}function At(t,e,r){var n=ut(t,{parent:!0}).node;if(!(t=W(t))||"."===t||".."===t)throw new at(28);var s=vt(n,t);if(s)throw new at(s);if(!n.fc.pc)throw new at(63);return n.fc.pc(n,t,e,r)}function Nt(t){At(t,16895,0)}function bt(t,e,r){void 0===r&&(r=e,e=438),At(t,8192|e,r)}function It(t,e){if(!Z(t))throw new at(44);var r=ut(e,{parent:!0}).node;if(!r)throw new at(44);var n=vt(r,e=W(e));if(n)throw new at(n);if(!r.fc.symlink)throw new at(63);r.fc.symlink(r,e,t)}function Ct(t){if(!(t=ut(t).node))throw new at(44);if(!t.fc.readlink)throw new at(28);return Z(lt(t.parent),t.fc.readlink(t))}function Tt(t,r,n){if(""===t)throw new at(44);if("string"==typeof r){var s=dt[r];if(void 0===s)throw Error("Unknown file open mode: "+r);r=s}if(n=64&r?4095&(void 0===n?438:n)|32768:0,"object"==typeof t)var c=t;else{t=Y(t);try{c=ut(t,{yc:!(131072&r)}).node}catch(t){}}if(s=!1,64&r)if(c){if(128&r)throw new at(20)}else c=At(t,n,0),s=!0;if(!c)throw new at(44);if(8192==(61440&c.mode)&&(r&=-513),65536&r&&16384!=(61440&c.mode))throw new at(54);if(!s&&(n=c?40960==(61440&c.mode)?32:16384==(61440&c.mode)&&("r"!==mt(r)||512&r)?31:yt(c,mt(r)):44))throw new at(n);if(512&r){var o;if(!(o="string"==typeof(n=c)?ut(n,{yc:!0}).node:n).fc.jc)throw new at(63);if(16384==(61440&o.mode))throw new at(31);if(32768!=(61440&o.mode))throw new at(28);if(n=yt(o,"w"))throw new at(n);o.fc.jc(o,{size:0,timestamp:Date.now()})}r&=-641,(c=wt({node:c,path:lt(c),flags:r,seekable:!0,position:0,gc:c.gc,Lc:[],error:!1})).gc.open&&c.gc.open(c),!e.logReadFiles||1&r||($t||($t={}),t in $t||($t[t]=1,console.log("FS.trackingDelegate error on read file: "+t)));try{it.onOpenFile&&(o=0,1!=(2097155&r)&&(o|=1),0!=(2097155&r)&&(o|=2),it.onOpenFile(t,o))}catch(e){console.log("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return c}function Rt(t,e,r){if(null===t.fd)throw new at(8);if(!t.seekable||!t.gc.mc)throw new at(70);if(0!=r&&1!=r&&2!=r)throw new at(28);t.position=t.gc.mc(t,e,r),t.Lc=[]}function St(){at||((at=function(t,e){this.node=e,this.Kc=function(t){this.nc=t},this.Kc(t),this.message="FS error"}).prototype=Error(),at.prototype.constructor=at,[44].forEach((function(t){_t[t]=new at(t),_t[t].stack="<generic error, no stack>"})))}function kt(t,e,r){t=Y("/dev/"+t);var n=function(t,e){var r=0;return t&&(r|=365),e&&(r|=146),r}(!!e,!!r);Ft||(Ft=64);var s=Ft++<<8|0;Et(s,{open:function(t){t.seekable=!1},close:function(){r&&r.buffer&&r.buffer.length&&r(10)},read:function(t,r,n,s){for(var c=0,o=0;o<s;o++){try{var i=e()}catch(t){throw new at(29)}if(void 0===i&&0===c)throw new at(6);if(null==i)break;c++,r[n+o]=i}return c&&(t.node.timestamp=Date.now()),c},write:function(t,e,n,s){for(var c=0;c<s;c++)try{r(e[n+c])}catch(t){throw new at(29)}return s&&(t.node.timestamp=Date.now()),c}}),bt(t,n,s)}var Ft,Lt,Mt,$t,Bt={},zt=0;function Ht(){return y[(zt+=4)-4>>2]}function Dt(t){if(void 0===t&&(t=Ht()),!(t=nt[t]))throw new at(8);return t}function Gt(t){try{var e=Dt(t);if(null===e.fd)throw new at(8);e.sc&&(e.sc=null);try{e.gc.close&&e.gc.close(e)}catch(t){throw t}finally{nt[e.fd]=null}return e.fd=null,0}catch(t){return void 0!==Bt&&t instanceof at||z(t),t.nc}}function Kt(t,e,r,n){try{t:{for(var s=Dt(t),c=t=0;c<r;c++){var o=y[e+(8*c+4)>>2],i=s,a=y[e+8*c>>2],_=o,u=void 0,l=d;if(0>_||0>u)throw new at(28);if(null===i.fd)throw new at(8);if(1==(2097155&i.flags))throw new at(8);if(16384==(61440&i.node.mode))throw new at(31);if(!i.gc.read)throw new at(28);var f=void 0!==u;if(f){if(!i.seekable)throw new at(70)}else u=i.position;var p=i.gc.read(i,l,a,_,u);f||(i.position+=p);var h=p;if(0>h){var m=-1;break t}if(t+=h,h<o)break}m=t}return y[n>>2]=m,0}catch(t){return void 0!==Bt&&t instanceof at||z(t),t.nc}}function Ot(t,e,r,n,s){try{var c=Dt(t);return-9007199254740992>=(t=4294967296*r+(e>>>0))||9007199254740992<=t?-61:(Rt(c,t,n),G=[c.position>>>0,(D=c.position,1<=+S(D)?0<D?(0|L(+F(D/4294967296),4294967295))>>>0:~~+k((D-+(~~D>>>0))/4294967296)>>>0:0)],y[s>>2]=G[0],y[s+4>>2]=G[1],c.sc&&0===t&&0===n&&(c.sc=null),0)}catch(t){return void 0!==Bt&&t instanceof at||z(t),t.nc}}function Ut(t,e,r,n){try{t:{for(var s=Dt(t),c=t=0;c<r;c++){var o=s,i=y[e+8*c>>2],a=y[e+(8*c+4)>>2],_=void 0,u=d;if(0>a||0>_)throw new at(28);if(null===o.fd)throw new at(8);if(0==(2097155&o.flags))throw new at(8);if(16384==(61440&o.node.mode))throw new at(31);if(!o.gc.write)throw new at(28);1024&o.flags&&Rt(o,0,2);var l=void 0!==_;if(l){if(!o.seekable)throw new at(70)}else _=o.position;var f=o.gc.write(o,u,i,a,_,void 0);l||(o.position+=f);try{o.path&&it.onWriteToFile&&it.onWriteToFile(o.path)}catch(t){console.log("FS.trackingDelegate['onWriteToFile']('"+o.path+"') threw an exception: "+t.message)}var p=f;if(0>p){var h=-1;break t}t+=p}h=t}return y[n>>2]=h,0}catch(t){return void 0!==Bt&&t instanceof at||z(t),t.nc}}function Yt(){return d.length}St(),ct=Array(4096),xt(tt,"/"),Nt("/tmp"),Nt("/home"),Nt("/home/web_user"),function(){if(Nt("/dev"),Et(259,{read:function(){return 0},write:function(t,e,r,n){return n}}),bt("/dev/null",259),X(1280,J),X(1536,Q),bt("/dev/tty",1280),bt("/dev/tty1",1536),"object"==typeof crypto&&"function"==typeof crypto.getRandomValues)var t=new Uint8Array(1),e=function(){return crypto.getRandomValues(t),t[0]};else try{var r=require("crypto");e=function(){return r.randomBytes(1)[0]}}catch(t){}e||(e=function(){z("random_device")}),kt("random",e),kt("urandom",e),Nt("/dev/shm"),Nt("/dev/shm/tmp")}(),Nt("/proc"),Nt("/proc/self"),Nt("/proc/self/fd"),xt({kc:function(){var t=ht("/proc/self","fd",16895,73);return t.fc={lookup:function(t,e){var r=nt[+e];if(!r)throw new at(8);return(t={parent:null,kc:{Cc:"fake"},fc:{readlink:function(){return r.path}}}).parent=t}},t}},"/proc/self/fd");var jt={c:function(){},k:function(t,e){zt=e;try{var r=Ht();return Tt(r?P(m,r,void 0):"",Ht(),Ht()).fd}catch(t){return void 0!==Bt&&t instanceof at||z(t),-t.nc}},j:function(t,e){zt=e;try{var r=Dt(),n=Ht();switch(n){case 21509:case 21505:return r.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return r.tty?0:-59;case 21519:if(!r.tty)return-59;var s=Ht();return y[s>>2]=0;case 21520:return r.tty?-28:-59;case 21531:if(t=s=Ht(),!r.gc.Gc)throw new at(59);return r.gc.Gc(r,n,t);case 21523:case 21524:return r.tty?0:-59;default:z("bad ioctl syscall "+n)}}catch(t){return void 0!==Bt&&t instanceof at||z(t),-t.nc}},b:function(){},d:function(){return Gt.apply(null,arguments)},i:function(){return Kt.apply(null,arguments)},l:function(){return Ot.apply(null,arguments)},h:function(){return Ut.apply(null,arguments)},__memory_base:1024,__table_base:0,g:function(){z()},f:Yt,n:function(t,e,r){m.set(m.subarray(e,e+r),t)},m:function(t){if(2147418112<t)return!1;for(var e=Math.max(Yt(),16777216);e<t;)e=536870912>=e?E(2*e):Math.min(E((3*e+2147483648)/4),2147418112);t:{try{p.grow(e-h.byteLength+65535>>16),x(p.buffer);var r=1;break t}catch(t){}r=void 0}return!!r},e:function(t){var e=Date.now();return y[t>>2]=e/1e3|0,y[t+4>>2]=e%1e3*1e3|0,0},a:z,memory:p,table:v},Wt=e.asm({},jt,h);e.asm=Wt,e.___errno_location=function(){return e.asm.o.apply(null,arguments)},e._free=function(){return e.asm.p.apply(null,arguments)};var Zt,Vt=e._malloc=function(){return e.asm.q.apply(null,arguments)};function Xt(){function t(){if(!Zt&&(Zt=!0,!w)){if(e.noFSInit||gt||(gt=!0,St(),e.stdin=e.stdin,e.stdout=e.stdout,e.stderr=e.stderr,e.stdin?kt("stdin",e.stdin):It("/dev/tty","/dev/stdin"),e.stdout?kt("stdout",null,e.stdout):It("/dev/tty","/dev/stdout"),e.stderr?kt("stderr",null,e.stderr):It("/dev/tty1","/dev/stderr"),Tt("/dev/stdin","r"),Tt("/dev/stdout","w"),Tt("/dev/stderr","w")),N(I),ot=!1,N(C),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;){var t=e.postRun.shift();T.unshift(t)}N(T)}}if(!(0<M)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)R();N(b),0<M||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),t()}),1)):t())}}if(e._vsc_buffer_bytes=function(){return e.asm.r.apply(null,arguments)},e._vsc_buffer_data=function(){return e.asm.s.apply(null,arguments)},e._vsc_buffer_delete=function(){return e.asm.t.apply(null,arguments)},e._vsc_buffer_len=function(){return e.asm.u.apply(null,arguments)},e._vsc_buffer_make_secure=function(){return e.asm.v.apply(null,arguments)},e._vsc_buffer_new=function(){return e.asm.w.apply(null,arguments)},e._vsc_buffer_new_with_capacity=function(){return e.asm.x.apply(null,arguments)},e._vsc_data=function(){return e.asm.y.apply(null,arguments)},e._vsc_data_bytes=function(){return e.asm.z.apply(null,arguments)},e._vsc_data_ctx_size=function(){return e.asm.A.apply(null,arguments)},e._vsc_data_len=function(){return e.asm.B.apply(null,arguments)},e._vscf_ctr_drbg_delete=function(){return e.asm.C.apply(null,arguments)},e._vscf_ctr_drbg_enable_prediction_resistance=function(){return e.asm.D.apply(null,arguments)},e._vscf_ctr_drbg_new=function(){return e.asm.E.apply(null,arguments)},e._vscf_ctr_drbg_random=function(){return e.asm.F.apply(null,arguments)},e._vscf_ctr_drbg_release_entropy_source=function(){return e.asm.G.apply(null,arguments)},e._vscf_ctr_drbg_reseed=function(){return e.asm.H.apply(null,arguments)},e._vscf_ctr_drbg_set_entropy_len=function(){return e.asm.I.apply(null,arguments)},e._vscf_ctr_drbg_set_reseed_interval=function(){return e.asm.J.apply(null,arguments)},e._vscf_ctr_drbg_setup_defaults=function(){return e.asm.K.apply(null,arguments)},e._vscf_ctr_drbg_shallow_copy=function(){return e.asm.L.apply(null,arguments)},e._vscf_ctr_drbg_use_entropy_source=function(){return e.asm.M.apply(null,arguments)},e._vscf_error_ctx_size=function(){return e.asm.N.apply(null,arguments)},e._vscf_error_reset=function(){return e.asm.O.apply(null,arguments)},e._vscf_error_status=function(){return e.asm.P.apply(null,arguments)},e._vscf_hkdf_alg_id=function(){return e.asm.Q.apply(null,arguments)},e._vscf_hkdf_delete=function(){return e.asm.R.apply(null,arguments)},e._vscf_hkdf_derive=function(){return e.asm.S.apply(null,arguments)},e._vscf_hkdf_new=function(){return e.asm.T.apply(null,arguments)},e._vscf_hkdf_produce_alg_info=function(){return e.asm.U.apply(null,arguments)},e._vscf_hkdf_release_hash=function(){return e.asm.V.apply(null,arguments)},e._vscf_hkdf_reset=function(){return e.asm.W.apply(null,arguments)},e._vscf_hkdf_restore_alg_info=function(){return e.asm.X.apply(null,arguments)},e._vscf_hkdf_set_info=function(){return e.asm.Y.apply(null,arguments)},e._vscf_hkdf_shallow_copy=function(){return e.asm.Z.apply(null,arguments)},e._vscf_hkdf_use_hash=function(){return e.asm._.apply(null,arguments)},e._vscf_hmac_alg_id=function(){return e.asm.$.apply(null,arguments)},e._vscf_hmac_delete=function(){return e.asm.aa.apply(null,arguments)},e._vscf_hmac_digest_len=function(){return e.asm.ba.apply(null,arguments)},e._vscf_hmac_finish=function(){return e.asm.ca.apply(null,arguments)},e._vscf_hmac_mac=function(){return e.asm.da.apply(null,arguments)},e._vscf_hmac_new=function(){return e.asm.ea.apply(null,arguments)},e._vscf_hmac_produce_alg_info=function(){return e.asm.fa.apply(null,arguments)},e._vscf_hmac_release_hash=function(){return e.asm.ga.apply(null,arguments)},e._vscf_hmac_reset=function(){return e.asm.ha.apply(null,arguments)},e._vscf_hmac_restore_alg_info=function(){return e.asm.ia.apply(null,arguments)},e._vscf_hmac_shallow_copy=function(){return e.asm.ja.apply(null,arguments)},e._vscf_hmac_start=function(){return e.asm.ka.apply(null,arguments)},e._vscf_hmac_update=function(){return e.asm.la.apply(null,arguments)},e._vscf_hmac_use_hash=function(){return e.asm.ma.apply(null,arguments)},e._vscf_impl_api=function(){return e.asm.na.apply(null,arguments)},e._vscf_impl_shallow_copy=function(){return e.asm.oa.apply(null,arguments)},e._vscf_impl_tag=function(){return e.asm.pa.apply(null,arguments)},e._vscf_sha512_alg_id=function(){return e.asm.qa.apply(null,arguments)},e._vscf_sha512_delete=function(){return e.asm.ra.apply(null,arguments)},e._vscf_sha512_finish=function(){return e.asm.sa.apply(null,arguments)},e._vscf_sha512_hash=function(){return e.asm.ta.apply(null,arguments)},e._vscf_sha512_new=function(){return e.asm.ua.apply(null,arguments)},e._vscf_sha512_produce_alg_info=function(){return e.asm.va.apply(null,arguments)},e._vscf_sha512_restore_alg_info=function(){return e.asm.wa.apply(null,arguments)},e._vscf_sha512_shallow_copy=function(){return e.asm.xa.apply(null,arguments)},e._vscf_sha512_start=function(){return e.asm.ya.apply(null,arguments)},e._vscf_sha512_update=function(){return e.asm.za.apply(null,arguments)},e._vscr_error_ctx_size=function(){return e.asm.Aa.apply(null,arguments)},e._vscr_error_reset=function(){return e.asm.Ba.apply(null,arguments)},e._vscr_error_status=function(){return e.asm.Ca.apply(null,arguments)},e._vscr_ratchet_group_message_delete=function(){return e.asm.Da.apply(null,arguments)},e._vscr_ratchet_group_message_deserialize=function(){return e.asm.Ea.apply(null,arguments)},e._vscr_ratchet_group_message_get_counter=function(){return e.asm.Fa.apply(null,arguments)},e._vscr_ratchet_group_message_get_epoch=function(){return e.asm.Ga.apply(null,arguments)},e._vscr_ratchet_group_message_get_session_id=function(){return e.asm.Ha.apply(null,arguments)},e._vscr_ratchet_group_message_get_type=function(){return e.asm.Ia.apply(null,arguments)},e._vscr_ratchet_group_message_new=function(){return e.asm.Ja.apply(null,arguments)},e._vscr_ratchet_group_message_serialize=function(){return e.asm.Ka.apply(null,arguments)},e._vscr_ratchet_group_message_serialize_len=function(){return e.asm.La.apply(null,arguments)},e._vscr_ratchet_group_message_shallow_copy=function(){return e.asm.Ma.apply(null,arguments)},e._vscr_ratchet_group_participants_ids_add_id=function(){return e.asm.Na.apply(null,arguments)},e._vscr_ratchet_group_participants_ids_delete=function(){return e.asm.Oa.apply(null,arguments)},e._vscr_ratchet_group_participants_ids_new=function(){return e.asm.Pa.apply(null,arguments)},e._vscr_ratchet_group_participants_ids_new_size=function(){return e.asm.Qa.apply(null,arguments)},e._vscr_ratchet_group_participants_ids_shallow_copy=function(){return e.asm.Ra.apply(null,arguments)},e._vscr_ratchet_group_participants_info_add_participant=function(){return e.asm.Sa.apply(null,arguments)},e._vscr_ratchet_group_participants_info_delete=function(){return e.asm.Ta.apply(null,arguments)},e._vscr_ratchet_group_participants_info_new=function(){return e.asm.Ua.apply(null,arguments)},e._vscr_ratchet_group_participants_info_new_size=function(){return e.asm.Va.apply(null,arguments)},e._vscr_ratchet_group_participants_info_shallow_copy=function(){return e.asm.Wa.apply(null,arguments)},e._vscr_ratchet_group_session_create_group_ticket=function(){return e.asm.Xa.apply(null,arguments)},e._vscr_ratchet_group_session_decrypt=function(){return e.asm.Ya.apply(null,arguments)},e._vscr_ratchet_group_session_decrypt_len=function(){return e.asm.Za.apply(null,arguments)},e._vscr_ratchet_group_session_delete=function(){return e.asm._a.apply(null,arguments)},e._vscr_ratchet_group_session_deserialize=function(){return e.asm.$a.apply(null,arguments)},e._vscr_ratchet_group_session_encrypt=function(){return e.asm.ab.apply(null,arguments)},e._vscr_ratchet_group_session_get_current_epoch=function(){return e.asm.bb.apply(null,arguments)},e._vscr_ratchet_group_session_get_my_id=function(){return e.asm.cb.apply(null,arguments)},e._vscr_ratchet_group_session_get_participants_count=function(){return e.asm.db.apply(null,arguments)},e._vscr_ratchet_group_session_get_session_id=function(){return e.asm.eb.apply(null,arguments)},e._vscr_ratchet_group_session_is_initialized=function(){return e.asm.fb.apply(null,arguments)},e._vscr_ratchet_group_session_is_my_id_set=function(){return e.asm.gb.apply(null,arguments)},e._vscr_ratchet_group_session_is_private_key_set=function(){return e.asm.hb.apply(null,arguments)},e._vscr_ratchet_group_session_new=function(){return e.asm.ib.apply(null,arguments)},e._vscr_ratchet_group_session_release_rng=function(){return e.asm.jb.apply(null,arguments)},e._vscr_ratchet_group_session_serialize=function(){return e.asm.kb.apply(null,arguments)},e._vscr_ratchet_group_session_set_my_id=function(){return e.asm.lb.apply(null,arguments)},e._vscr_ratchet_group_session_set_private_key=function(){return e.asm.mb.apply(null,arguments)},e._vscr_ratchet_group_session_setup_defaults=function(){return e.asm.nb.apply(null,arguments)},e._vscr_ratchet_group_session_setup_session_state=function(){return e.asm.ob.apply(null,arguments)},e._vscr_ratchet_group_session_shallow_copy=function(){return e.asm.pb.apply(null,arguments)},e._vscr_ratchet_group_session_update_session_state=function(){return e.asm.qb.apply(null,arguments)},e._vscr_ratchet_group_session_use_rng=function(){return e.asm.rb.apply(null,arguments)},e._vscr_ratchet_group_ticket_delete=function(){return e.asm.sb.apply(null,arguments)},e._vscr_ratchet_group_ticket_get_ticket_message=function(){return e.asm.tb.apply(null,arguments)},e._vscr_ratchet_group_ticket_new=function(){return e.asm.ub.apply(null,arguments)},e._vscr_ratchet_group_ticket_release_rng=function(){return e.asm.vb.apply(null,arguments)},e._vscr_ratchet_group_ticket_setup_defaults=function(){return e.asm.wb.apply(null,arguments)},e._vscr_ratchet_group_ticket_setup_ticket_as_new=function(){return e.asm.xb.apply(null,arguments)},e._vscr_ratchet_group_ticket_shallow_copy=function(){return e.asm.yb.apply(null,arguments)},e._vscr_ratchet_group_ticket_use_rng=function(){return e.asm.zb.apply(null,arguments)},e._vscr_ratchet_key_id_compute_public_key_id=function(){return e.asm.Ab.apply(null,arguments)},e._vscr_ratchet_key_id_delete=function(){return e.asm.Bb.apply(null,arguments)},e._vscr_ratchet_key_id_new=function(){return e.asm.Cb.apply(null,arguments)},e._vscr_ratchet_key_id_shallow_copy=function(){return e.asm.Db.apply(null,arguments)},e._vscr_ratchet_message_delete=function(){return e.asm.Eb.apply(null,arguments)},e._vscr_ratchet_message_deserialize=function(){return e.asm.Fb.apply(null,arguments)},e._vscr_ratchet_message_get_counter=function(){return e.asm.Gb.apply(null,arguments)},e._vscr_ratchet_message_get_long_term_public_key=function(){return e.asm.Hb.apply(null,arguments)},e._vscr_ratchet_message_get_one_time_public_key=function(){return e.asm.Ib.apply(null,arguments)},e._vscr_ratchet_message_get_type=function(){return e.asm.Jb.apply(null,arguments)},e._vscr_ratchet_message_new=function(){return e.asm.Kb.apply(null,arguments)},e._vscr_ratchet_message_serialize=function(){return e.asm.Lb.apply(null,arguments)},e._vscr_ratchet_message_serialize_len=function(){return e.asm.Mb.apply(null,arguments)},e._vscr_ratchet_message_shallow_copy=function(){return e.asm.Nb.apply(null,arguments)},e._vscr_ratchet_session_decrypt=function(){return e.asm.Ob.apply(null,arguments)},e._vscr_ratchet_session_decrypt_len=function(){return e.asm.Pb.apply(null,arguments)},e._vscr_ratchet_session_delete=function(){return e.asm.Qb.apply(null,arguments)},e._vscr_ratchet_session_deserialize=function(){return e.asm.Rb.apply(null,arguments)},e._vscr_ratchet_session_encrypt=function(){return e.asm.Sb.apply(null,arguments)},e._vscr_ratchet_session_initiate=function(){return e.asm.Tb.apply(null,arguments)},e._vscr_ratchet_session_is_initiator=function(){return e.asm.Ub.apply(null,arguments)},e._vscr_ratchet_session_new=function(){return e.asm.Vb.apply(null,arguments)},e._vscr_ratchet_session_received_first_response=function(){return e.asm.Wb.apply(null,arguments)},e._vscr_ratchet_session_receiver_has_one_time_public_key=function(){return e.asm.Xb.apply(null,arguments)},e._vscr_ratchet_session_release_rng=function(){return e.asm.Yb.apply(null,arguments)},e._vscr_ratchet_session_respond=function(){return e.asm.Zb.apply(null,arguments)},e._vscr_ratchet_session_serialize=function(){return e.asm._b.apply(null,arguments)},e._vscr_ratchet_session_setup_defaults=function(){return e.asm.$b.apply(null,arguments)},e._vscr_ratchet_session_shallow_copy=function(){return e.asm.ac.apply(null,arguments)},e._vscr_ratchet_session_use_rng=function(){return e.asm.bc.apply(null,arguments)},e.stackAlloc=function(){return e.asm.dc.apply(null,arguments)},e.dynCall_vi=function(){return e.asm.cc.apply(null,arguments)},e.asm=Wt,e.then=function(t){if(Zt)t(e);else{var r=e.onRuntimeInitialized;e.onRuntimeInitialized=function(){r&&r(),t(e)}}return e},B=function t(){Zt||Xt(),Zt||(B=t)},e.run=Xt,e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();return Xt(),t}}();t.exports=r}));const initFoundationError=(t,e)=>{class r extends Error{constructor(t){super(t),this.name="FoundationError",this.message=t}static handleStatusCode(t){if(0!=t){if(-1==t)throw new r("This error should not be returned if assertions is enabled.");if(-2==t)throw new r("Can be used to define that not all context prerequisites are satisfied. Note, this error should not be returned if assertions is enabled.");if(-3==t)throw new r("Define that error code from one of third-party module was not handled. Note, this error should not be returned if assertions is enabled.");if(-101==t)throw new r("Buffer capacity is not enough to hold result.");if(-200==t)throw new r("Unsupported algorithm.");if(-201==t)throw new r("Authentication failed during decryption.");if(-202==t)throw new r("Attempt to read data out of buffer bounds.");if(-203==t)throw new r("ASN.1 encoded data is corrupted.");if(-204==t)throw new r("Attempt to read ASN.1 type that is bigger then requested C type.");if(-205==t)throw new r("ASN.1 representation of PKCS#1 public key is corrupted.");if(-206==t)throw new r("ASN.1 representation of PKCS#1 private key is corrupted.");if(-207==t)throw new r("ASN.1 representation of PKCS#8 public key is corrupted.");if(-208==t)throw new r("ASN.1 representation of PKCS#8 private key is corrupted.");if(-209==t)throw new r("Encrypted data is corrupted.");if(-210==t)throw new r("Underlying random operation returns error.");if(-211==t)throw new r("Generation of the private or secret key failed.");if(-212==t)throw new r("One of the entropy sources failed.");if(-213==t)throw new r("Requested data to be generated is too big.");if(-214==t)throw new r("Base64 encoded string contains invalid characters.");if(-215==t)throw new r("PEM data is corrupted.");if(-216==t)throw new r("Exchange key return zero.");if(-217==t)throw new r("Ed25519 public key is corrupted.");if(-218==t)throw new r("Ed25519 private key is corrupted.");if(-219==t)throw new r("CURVE25519 public key is corrupted.");if(-220==t)throw new r("CURVE25519 private key is corrupted.");if(-221==t)throw new r("Elliptic curve public key format is corrupted see RFC 5480.");if(-222==t)throw new r("Elliptic curve public key format is corrupted see RFC 5915.");if(-223==t)throw new r("ASN.1 representation of a public key is corrupted.");if(-224==t)throw new r("ASN.1 representation of a private key is corrupted.");if(-225==t)throw new r("Key algorithm does not accept given type of public key.");if(-226==t)throw new r("Key algorithm does not accept given type of private key.");if(-301==t)throw new r("Decryption failed, because message info was not given explicitly, and was not part of an encrypted message.");if(-302==t)throw new r("Message Info is corrupted.");if(-303==t)throw new r("Recipient defined with id is not found within message info during data decryption.");if(-304==t)throw new r("Content encryption key can not be decrypted with a given private key.");if(-305==t)throw new r("Content encryption key can not be decrypted with a given password.");if(-306==t)throw new r("Custom parameter with a given key is not found within message info.");if(-307==t)throw new r("A custom parameter with a given key is found, but the requested value type does not correspond to the actual type.");if(-308==t)throw new r("Signature format is corrupted.");if(-309==t)throw new r("Message Info footer is corrupted.");if(-401==t)throw new r("Brainkey password length is out of range.");if(-402==t)throw new r("Brainkey number length should be 32 byte.");if(-403==t)throw new r("Brainkey point length should be 65 bytes.");if(-404==t)throw new r("Brainkey name is out of range.");if(-405==t)throw new r("Brainkey internal error.");if(-406==t)throw new r("Brainkey point is invalid.");if(-407==t)throw new r("Brainkey number buffer length capacity should be >= 32 byte.");if(-408==t)throw new r("Brainkey point buffer length capacity should be >= 32 byte.");if(-409==t)throw new r("Brainkey seed buffer length capacity should be >= 32 byte.");if(-410==t)throw new r("Brainkey identity secret is invalid.");if(-501==t)throw new r("Invalid padding.");if(-601==t)throw new r("Protobuf error.");if(-701==t)throw new r("Session id doesnt match.");if(-702==t)throw new r("Epoch not found.");if(-703==t)throw new r("Wrong key type.");if(-704==t)throw new r("Invalid signature.");if(-705==t)throw new r("Ed25519 error.");if(-706==t)throw new r("Duplicate epoch.");if(-707==t)throw new r("Plain text too long.");throw new r("Unexpected status code:"+t)}}}return r};var FoundationError=initFoundationError;const initFoundationInterface=(t,e)=>{return class{static newAndTakeCContext(r){const n=t._vscf_impl_tag(r);switch(n){case e.FoundationImplTag.SHA224:return e.Sha224.newAndTakeCContext(r);case e.FoundationImplTag.SHA256:return e.Sha256.newAndTakeCContext(r);case e.FoundationImplTag.SHA384:return e.Sha384.newAndTakeCContext(r);case e.FoundationImplTag.SHA512:return e.Sha512.newAndTakeCContext(r);case e.FoundationImplTag.AES256_GCM:return e.Aes256Gcm.newAndTakeCContext(r);case e.FoundationImplTag.AES256_CBC:return e.Aes256Cbc.newAndTakeCContext(r);case e.FoundationImplTag.ASN1RD:return e.Asn1rd.newAndTakeCContext(r);case e.FoundationImplTag.ASN1WR:return e.Asn1wr.newAndTakeCContext(r);case e.FoundationImplTag.RSA_PUBLIC_KEY:return e.RsaPublicKey.newAndTakeCContext(r);case e.FoundationImplTag.RSA_PRIVATE_KEY:return e.RsaPrivateKey.newAndTakeCContext(r);case e.FoundationImplTag.RSA:return e.Rsa.newAndTakeCContext(r);case e.FoundationImplTag.ECC_PUBLIC_KEY:return e.EccPublicKey.newAndTakeCContext(r);case e.FoundationImplTag.ECC_PRIVATE_KEY:return e.EccPrivateKey.newAndTakeCContext(r);case e.FoundationImplTag.ECC:return e.Ecc.newAndTakeCContext(r);case e.FoundationImplTag.ENTROPY_ACCUMULATOR:return e.EntropyAccumulator.newAndTakeCContext(r);case e.FoundationImplTag.CTR_DRBG:return e.CtrDrbg.newAndTakeCContext(r);case e.FoundationImplTag.HMAC:return e.Hmac.newAndTakeCContext(r);case e.FoundationImplTag.HKDF:return e.Hkdf.newAndTakeCContext(r);case e.FoundationImplTag.KDF1:return e.Kdf1.newAndTakeCContext(r);case e.FoundationImplTag.KDF2:return e.Kdf2.newAndTakeCContext(r);case e.FoundationImplTag.FAKE_RANDOM:return e.FakeRandom.newAndTakeCContext(r);case e.FoundationImplTag.PKCS5_PBKDF2:return e.Pkcs5Pbkdf2.newAndTakeCContext(r);case e.FoundationImplTag.PKCS5_PBES2:return e.Pkcs5Pbes2.newAndTakeCContext(r);case e.FoundationImplTag.SEED_ENTROPY_SOURCE:return e.SeedEntropySource.newAndTakeCContext(r);case e.FoundationImplTag.KEY_MATERIAL_RNG:return e.KeyMaterialRng.newAndTakeCContext(r);case e.FoundationImplTag.RAW_PUBLIC_KEY:return e.RawPublicKey.newAndTakeCContext(r);case e.FoundationImplTag.RAW_PRIVATE_KEY:return e.RawPrivateKey.newAndTakeCContext(r);case e.FoundationImplTag.PKCS8_SERIALIZER:return e.Pkcs8Serializer.newAndTakeCContext(r);case e.FoundationImplTag.SEC1_SERIALIZER:return e.Sec1Serializer.newAndTakeCContext(r);case e.FoundationImplTag.KEY_ASN1_SERIALIZER:return e.KeyAsn1Serializer.newAndTakeCContext(r);case e.FoundationImplTag.KEY_ASN1_DESERIALIZER:return e.KeyAsn1Deserializer.newAndTakeCContext(r);case e.FoundationImplTag.ED25519:return e.Ed25519.newAndTakeCContext(r);case e.FoundationImplTag.CURVE25519:return e.Curve25519.newAndTakeCContext(r);case e.FoundationImplTag.SIMPLE_ALG_INFO:return e.SimpleAlgInfo.newAndTakeCContext(r);case e.FoundationImplTag.HASH_BASED_ALG_INFO:return e.HashBasedAlgInfo.newAndTakeCContext(r);case e.FoundationImplTag.CIPHER_ALG_INFO:return e.CipherAlgInfo.newAndTakeCContext(r);case e.FoundationImplTag.SALTED_KDF_ALG_INFO:return e.SaltedKdfAlgInfo.newAndTakeCContext(r);case e.FoundationImplTag.PBE_ALG_INFO:return e.PbeAlgInfo.newAndTakeCContext(r);case e.FoundationImplTag.ECC_ALG_INFO:return e.EccAlgInfo.newAndTakeCContext(r);case e.FoundationImplTag.ALG_INFO_DER_SERIALIZER:return e.AlgInfoDerSerializer.newAndTakeCContext(r);case e.FoundationImplTag.ALG_INFO_DER_DESERIALIZER:return e.AlgInfoDerDeserializer.newAndTakeCContext(r);case e.FoundationImplTag.MESSAGE_INFO_DER_SERIALIZER:return e.MessageInfoDerSerializer.newAndTakeCContext(r);default:throw new Error("Unexpected implementation tag found: "+n)}}static newAndUseCContext(r){return new e.FoundationInterface.newAndTakeCContext(t._vscf_impl_shallow_copy(r))}static isImplemented(e,r){return 0!=t._vscf_impl_api(e,r)}}};var FoundationInterface=initFoundationInterface;const initFoundationInterfaceTag=(t,e)=>{return Object.freeze({ALG:1,ALG_INFO:2,ALG_INFO_DESERIALIZER:3,ALG_INFO_SERIALIZER:4,ASN1_READER:5,ASN1_WRITER:6,AUTH_DECRYPT:7,AUTH_ENCRYPT:8,CIPHER:9,CIPHER_AUTH:10,CIPHER_AUTH_INFO:11,CIPHER_INFO:12,COMPUTE_SHARED_KEY:13,DECRYPT:14,ENCRYPT:15,ENTROPY_SOURCE:16,HASH:17,KDF:18,KEY:19,KEY_ALG:20,KEY_CIPHER:21,KEY_DESERIALIZER:22,KEY_SERIALIZER:23,KEY_SIGNER:24,MAC:25,MESSAGE_INFO_FOOTER_SERIALIZER:26,MESSAGE_INFO_SERIALIZER:27,PRIVATE_KEY:28,PUBLIC_KEY:29,RANDOM:30,SALTED_KDF:31})};var FoundationInterfaceTag=initFoundationInterfaceTag;const initFoundationImplTag=(t,e)=>{return Object.freeze({AES256_CBC:1,AES256_GCM:2,ALG_INFO_DER_DESERIALIZER:3,ALG_INFO_DER_SERIALIZER:4,ASN1RD:5,ASN1WR:6,CIPHER_ALG_INFO:7,CTR_DRBG:8,CURVE25519:9,ECC:10,ECC_ALG_INFO:11,ECC_PRIVATE_KEY:12,ECC_PUBLIC_KEY:13,ED25519:14,ENTROPY_ACCUMULATOR:15,FAKE_RANDOM:16,HASH_BASED_ALG_INFO:17,HKDF:18,HMAC:19,KDF1:20,KDF2:21,KEY_ASN1_DESERIALIZER:22,KEY_ASN1_SERIALIZER:23,KEY_MATERIAL_RNG:24,MESSAGE_INFO_DER_SERIALIZER:25,PBE_ALG_INFO:26,PKCS5_PBES2:27,PKCS5_PBKDF2:28,PKCS8_SERIALIZER:29,RAW_PRIVATE_KEY:30,RAW_PUBLIC_KEY:31,RSA:32,RSA_PRIVATE_KEY:33,RSA_PUBLIC_KEY:34,SALTED_KDF_ALG_INFO:35,SEC1_SERIALIZER:36,SEED_ENTROPY_SOURCE:37,SHA224:38,SHA256:39,SHA384:40,SHA512:41,SIMPLE_ALG_INFO:42})};var FoundationImplTag=initFoundationImplTag;function ensureNumber(t,e){if(!("number"==typeof e||e instanceof Number))throw new TypeError(`'${t}' is not a number`);if(Number.isNaN(e))throw new TypeError(`'${t}' is NaN`);if(e===1/0)throw new TypeError(`'${t}' is Infinity`);if(e===-1/0)throw new TypeError(`'${t}' is -Infinity`)}function ensureNotNull(t,e){if(ensureNumber(t,e),0==e)throw new TypeError(`'${t}' is NULL`)}function ensureString(t,e){if(!("string"==typeof e||e instanceof String))throw new TypeError(`'${t}' is not a string`)}function ensureBoolean(t,e){if("boolean"!=typeof e)throw new TypeError(`'${t}' is not a boolean`)}function ensureByteArray(t,e){if(!(e instanceof Uint8Array))throw new TypeError(`'${t}' is not an Uint8Array`)}function ensureClass(t,e,r){if(!(e instanceof r))throw new TypeError(`'${t}' is not an instance of the class ${r.name}`);ensureNotNull(t,e.ctxPtr)}function ensureImplementInterface(t,e,r,n,s){if(ensureNotNull(t,e.ctxPtr),!s.isImplemented(e.ctxPtr,n))throw new TypeError(`'${t}' does not implement interface '${r}'`)}var ensureNumber_1=ensureNumber,ensureString_1=ensureString,ensureBoolean_1=ensureBoolean,ensureByteArray_1=ensureByteArray,ensureClass_1=ensureClass,ensureNotNull_1=ensureNotNull,ensureImplementInterface_1=ensureImplementInterface,precondition={ensureNumber:ensureNumber_1,ensureString:ensureString_1,ensureBoolean:ensureBoolean_1,ensureByteArray:ensureByteArray_1,ensureClass:ensureClass_1,ensureNotNull:ensureNotNull_1,ensureImplementInterface:ensureImplementInterface_1};const initCtrDrbg=(t,e)=>{class r{static get RESEED_INTERVAL(){return 1e4}get RESEED_INTERVAL(){return r.RESEED_INTERVAL}static get ENTROPY_LEN(){return 48}get ENTROPY_LEN(){return r.ENTROPY_LEN}constructor(e){this.name="CtrDrbg",this.ctxPtr=void 0===e?t._vscf_ctr_drbg_new():e}static newAndUseCContext(e){return new r(t._vscf_ctr_drbg_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscf_ctr_drbg_delete(this.ctxPtr),this.ctxPtr=null)}set entropySource(r){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureImplementInterface("entropySource",r,"Foundation.EntropySource",e.FoundationInterfaceTag.ENTROPY_SOURCE,e.FoundationInterface),t._vscf_ctr_drbg_release_entropy_source(this.ctxPtr);const n=t._vscf_ctr_drbg_use_entropy_source(this.ctxPtr,r.ctxPtr);e.FoundationError.handleStatusCode(n)}random(r){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureNumber("dataLen",r);const n=r,s=t._vsc_buffer_new_with_capacity(n);try{const n=t._vscf_ctr_drbg_random(this.ctxPtr,r,s);e.FoundationError.handleStatusCode(n);const c=t._vsc_buffer_bytes(s),o=t._vsc_buffer_len(s);return t.HEAPU8.slice(c,c+o)}finally{t._vsc_buffer_delete(s)}}reseed(){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=t._vscf_ctr_drbg_reseed(this.ctxPtr);e.FoundationError.handleStatusCode(r)}setupDefaults(){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=t._vscf_ctr_drbg_setup_defaults(this.ctxPtr);e.FoundationError.handleStatusCode(r)}enablePredictionResistance(){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),t._vscf_ctr_drbg_enable_prediction_resistance(this.ctxPtr)}setReseedInterval(e){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureNumber("interval",e),t._vscf_ctr_drbg_set_reseed_interval(this.ctxPtr,e)}setEntropyLen(e){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureNumber("len",e),t._vscf_ctr_drbg_set_entropy_len(this.ctxPtr,e)}}return r};var CtrDrbg=initCtrDrbg;const initHmac=(t,e)=>{class r{constructor(e){this.name="Hmac",this.ctxPtr=void 0===e?t._vscf_hmac_new():e}static newAndUseCContext(e){return new r(t._vscf_hmac_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscf_hmac_delete(this.ctxPtr),this.ctxPtr=null)}set hash(r){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureImplementInterface("hash",r,"Foundation.Hash",e.FoundationInterfaceTag.HASH,e.FoundationInterface),t._vscf_hmac_release_hash(this.ctxPtr),t._vscf_hmac_use_hash(this.ctxPtr,r.ctxPtr)}algId(){let e;return precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscf_hmac_alg_id(this.ctxPtr)}produceAlgInfo(){let r;return precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),r=t._vscf_hmac_produce_alg_info(this.ctxPtr),e.FoundationInterface.newAndTakeCContext(r)}restoreAlgInfo(r){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureImplementInterface("algInfo",r,"Foundation.AlgInfo",e.FoundationInterfaceTag.ALG_INFO,e.FoundationInterface);const n=t._vscf_hmac_restore_alg_info(this.ctxPtr,r.ctxPtr);e.FoundationError.handleStatusCode(n)}digestLen(){let e;return precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscf_hmac_digest_len(this.ctxPtr)}mac(e,r){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureByteArray("key",e),precondition.ensureByteArray("data",r);const n=e.length*e.BYTES_PER_ELEMENT,s=t._malloc(n);t.HEAP8.set(e,s);const c=t._vsc_data_ctx_size(),o=t._malloc(c);t._vsc_data(o,s,n);const i=r.length*r.BYTES_PER_ELEMENT,a=t._malloc(i);t.HEAP8.set(r,a);const _=t._vsc_data_ctx_size(),u=t._malloc(_);t._vsc_data(u,a,i);const l=this.digestLen(),f=t._vsc_buffer_new_with_capacity(l);try{t._vscf_hmac_mac(this.ctxPtr,o,u,f);const e=t._vsc_buffer_bytes(f),r=t._vsc_buffer_len(f);return t.HEAPU8.slice(e,e+r)}finally{t._free(s),t._free(o),t._free(a),t._free(u),t._vsc_buffer_delete(f)}}start(e){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureByteArray("key",e);const r=e.length*e.BYTES_PER_ELEMENT,n=t._malloc(r);t.HEAP8.set(e,n);const s=t._vsc_data_ctx_size(),c=t._malloc(s);t._vsc_data(c,n,r);try{t._vscf_hmac_start(this.ctxPtr,c)}finally{t._free(n),t._free(c)}}update(e){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureByteArray("data",e);const r=e.length*e.BYTES_PER_ELEMENT,n=t._malloc(r);t.HEAP8.set(e,n);const s=t._vsc_data_ctx_size(),c=t._malloc(s);t._vsc_data(c,n,r);try{t._vscf_hmac_update(this.ctxPtr,c)}finally{t._free(n),t._free(c)}}finish(){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr);const e=this.digestLen(),r=t._vsc_buffer_new_with_capacity(e);try{t._vscf_hmac_finish(this.ctxPtr,r);const e=t._vsc_buffer_bytes(r),n=t._vsc_buffer_len(r);return t.HEAPU8.slice(e,e+n)}finally{t._vsc_buffer_delete(r)}}reset(){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),t._vscf_hmac_reset(this.ctxPtr)}}return r};var Hmac=initHmac;const initHkdf=(t,e)=>{class r{constructor(e){this.name="Hkdf",this.ctxPtr=void 0===e?t._vscf_hkdf_new():e}static newAndUseCContext(e){return new r(t._vscf_hkdf_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscf_hkdf_delete(this.ctxPtr),this.ctxPtr=null)}set hash(r){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureImplementInterface("hash",r,"Foundation.Hash",e.FoundationInterfaceTag.HASH,e.FoundationInterface),t._vscf_hkdf_release_hash(this.ctxPtr),t._vscf_hkdf_use_hash(this.ctxPtr,r.ctxPtr)}algId(){let e;return precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscf_hkdf_alg_id(this.ctxPtr)}produceAlgInfo(){let r;return precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),r=t._vscf_hkdf_produce_alg_info(this.ctxPtr),e.FoundationInterface.newAndTakeCContext(r)}restoreAlgInfo(r){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureImplementInterface("algInfo",r,"Foundation.AlgInfo",e.FoundationInterfaceTag.ALG_INFO,e.FoundationInterface);const n=t._vscf_hkdf_restore_alg_info(this.ctxPtr,r.ctxPtr);e.FoundationError.handleStatusCode(n)}derive(e,r){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureByteArray("data",e),precondition.ensureNumber("keyLen",r);const n=e.length*e.BYTES_PER_ELEMENT,s=t._malloc(n);t.HEAP8.set(e,s);const c=t._vsc_data_ctx_size(),o=t._malloc(c);t._vsc_data(o,s,n);const i=r,a=t._vsc_buffer_new_with_capacity(i);try{t._vscf_hkdf_derive(this.ctxPtr,o,r,a);const e=t._vsc_buffer_bytes(a),n=t._vsc_buffer_len(a);return t.HEAPU8.slice(e,e+n)}finally{t._free(s),t._free(o),t._vsc_buffer_delete(a)}}reset(e,r){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureByteArray("salt",e),precondition.ensureNumber("iterationCount",r);const n=e.length*e.BYTES_PER_ELEMENT,s=t._malloc(n);t.HEAP8.set(e,s);const c=t._vsc_data_ctx_size(),o=t._malloc(c);t._vsc_data(o,s,n);try{t._vscf_hkdf_reset(this.ctxPtr,o,r)}finally{t._free(s),t._free(o)}}setInfo(e){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureByteArray("info",e);const r=e.length*e.BYTES_PER_ELEMENT,n=t._malloc(r);t.HEAP8.set(e,n);const s=t._vsc_data_ctx_size(),c=t._malloc(s);t._vsc_data(c,n,r);try{t._vscf_hkdf_set_info(this.ctxPtr,c)}finally{t._free(n),t._free(c)}}}return r};var Hkdf=initHkdf;const initSha512=(t,e)=>{class r{static get DIGEST_LEN(){return 64}get DIGEST_LEN(){return r.DIGEST_LEN}static get BLOCK_LEN(){return 128}get BLOCK_LEN(){return r.BLOCK_LEN}constructor(e){this.name="Sha512",this.ctxPtr=void 0===e?t._vscf_sha512_new():e}static newAndUseCContext(e){return new r(t._vscf_sha512_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscf_sha512_delete(this.ctxPtr),this.ctxPtr=null)}algId(){let e;return precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscf_sha512_alg_id(this.ctxPtr)}produceAlgInfo(){let r;return precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),r=t._vscf_sha512_produce_alg_info(this.ctxPtr),e.FoundationInterface.newAndTakeCContext(r)}restoreAlgInfo(r){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureImplementInterface("algInfo",r,"Foundation.AlgInfo",e.FoundationInterfaceTag.ALG_INFO,e.FoundationInterface);const n=t._vscf_sha512_restore_alg_info(this.ctxPtr,r.ctxPtr);e.FoundationError.handleStatusCode(n)}hash(e){precondition.ensureByteArray("data",e);const r=e.length*e.BYTES_PER_ELEMENT,n=t._malloc(r);t.HEAP8.set(e,n);const s=t._vsc_data_ctx_size(),c=t._malloc(s);t._vsc_data(c,n,r);const o=this.DIGEST_LEN,i=t._vsc_buffer_new_with_capacity(o);try{t._vscf_sha512_hash(c,i);const e=t._vsc_buffer_bytes(i),r=t._vsc_buffer_len(i);return t.HEAPU8.slice(e,e+r)}finally{t._free(n),t._free(c),t._vsc_buffer_delete(i)}}start(){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),t._vscf_sha512_start(this.ctxPtr)}update(e){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition.ensureByteArray("data",e);const r=e.length*e.BYTES_PER_ELEMENT,n=t._malloc(r);t.HEAP8.set(e,n);const s=t._vsc_data_ctx_size(),c=t._malloc(s);t._vsc_data(c,n,r);try{t._vscf_sha512_update(this.ctxPtr,c)}finally{t._free(n),t._free(c)}}finish(){precondition.ensureNotNull("this.ctxPtr",this.ctxPtr);const e=this.DIGEST_LEN,r=t._vsc_buffer_new_with_capacity(e);try{t._vscf_sha512_finish(this.ctxPtr,r);const e=t._vsc_buffer_bytes(r),n=t._vsc_buffer_len(r);return t.HEAPU8.slice(e,e+n)}finally{t._vsc_buffer_delete(r)}}}return r};var Sha512=initSha512;const initRatchetError=(t,e)=>{class r extends Error{constructor(t){super(t),this.name="RatchetError",this.message=t}static handleStatusCode(t){if(0!=t){if(-1==t)throw new r("Error during protobuf deserialization.");if(-2==t)throw new r("Bad message type.");if(-3==t)throw new r("AES error.");if(-4==t)throw new r("RNG failed.");if(-5==t)throw new r("Curve25519 error.");if(-6==t)throw new r("Curve25519 error.");if(-7==t)throw new r("Key deserialization failed.");if(-8==t)throw new r("Invalid key type.");if(-9==t)throw new r("Identity key doesn't match.");if(-10==t)throw new r("Message already decrypted.");if(-11==t)throw new r("Too many lost messages.");if(-12==t)throw new r("Sender chain missing.");if(-13==t)throw new r("Skipped message missing.");if(-14==t)throw new r("Session is not initialized.");if(-15==t)throw new r("Exceeded max plain text len.");if(-16==t)throw new r("Too many messages for sender chain.");if(-17==t)throw new r("Too many messages for receiver chain.");if(-18==t)throw new r("Invalid padding.");if(-19==t)throw new r("Too many participants.");if(-20==t)throw new r("Too few participants.");if(-21==t)throw new r("Sender not found.");if(-22==t)throw new r("Cannot decrypt own messages.");if(-23==t)throw new r("Invalid signature.");if(-24==t)throw new r("Cannot remove myself.");if(-25==t)throw new r("Epoch mismatch.");if(-26==t)throw new r("Epoch not found.");if(-27==t)throw new r("Session id mismatch.");if(-28==t)throw new r("Simultaneous group user operation.");if(-29==t)throw new r("Myself is included in info.");throw new r("Unexpected status code:"+t)}}}return r};var RatchetError=initRatchetError;const initMsgType=(t,e)=>{return Object.freeze({REGULAR:0,PREKEY:1})};var MsgType=initMsgType;const initGroupMsgType=(t,e)=>{return Object.freeze({GROUP_INFO:0,REGULAR:1})};var GroupMsgType=initGroupMsgType;function ensureNumber$1(t,e){if(!("number"==typeof e||e instanceof Number))throw new TypeError(`'${t}' is not a number`);if(Number.isNaN(e))throw new TypeError(`'${t}' is NaN`);if(e===1/0)throw new TypeError(`'${t}' is Infinity`);if(e===-1/0)throw new TypeError(`'${t}' is -Infinity`)}function ensureNotNull$1(t,e){if(ensureNumber$1(t,e),0==e)throw new TypeError(`'${t}' is NULL`)}function ensureString$1(t,e){if(!("string"==typeof e||e instanceof String))throw new TypeError(`'${t}' is not a string`)}function ensureBoolean$1(t,e){if("boolean"!=typeof e)throw new TypeError(`'${t}' is not a boolean`)}function ensureByteArray$1(t,e){if(!(e instanceof Uint8Array))throw new TypeError(`'${t}' is not an Uint8Array`)}function ensureClass$1(t,e,r){if(!(e instanceof r))throw new TypeError(`'${t}' is not an instance of the class ${r.name}`);ensureNotNull$1(t,e.ctxPtr)}function ensureImplementInterface$1(t,e,r,n,s){if(ensureNotNull$1(t,e.ctxPtr),!s.isImplemented(e.ctxPtr,n))throw new TypeError(`'${t}' does not implement interface '${r}'`)}var ensureNumber_1$1=ensureNumber$1,ensureString_1$1=ensureString$1,ensureBoolean_1$1=ensureBoolean$1,ensureByteArray_1$1=ensureByteArray$1,ensureClass_1$1=ensureClass$1,ensureNotNull_1$1=ensureNotNull$1,ensureImplementInterface_1$1=ensureImplementInterface$1,precondition$1={ensureNumber:ensureNumber_1$1,ensureString:ensureString_1$1,ensureBoolean:ensureBoolean_1$1,ensureByteArray:ensureByteArray_1$1,ensureClass:ensureClass_1$1,ensureNotNull:ensureNotNull_1$1,ensureImplementInterface:ensureImplementInterface_1$1};const initRatchetCommon=(t,e)=>{class r{static get MAX_PLAIN_TEXT_LEN(){return 3e4}get MAX_PLAIN_TEXT_LEN(){return r.MAX_PLAIN_TEXT_LEN}static get MAX_MESSAGE_LEN(){return 32975}get MAX_MESSAGE_LEN(){return r.MAX_MESSAGE_LEN}static get KEY_ID_LEN(){return 8}get KEY_ID_LEN(){return r.KEY_ID_LEN}static get PARTICIPANT_ID_LEN(){return 32}get PARTICIPANT_ID_LEN(){return r.PARTICIPANT_ID_LEN}static get SESSION_ID_LEN(){return 32}get SESSION_ID_LEN(){return r.SESSION_ID_LEN}static get MAX_PARTICIPANTS_COUNT(){return 100}get MAX_PARTICIPANTS_COUNT(){return r.MAX_PARTICIPANTS_COUNT}static get MIN_PARTICIPANTS_COUNT(){return 2}get MIN_PARTICIPANTS_COUNT(){return r.MIN_PARTICIPANTS_COUNT}static get MAX_GROUP_MESSAGE_LEN(){return 32918}get MAX_GROUP_MESSAGE_LEN(){return r.MAX_GROUP_MESSAGE_LEN}}return r};var RatchetCommon=initRatchetCommon;const initRatchetKeyId=(t,e)=>{class r{constructor(e){this.name="RatchetKeyId",this.ctxPtr=void 0===e?t._vscr_ratchet_key_id_new():e}static newAndUseCContext(e){return new r(t._vscr_ratchet_key_id_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscr_ratchet_key_id_delete(this.ctxPtr),this.ctxPtr=null)}computePublicKeyId(r){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureByteArray("publicKey",r);const n=r.length*r.BYTES_PER_ELEMENT,s=t._malloc(n);t.HEAP8.set(r,s);const c=t._vsc_data_ctx_size(),o=t._malloc(c);t._vsc_data(o,s,n);const i=e.RatchetCommon.KEY_ID_LEN,a=t._vsc_buffer_new_with_capacity(i);try{const r=t._vscr_ratchet_key_id_compute_public_key_id(this.ctxPtr,o,a);e.RatchetError.handleStatusCode(r);const n=t._vsc_buffer_bytes(a),c=t._vsc_buffer_len(a);return t.HEAPU8.slice(n,n+c)}finally{t._free(s),t._free(o),t._vsc_buffer_delete(a)}}}return r};var RatchetKeyId=initRatchetKeyId;const initRatchetMessage=(t,e)=>{class r{constructor(e){this.name="RatchetMessage",this.ctxPtr=void 0===e?t._vscr_ratchet_message_new():e}static newAndUseCContext(e){return new r(t._vscr_ratchet_message_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscr_ratchet_message_delete(this.ctxPtr),this.ctxPtr=null)}getType(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscr_ratchet_message_get_type(this.ctxPtr)}getCounter(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscr_ratchet_message_get_counter(this.ctxPtr)}getLongTermPublicKey(){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);const e=t._vsc_data_ctx_size(),r=t._malloc(e);try{t._vscr_ratchet_message_get_long_term_public_key(r,this.ctxPtr);const e=t._vsc_data_len(r),n=t._vsc_data_bytes(r);return t.HEAPU8.slice(n,n+e)}finally{t._free(r)}}getOneTimePublicKey(){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);const e=t._vsc_data_ctx_size(),r=t._malloc(e);try{t._vscr_ratchet_message_get_one_time_public_key(r,this.ctxPtr);const e=t._vsc_data_len(r),n=t._vsc_data_bytes(r);return t.HEAPU8.slice(n,n+e)}finally{t._free(r)}}serializeLen(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscr_ratchet_message_serialize_len(this.ctxPtr)}serialize(){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);const e=this.serializeLen(),r=t._vsc_buffer_new_with_capacity(e);try{t._vscr_ratchet_message_serialize(this.ctxPtr,r);const e=t._vsc_buffer_bytes(r),n=t._vsc_buffer_len(r);return t.HEAPU8.slice(e,e+n)}finally{t._vsc_buffer_delete(r)}}static deserialize(n){precondition$1.ensureByteArray("input",n);const s=n.length*n.BYTES_PER_ELEMENT,c=t._malloc(s);t.HEAP8.set(n,c);const o=t._vsc_data_ctx_size(),i=t._malloc(o);t._vsc_data(i,c,s);const a=t._vscr_error_ctx_size(),_=t._malloc(a);let u;t._vscr_error_reset(_);try{u=t._vscr_ratchet_message_deserialize(i,_);const n=t._vscr_error_status(_);return e.RatchetError.handleStatusCode(n),r.newAndTakeCContext(u)}finally{t._free(c),t._free(i),t._free(_)}}}return r};var RatchetMessage=initRatchetMessage;const initRatchetSession=(t,e)=>{class r{constructor(e){this.name="RatchetSession",this.ctxPtr=void 0===e?t._vscr_ratchet_session_new():e}static newAndUseCContext(e){return new r(t._vscr_ratchet_session_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscr_ratchet_session_delete(this.ctxPtr),this.ctxPtr=null)}set rng(r){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureImplementInterface("rng",r,"Foundation.Random",e.FoundationInterfaceTag.RANDOM,e.FoundationInterface),t._vscr_ratchet_session_release_rng(this.ctxPtr),t._vscr_ratchet_session_use_rng(this.ctxPtr,r.ctxPtr)}setupDefaults(){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=t._vscr_ratchet_session_setup_defaults(this.ctxPtr);e.RatchetError.handleStatusCode(r)}initiate(r,n,s,c){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureByteArray("senderIdentityPrivateKey",r),precondition$1.ensureByteArray("receiverIdentityPublicKey",n),precondition$1.ensureByteArray("receiverLongTermPublicKey",s),precondition$1.ensureByteArray("receiverOneTimePublicKey",c);const o=r.length*r.BYTES_PER_ELEMENT,i=t._malloc(o);t.HEAP8.set(r,i);const a=t._vsc_data_ctx_size(),_=t._malloc(a);t._vsc_data(_,i,o);const u=n.length*n.BYTES_PER_ELEMENT,l=t._malloc(u);t.HEAP8.set(n,l);const f=t._vsc_data_ctx_size(),p=t._malloc(f);t._vsc_data(p,l,u);const h=s.length*s.BYTES_PER_ELEMENT,d=t._malloc(h);t.HEAP8.set(s,d);const m=t._vsc_data_ctx_size(),y=t._malloc(m);t._vsc_data(y,d,h);const v=c.length*c.BYTES_PER_ELEMENT,w=t._malloc(v);t.HEAP8.set(c,w);const g=t._vsc_data_ctx_size(),P=t._malloc(g);t._vsc_data(P,w,v);try{const r=t._vscr_ratchet_session_initiate(this.ctxPtr,_,p,y,P);e.RatchetError.handleStatusCode(r)}finally{t._free(i),t._free(_),t._free(l),t._free(p),t._free(d),t._free(y),t._free(w),t._free(P)}}respond(r,n,s,c,o){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureByteArray("senderIdentityPublicKey",r),precondition$1.ensureByteArray("receiverIdentityPrivateKey",n),precondition$1.ensureByteArray("receiverLongTermPrivateKey",s),precondition$1.ensureByteArray("receiverOneTimePrivateKey",c),precondition$1.ensureClass("message",o,e.RatchetMessage);const i=r.length*r.BYTES_PER_ELEMENT,a=t._malloc(i);t.HEAP8.set(r,a);const _=t._vsc_data_ctx_size(),u=t._malloc(_);t._vsc_data(u,a,i);const l=n.length*n.BYTES_PER_ELEMENT,f=t._malloc(l);t.HEAP8.set(n,f);const p=t._vsc_data_ctx_size(),h=t._malloc(p);t._vsc_data(h,f,l);const d=s.length*s.BYTES_PER_ELEMENT,m=t._malloc(d);t.HEAP8.set(s,m);const y=t._vsc_data_ctx_size(),v=t._malloc(y);t._vsc_data(v,m,d);const w=c.length*c.BYTES_PER_ELEMENT,g=t._malloc(w);t.HEAP8.set(c,g);const P=t._vsc_data_ctx_size(),E=t._malloc(P);t._vsc_data(E,g,w);try{const r=t._vscr_ratchet_session_respond(this.ctxPtr,u,h,v,E,o.ctxPtr);e.RatchetError.handleStatusCode(r)}finally{t._free(a),t._free(u),t._free(f),t._free(h),t._free(m),t._free(v),t._free(g),t._free(E)}}isInitiator(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),!!(e=t._vscr_ratchet_session_is_initiator(this.ctxPtr))}receivedFirstResponse(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),!!(e=t._vscr_ratchet_session_received_first_response(this.ctxPtr))}receiverHasOneTimePublicKey(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),!!(e=t._vscr_ratchet_session_receiver_has_one_time_public_key(this.ctxPtr))}encrypt(r){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureByteArray("plainText",r);const n=r.length*r.BYTES_PER_ELEMENT,s=t._malloc(n);t.HEAP8.set(r,s);const c=t._vsc_data_ctx_size(),o=t._malloc(c);t._vsc_data(o,s,n);const i=t._vscr_error_ctx_size(),a=t._malloc(i);let _;t._vscr_error_reset(a);try{_=t._vscr_ratchet_session_encrypt(this.ctxPtr,o,a);const r=t._vscr_error_status(a);return e.RatchetError.handleStatusCode(r),e.RatchetMessage.newAndTakeCContext(_)}finally{t._free(s),t._free(o),t._free(a)}}decryptLen(r){let n;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureClass("message",r,e.RatchetMessage),n=t._vscr_ratchet_session_decrypt_len(this.ctxPtr,r.ctxPtr)}decrypt(r){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureClass("message",r,e.RatchetMessage);const n=this.decryptLen(r),s=t._vsc_buffer_new_with_capacity(n);try{const n=t._vscr_ratchet_session_decrypt(this.ctxPtr,r.ctxPtr,s);e.RatchetError.handleStatusCode(n);const c=t._vsc_buffer_bytes(s),o=t._vsc_buffer_len(s);return t.HEAPU8.slice(c,c+o)}finally{t._vsc_buffer_delete(s)}}serialize(){let e;precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);try{e=t._vscr_ratchet_session_serialize(this.ctxPtr);const r=t._vsc_buffer_len(e),n=t._vsc_buffer_bytes(e);return t.HEAPU8.slice(n,n+r)}finally{t._vsc_buffer_delete(e)}}static deserialize(n){precondition$1.ensureByteArray("input",n);const s=n.length*n.BYTES_PER_ELEMENT,c=t._malloc(s);t.HEAP8.set(n,c);const o=t._vsc_data_ctx_size(),i=t._malloc(o);t._vsc_data(i,c,s);const a=t._vscr_error_ctx_size(),_=t._malloc(a);let u;t._vscr_error_reset(_);try{u=t._vscr_ratchet_session_deserialize(i,_);const n=t._vscr_error_status(_);return e.RatchetError.handleStatusCode(n),r.newAndTakeCContext(u)}finally{t._free(c),t._free(i),t._free(_)}}}return r};var RatchetSession=initRatchetSession;const initRatchetGroupParticipantsInfo=(t,e)=>{class r{constructor(e){this.name="RatchetGroupParticipantsInfo",this.ctxPtr=void 0===e?t._vscr_ratchet_group_participants_info_new():e}static newAndUseCContext(e){return new r(t._vscr_ratchet_group_participants_info_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscr_ratchet_group_participants_info_delete(this.ctxPtr),this.ctxPtr=null)}static newSize(e){let n;return precondition$1.ensureNumber("size",e),n=t._vscr_ratchet_group_participants_info_new_size(e),r.newAndTakeCContext(n)}addParticipant(r,n){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureByteArray("id",r),precondition$1.ensureByteArray("pubKey",n);const s=r.length*r.BYTES_PER_ELEMENT,c=t._malloc(s);t.HEAP8.set(r,c);const o=t._vsc_data_ctx_size(),i=t._malloc(o);t._vsc_data(i,c,s);const a=n.length*n.BYTES_PER_ELEMENT,_=t._malloc(a);t.HEAP8.set(n,_);const u=t._vsc_data_ctx_size(),l=t._malloc(u);t._vsc_data(l,_,a);try{const r=t._vscr_ratchet_group_participants_info_add_participant(this.ctxPtr,i,l);e.RatchetError.handleStatusCode(r)}finally{t._free(c),t._free(i),t._free(_),t._free(l)}}}return r};var RatchetGroupParticipantsInfo=initRatchetGroupParticipantsInfo;const initRatchetGroupMessage=(t,e)=>{class r{constructor(e){this.name="RatchetGroupMessage",this.ctxPtr=void 0===e?t._vscr_ratchet_group_message_new():e}static newAndUseCContext(e){return new r(t._vscr_ratchet_group_message_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscr_ratchet_group_message_delete(this.ctxPtr),this.ctxPtr=null)}getType(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscr_ratchet_group_message_get_type(this.ctxPtr)}getSessionId(){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);const e=t._vsc_data_ctx_size(),r=t._malloc(e);try{t._vscr_ratchet_group_message_get_session_id(r,this.ctxPtr);const e=t._vsc_data_len(r),n=t._vsc_data_bytes(r);return t.HEAPU8.slice(n,n+e)}finally{t._free(r)}}getCounter(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscr_ratchet_group_message_get_counter(this.ctxPtr)}getEpoch(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscr_ratchet_group_message_get_epoch(this.ctxPtr)}serializeLen(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscr_ratchet_group_message_serialize_len(this.ctxPtr)}serialize(){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);const e=this.serializeLen(),r=t._vsc_buffer_new_with_capacity(e);try{t._vscr_ratchet_group_message_serialize(this.ctxPtr,r);const e=t._vsc_buffer_bytes(r),n=t._vsc_buffer_len(r);return t.HEAPU8.slice(e,e+n)}finally{t._vsc_buffer_delete(r)}}static deserialize(n){precondition$1.ensureByteArray("input",n);const s=n.length*n.BYTES_PER_ELEMENT,c=t._malloc(s);t.HEAP8.set(n,c);const o=t._vsc_data_ctx_size(),i=t._malloc(o);t._vsc_data(i,c,s);const a=t._vscr_error_ctx_size(),_=t._malloc(a);let u;t._vscr_error_reset(_);try{u=t._vscr_ratchet_group_message_deserialize(i,_);const n=t._vscr_error_status(_);return e.RatchetError.handleStatusCode(n),r.newAndTakeCContext(u)}finally{t._free(c),t._free(i),t._free(_)}}}return r};var RatchetGroupMessage=initRatchetGroupMessage;const initRatchetGroupTicket=(t,e)=>{class r{constructor(e){this.name="RatchetGroupTicket",this.ctxPtr=void 0===e?t._vscr_ratchet_group_ticket_new():e}static newAndUseCContext(e){return new r(t._vscr_ratchet_group_ticket_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscr_ratchet_group_ticket_delete(this.ctxPtr),this.ctxPtr=null)}set rng(r){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureImplementInterface("rng",r,"Foundation.Random",e.FoundationInterfaceTag.RANDOM,e.FoundationInterface),t._vscr_ratchet_group_ticket_release_rng(this.ctxPtr),t._vscr_ratchet_group_ticket_use_rng(this.ctxPtr,r.ctxPtr)}setupDefaults(){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=t._vscr_ratchet_group_ticket_setup_defaults(this.ctxPtr);e.RatchetError.handleStatusCode(r)}setupTicketAsNew(r){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureByteArray("sessionId",r);const n=r.length*r.BYTES_PER_ELEMENT,s=t._malloc(n);t.HEAP8.set(r,s);const c=t._vsc_data_ctx_size(),o=t._malloc(c);t._vsc_data(o,s,n);try{const r=t._vscr_ratchet_group_ticket_setup_ticket_as_new(this.ctxPtr,o);e.RatchetError.handleStatusCode(r)}finally{t._free(s),t._free(o)}}getTicketMessage(){let r;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),r=t._vscr_ratchet_group_ticket_get_ticket_message(this.ctxPtr),e.RatchetGroupMessage.newAndUseCContext(r)}}return r};var RatchetGroupTicket=initRatchetGroupTicket;const initRatchetGroupParticipantsIds=(t,e)=>{class r{constructor(e){this.name="RatchetGroupParticipantsIds",this.ctxPtr=void 0===e?t._vscr_ratchet_group_participants_ids_new():e}static newAndUseCContext(e){return new r(t._vscr_ratchet_group_participants_ids_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscr_ratchet_group_participants_ids_delete(this.ctxPtr),this.ctxPtr=null)}static newSize(e){let n;return precondition$1.ensureNumber("size",e),n=t._vscr_ratchet_group_participants_ids_new_size(e),r.newAndTakeCContext(n)}addId(e){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureByteArray("id",e);const r=e.length*e.BYTES_PER_ELEMENT,n=t._malloc(r);t.HEAP8.set(e,n);const s=t._vsc_data_ctx_size(),c=t._malloc(s);t._vsc_data(c,n,r);try{t._vscr_ratchet_group_participants_ids_add_id(this.ctxPtr,c)}finally{t._free(n),t._free(c)}}}return r};var RatchetGroupParticipantsIds=initRatchetGroupParticipantsIds;const initRatchetGroupSession=(t,e)=>{class r{constructor(e){this.name="RatchetGroupSession",this.ctxPtr=void 0===e?t._vscr_ratchet_group_session_new():e}static newAndUseCContext(e){return new r(t._vscr_ratchet_group_session_shallow_copy(e))}static newAndTakeCContext(t){return new r(t)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(t._vscr_ratchet_group_session_delete(this.ctxPtr),this.ctxPtr=null)}set rng(r){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureImplementInterface("rng",r,"Foundation.Random",e.FoundationInterfaceTag.RANDOM,e.FoundationInterface),t._vscr_ratchet_group_session_release_rng(this.ctxPtr),t._vscr_ratchet_group_session_use_rng(this.ctxPtr,r.ctxPtr)}isInitialized(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),!!(e=t._vscr_ratchet_group_session_is_initialized(this.ctxPtr))}isPrivateKeySet(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),!!(e=t._vscr_ratchet_group_session_is_private_key_set(this.ctxPtr))}isMyIdSet(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),!!(e=t._vscr_ratchet_group_session_is_my_id_set(this.ctxPtr))}getCurrentEpoch(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscr_ratchet_group_session_get_current_epoch(this.ctxPtr)}setupDefaults(){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=t._vscr_ratchet_group_session_setup_defaults(this.ctxPtr);e.RatchetError.handleStatusCode(r)}setPrivateKey(r){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureByteArray("myPrivateKey",r);const n=r.length*r.BYTES_PER_ELEMENT,s=t._malloc(n);t.HEAP8.set(r,s);const c=t._vsc_data_ctx_size(),o=t._malloc(c);t._vsc_data(o,s,n);try{const r=t._vscr_ratchet_group_session_set_private_key(this.ctxPtr,o);e.RatchetError.handleStatusCode(r)}finally{t._free(s),t._free(o)}}setMyId(e){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureByteArray("myId",e);const r=e.length*e.BYTES_PER_ELEMENT,n=t._malloc(r);t.HEAP8.set(e,n);const s=t._vsc_data_ctx_size(),c=t._malloc(s);t._vsc_data(c,n,r);try{t._vscr_ratchet_group_session_set_my_id(this.ctxPtr,c)}finally{t._free(n),t._free(c)}}getMyId(){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);const e=t._vsc_data_ctx_size(),r=t._malloc(e);try{t._vscr_ratchet_group_session_get_my_id(r,this.ctxPtr);const e=t._vsc_data_len(r),n=t._vsc_data_bytes(r);return t.HEAPU8.slice(n,n+e)}finally{t._free(r)}}getSessionId(){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);const e=t._vsc_data_ctx_size(),r=t._malloc(e);try{t._vscr_ratchet_group_session_get_session_id(r,this.ctxPtr);const e=t._vsc_data_len(r),n=t._vsc_data_bytes(r);return t.HEAPU8.slice(n,n+e)}finally{t._free(r)}}getParticipantsCount(){let e;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),e=t._vscr_ratchet_group_session_get_participants_count(this.ctxPtr)}setupSessionState(r,n){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureClass("message",r,e.RatchetGroupMessage),precondition$1.ensureClass("participants",n,e.RatchetGroupParticipantsInfo);const s=t._vscr_ratchet_group_session_setup_session_state(this.ctxPtr,r.ctxPtr,n.ctxPtr);e.RatchetError.handleStatusCode(s)}updateSessionState(r,n,s){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureClass("message",r,e.RatchetGroupMessage),precondition$1.ensureClass("addParticipants",n,e.RatchetGroupParticipantsInfo),precondition$1.ensureClass("removeParticipants",s,e.RatchetGroupParticipantsIds);const c=t._vscr_ratchet_group_session_update_session_state(this.ctxPtr,r.ctxPtr,n.ctxPtr,s.ctxPtr);e.RatchetError.handleStatusCode(c)}encrypt(r){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureByteArray("plainText",r);const n=r.length*r.BYTES_PER_ELEMENT,s=t._malloc(n);t.HEAP8.set(r,s);const c=t._vsc_data_ctx_size(),o=t._malloc(c);t._vsc_data(o,s,n);const i=t._vscr_error_ctx_size(),a=t._malloc(i);let _;t._vscr_error_reset(a);try{_=t._vscr_ratchet_group_session_encrypt(this.ctxPtr,o,a);const r=t._vscr_error_status(a);return e.RatchetError.handleStatusCode(r),e.RatchetGroupMessage.newAndTakeCContext(_)}finally{t._free(s),t._free(o),t._free(a)}}decryptLen(r){let n;return precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureClass("message",r,e.RatchetGroupMessage),n=t._vscr_ratchet_group_session_decrypt_len(this.ctxPtr,r.ctxPtr)}decrypt(r,n){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr),precondition$1.ensureClass("message",r,e.RatchetGroupMessage),precondition$1.ensureByteArray("senderId",n);const s=n.length*n.BYTES_PER_ELEMENT,c=t._malloc(s);t.HEAP8.set(n,c);const o=t._vsc_data_ctx_size(),i=t._malloc(o);t._vsc_data(i,c,s);const a=this.decryptLen(r),_=t._vsc_buffer_new_with_capacity(a);try{const n=t._vscr_ratchet_group_session_decrypt(this.ctxPtr,r.ctxPtr,i,_);e.RatchetError.handleStatusCode(n);const s=t._vsc_buffer_bytes(_),o=t._vsc_buffer_len(_);return t.HEAPU8.slice(s,s+o)}finally{t._free(c),t._free(i),t._vsc_buffer_delete(_)}}serialize(){let e;precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);try{e=t._vscr_ratchet_group_session_serialize(this.ctxPtr);const r=t._vsc_buffer_len(e),n=t._vsc_buffer_bytes(e);return t.HEAPU8.slice(n,n+r)}finally{t._vsc_buffer_delete(e)}}static deserialize(n){precondition$1.ensureByteArray("input",n);const s=n.length*n.BYTES_PER_ELEMENT,c=t._malloc(s);t.HEAP8.set(n,c);const o=t._vsc_data_ctx_size(),i=t._malloc(o);t._vsc_data(i,c,s);const a=t._vscr_error_ctx_size(),_=t._malloc(a);let u;t._vscr_error_reset(_);try{u=t._vscr_ratchet_group_session_deserialize(i,_);const n=t._vscr_error_status(_);return e.RatchetError.handleStatusCode(n),r.newAndTakeCContext(u)}finally{t._free(c),t._free(i),t._free(_)}}createGroupTicket(){precondition$1.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=t._vscr_error_ctx_size(),n=t._malloc(r);let s;t._vscr_error_reset(n);try{s=t._vscr_ratchet_group_session_create_group_ticket(this.ctxPtr,n);const r=t._vscr_error_status(n);return e.RatchetError.handleStatusCode(r),e.RatchetGroupTicket.newAndTakeCContext(s)}finally{t._free(n)}}}return r};var RatchetGroupSession=initRatchetGroupSession;const initProject=()=>{const t=new libratchet;return new Promise((e,r)=>{t.onRuntimeInitialized=()=>{const r={};r.FoundationError=FoundationError(),r.FoundationInterface=FoundationInterface(t,r),r.FoundationInterfaceTag=FoundationInterfaceTag(),r.FoundationImplTag=FoundationImplTag(),r.CtrDrbg=CtrDrbg(t,r),r.Hmac=Hmac(t,r),r.Hkdf=Hkdf(t,r),r.Sha512=Sha512(t,r),r.RatchetError=RatchetError(),r.MsgType=MsgType(),r.GroupMsgType=GroupMsgType(),r.RatchetCommon=RatchetCommon(),r.RatchetKeyId=RatchetKeyId(t,r),r.RatchetMessage=RatchetMessage(t,r),r.RatchetSession=RatchetSession(t,r),r.RatchetGroupParticipantsInfo=RatchetGroupParticipantsInfo(t,r),r.RatchetGroupMessage=RatchetGroupMessage(t,r),r.RatchetGroupTicket=RatchetGroupTicket(t,r),r.RatchetGroupParticipantsIds=RatchetGroupParticipantsIds(t),r.RatchetGroupSession=RatchetGroupSession(t,r),e(r)},t.onAbort=t=>{r(new Error(t))}})};var ratchet=initProject;module.exports=ratchet;
