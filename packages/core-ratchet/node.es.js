function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={exports:{}};!function(e,t){var r,n=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(r=r||__filename),function(e={}){var t,r,n=e;n.ready=new Promise(((e,n)=>{t=e,r=n}));var s,a,o,_=Object.assign({},n),i=(e,t)=>{throw t},c=require("fs"),u=require("path");s=__dirname+"/",a=e=>(e=F(e)?new URL(e):u.normalize(e),c.readFileSync(e,void 0)),o=e=>((e=a(e)).buffer||(e=new Uint8Array(e)),e),process.argv.slice(2),i=(e,t)=>{throw process.exitCode=e,t},n.inspect=()=>"[Emscripten Module object]";var l,f=n.print||console.log.bind(console),d=n.printErr||console.error.bind(console);Object.assign(n,_),_=null,n.quit&&(i=n.quit),n.wasmBinary&&(l=n.wasmBinary),"object"!=typeof WebAssembly&&N("no native wasm support detected");var h,v,w,m,p,b,y,E=!1;function P(){var e=h.buffer;n.HEAP8=w=new Int8Array(e),n.HEAP16=p=new Int16Array(e),n.HEAPU8=m=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAP32=b=new Int32Array(e),n.HEAPU32=y=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=new Float64Array(e)}var g=[],I=[],A=[];function x(){var e=n.preRun.shift();g.unshift(e)}var C=0,T=null;function N(e){throw n.onAbort?.(e),d(e="Aborted("+e+")"),E=!0,v=1,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),r(e),e}var R,S,k,F=e=>e.startsWith("file://");if(!(R="libratchet.wasm").startsWith("data:application/octet-stream;base64,")){var L=R;R=n.locateFile?n.locateFile(L,s):s+L}function K(e,t){return function(){var e=R;return Promise.resolve().then((()=>{if(e==R&&l)var t=new Uint8Array(l);else{if(!o)throw"both async and sync fetching of the wasm failed";t=o(e)}return t}))}().then((t=>WebAssembly.instantiate(t,e))).then((e=>e)).then(t,(e=>{d(`failed to asynchronously prepare wasm: ${e}`),N(e)}))}function D(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var O,B=e=>{for(;0<e.length;)e.shift()(n)},M=n.noExitRuntime||!0,U=(e,t)=>{for(var r=0,n=e.length-1;0<=n;n--){var s=e[n];"."===s?e.splice(n,1):".."===s?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},Y=e=>{var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=U(e.split("/").filter((e=>!!e)),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},H=e=>{var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&=t.substr(0,t.length-1),e+t):"."},z=e=>{if("/"===e)return"/";var t=(e=(e=Y(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},G=e=>(G=(()=>{if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues)return e=>crypto.getRandomValues(e);try{var e=require("crypto");if(e.randomFillSync)return t=>e.randomFillSync(t);var t=e.randomBytes;return e=>(e.set(t(e.byteLength)),e)}catch(e){}N("initRandomDevice")})())(e);function $(){for(var e="",t=!1,r=arguments.length-1;-1<=r&&!t;r--){if("string"!=typeof(t=0<=r?arguments[r]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t="/"===t.charAt(0)}return(t?"/":"")+(e=U(e.split("/").filter((e=>!!e)),!t).join("/"))||"."}var q="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,V=(e,t)=>{for(var r=t+NaN,n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.buffer&&q)return q.decode(e.subarray(t,n));for(r="";t<n;){var s=e[t++];if(128&s){var a=63&e[t++];if(192==(224&s))r+=String.fromCharCode((31&s)<<6|a);else{var o=63&e[t++];65536>(s=224==(240&s)?(15&s)<<12|a<<6|o:(7&s)<<18|a<<12|o<<6|63&e[t++])?r+=String.fromCharCode(s):(s-=65536,r+=String.fromCharCode(55296|s>>10,56320|1023&s))}}else r+=String.fromCharCode(s)}return r},Z=[],j=[];function W(e,t){j[e]={input:[],output:[],sb:t},ge(e,X)}var X={open(e){var t=j[e.node.rdev];if(!t)throw new ce(43);e.tty=t,e.seekable=!1},close(e){e.tty.sb.fsync(e.tty)},fsync(e){e.tty.sb.fsync(e.tty)},read(e,t,r,n){if(!e.tty||!e.tty.sb.Gb)throw new ce(60);for(var s=0,a=0;a<n;a++){try{var o=e.tty.sb.Gb(e.tty)}catch(e){throw new ce(29)}if(void 0===o&&0===s)throw new ce(6);if(null==o)break;s++,t[r+a]=o}return s&&(e.node.timestamp=Date.now()),s},write(e,t,r,n){if(!e.tty||!e.tty.sb.Ab)throw new ce(60);try{for(var s=0;s<n;s++)e.tty.sb.Ab(e.tty,t[r+s])}catch(e){throw new ce(29)}return n&&(e.node.timestamp=Date.now()),s}},Q={Gb(){e:{if(!Z.length){var e=null,t=Buffer.alloc(256),r=0,n=process.stdin.fd;try{r=c.readSync(n,t)}catch(e){if(!e.toString().includes("EOF"))throw e;r=0}if(!(e=0<r?t.slice(0,r).toString("utf-8"):null)){t=null;break e}for(r=t=0;r<e.length;++r)127>=(n=e.charCodeAt(r))?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3;var s=(t=Array(t+1)).length;if(r=0,0<s){n=r,s=r+s-1;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),127>=o){if(r>=s)break;t[r++]=o}else{if(2047>=o){if(r+1>=s)break;t[r++]=192|o>>6}else{if(65535>=o){if(r+2>=s)break;t[r++]=224|o>>12}else{if(r+3>=s)break;t[r++]=240|o>>18,t[r++]=128|o>>12&63}t[r++]=128|o>>6&63}t[r++]=128|63&o}}t[r]=0,e=r-n}else e=0;t.length=e,Z=t}t=Z.shift()}return t},Ab(e,t){null===t||10===t?(f(V(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){e.output&&0<e.output.length&&(f(V(e.output,0)),e.output=[])},Mb:()=>({Wb:25856,Yb:5,Vb:191,Xb:35387,Ub:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),Nb:()=>0,Ob:()=>[24,80]},J={Ab(e,t){null===t||10===t?(d(V(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){e.output&&0<e.output.length&&(d(V(e.output,0)),e.output=[])}};function ee(e,t){var r=e.mb?e.mb.length:0;r>=t||(t=Math.max(t,r*(1048576>r?2:1.125)>>>0),0!=r&&(t=Math.max(t,256)),r=e.mb,e.mb=new Uint8Array(t),0<e.ob&&e.mb.set(r.subarray(0,e.ob),0))}var te={pb:null,rb:()=>te.createNode(null,"/",16895,0),createNode(e,t,r,n){if(24576==(61440&r)||4096==(61440&r))throw new ce(63);return te.pb||(te.pb={dir:{node:{tb:te.lb.tb,qb:te.lb.qb,lookup:te.lb.lookup,xb:te.lb.xb,rename:te.lb.rename,unlink:te.lb.unlink,rmdir:te.lb.rmdir,readdir:te.lb.readdir,symlink:te.lb.symlink},stream:{vb:te.nb.vb}},file:{node:{tb:te.lb.tb,qb:te.lb.qb},stream:{vb:te.nb.vb,read:te.nb.read,write:te.nb.write,Cb:te.nb.Cb,Hb:te.nb.Hb,Jb:te.nb.Jb}},link:{node:{tb:te.lb.tb,qb:te.lb.qb,readlink:te.lb.readlink},stream:{}},Db:{node:{tb:te.lb.tb,qb:te.lb.qb},stream:Pe}}),16384==(61440&(r=ve(e,t,r,n)).mode)?(r.lb=te.pb.dir.node,r.nb=te.pb.dir.stream,r.mb={}):32768==(61440&r.mode)?(r.lb=te.pb.file.node,r.nb=te.pb.file.stream,r.ob=0,r.mb=null):40960==(61440&r.mode)?(r.lb=te.pb.link.node,r.nb=te.pb.link.stream):8192==(61440&r.mode)&&(r.lb=te.pb.Db.node,r.nb=te.pb.Db.stream),r.timestamp=Date.now(),e&&(e.mb[t]=r,e.timestamp=r.timestamp),r},Zb:e=>e.mb?e.mb.subarray?e.mb.subarray(0,e.ob):new Uint8Array(e.mb):new Uint8Array(0),lb:{tb(e){var t={};return t.dev=8192==(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,16384==(61440&e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.ob:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.Kb=4096,t.blocks=Math.ceil(t.size/t.Kb),t},qb(e,t){if(void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&(t=t.size,e.ob!=t))if(0==t)e.mb=null,e.ob=0;else{var r=e.mb;e.mb=new Uint8Array(t),r&&e.mb.set(r.subarray(0,Math.min(t,e.ob))),e.ob=t}},lookup(){throw ue[44]},xb:(e,t,r,n)=>te.createNode(e,t,r,n),rename(e,t,r){if(16384==(61440&e.mode)){try{var n=he(t,r)}catch(e){}if(n)for(var s in n.mb)throw new ce(55)}delete e.parent.mb[e.name],e.parent.timestamp=Date.now(),e.name=r,t.mb[r]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink(e,t){delete e.mb[t],e.timestamp=Date.now()},rmdir(e,t){var r,n=he(e,t);for(r in n.mb)throw new ce(55);delete e.mb[t],e.timestamp=Date.now()},readdir(e){var t,r=[".",".."];for(t of Object.keys(e.mb))r.push(t);return r},symlink:(e,t,r)=>((e=te.createNode(e,t,41471,0)).link=r,e),readlink(e){if(40960!=(61440&e.mode))throw new ce(28);return e.link}},nb:{read(e,t,r,n,s){var a=e.node.mb;if(s>=e.node.ob)return 0;if(8<(e=Math.min(e.node.ob-s,n))&&a.subarray)t.set(a.subarray(s,s+e),r);else for(n=0;n<e;n++)t[r+n]=a[s+n];return e},write(e,t,r,n,s,a){if(t.buffer===w.buffer&&(a=!1),!n)return 0;if((e=e.node).timestamp=Date.now(),t.subarray&&(!e.mb||e.mb.subarray)){if(a)return e.mb=t.subarray(r,r+n),e.ob=n;if(0===e.ob&&0===s)return e.mb=t.slice(r,r+n),e.ob=n;if(s+n<=e.ob)return e.mb.set(t.subarray(r,r+n),s),n}if(ee(e,s+n),e.mb.subarray&&t.subarray)e.mb.set(t.subarray(r,r+n),s);else for(a=0;a<n;a++)e.mb[s+a]=t[r+a];return e.ob=Math.max(e.ob,s+n),n},vb(e,t,r){if(1===r?t+=e.position:2===r&&32768==(61440&e.node.mode)&&(t+=e.node.ob),0>t)throw new ce(28);return t},Cb(e,t,r){ee(e.node,t+r),e.node.ob=Math.max(e.node.ob,t+r)},Hb(e,t,r,n,s){if(32768!=(61440&e.node.mode))throw new ce(43);if(e=e.node.mb,2&s||e.buffer!==w.buffer){if((0<r||r+t<e.length)&&(e=e.subarray?e.subarray(r,r+t):Array.prototype.slice.call(e,r,r+t)),r=!0,N(),!(t=void 0))throw new ce(48);w.set(e,t)}else r=!1,t=e.byteOffset;return{ac:t,Tb:r}},Jb:(e,t,r,n)=>(te.nb.write(e,t,0,n,r,!1),0)}},re=(e,t)=>{var r=0;return e&&(r|=365),t&&(r|=146),r},ne=null,se={},ae=[],oe=1,_e=null,ie=!0,ce=null,ue={};function le(e,t={}){if(!(e=$(e)))return{path:"",node:null};if(8<(t=Object.assign({Fb:!0,Bb:0},t)).Bb)throw new ce(32);e=e.split("/").filter((e=>!!e));for(var r=ne,n="/",s=0;s<e.length;s++){var a=s===e.length-1;if(a&&t.parent)break;if(r=he(r,e[s]),n=Y(n+"/"+e[s]),r.yb&&(!a||a&&t.Fb)&&(r=r.yb.root),!a||t.Eb)for(a=0;40960==(61440&r.mode);)if(r=Ne(n),r=le(n=$(H(n),r),{Bb:t.Bb+1}).node,40<a++)throw new ce(32)}return{path:n,node:r}}function fe(e){for(var t;;){if(e===e.parent)return e=e.rb.Ib,t?"/"!==e[e.length-1]?`${e}/${t}`:e+t:e;t=t?`${e.name}/${t}`:e.name,e=e.parent}}function de(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%_e.length}function he(e,t){var r;if(r=(r=me(e,"x"))?r:e.lb.lookup?0:2)throw new ce(r,e);for(r=_e[de(e.id,t)];r;r=r.Qb){var n=r.name;if(r.parent.id===e.id&&n===t)return r}return e.lb.lookup(e,t)}function ve(e,t,r,n){return t=de((e=new Ge(e,t,r,n)).parent.id,e.name),e.Qb=_e[t],_e[t]=e}function we(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t}function me(e,t){return ie?0:!t.includes("r")||292&e.mode?t.includes("w")&&!(146&e.mode)||t.includes("x")&&!(73&e.mode)?2:0:2}function pe(e,t){try{return he(e,t),20}catch(e){}return me(e,"wx")}function be(e){if(!(e=ae[e]))throw new ce(8);return e}function ye(e,t=-1){return Ke||((Ke=function(){this.wb={}}).prototype={},Object.defineProperties(Ke.prototype,{object:{get(){return this.node},set(e){this.node=e}},flags:{get(){return this.wb.flags},set(e){this.wb.flags=e}},position:{get(){return this.wb.position},set(e){this.wb.position=e}}})),e=Object.assign(new Ke,e),-1==t&&(t=function(){for(var e=0;4096>=e;e++)if(!ae[e])return e;throw new ce(33)}()),e.fd=t,ae[t]=e}var Ee,Pe={open(e){e.nb=se[e.node.rdev].nb,e.nb.open?.(e)},vb(){throw new ce(70)}};function ge(e,t){se[e]={nb:t}}function Ie(e,t){var r="/"===t,n=!t;if(r&&ne)throw new ce(10);if(!r&&!n){var s=le(t,{Fb:!1});if(t=s.path,(s=s.node).yb)throw new ce(10);if(16384!=(61440&s.mode))throw new ce(54)}t={type:e,$b:{},Ib:t,Pb:[]},(e=e.rb(t)).rb=t,t.root=e,r?ne=e:s&&(s.yb=t,s.rb&&s.rb.Pb.push(t))}function Ae(e,t,r){var n=le(e,{parent:!0}).node;if(!(e=z(e))||"."===e||".."===e)throw new ce(28);var s=pe(n,e);if(s)throw new ce(s);if(!n.lb.xb)throw new ce(63);return n.lb.xb(n,e,t,r)}function xe(e){return Ae(e,16895,0)}function Ce(e,t,r){void 0===r&&(r=t,t=438),Ae(e,8192|t,r)}function Te(e,t){if(!$(e))throw new ce(44);var r=le(t,{parent:!0}).node;if(!r)throw new ce(44);var n=pe(r,t=z(t));if(n)throw new ce(n);if(!r.lb.symlink)throw new ce(63);r.lb.symlink(r,t,e)}function Ne(e){if(!(e=le(e).node))throw new ce(44);if(!e.lb.readlink)throw new ce(28);return $(fe(e.parent),e.lb.readlink(e))}function Re(e,t,r){if(""===e)throw new ce(44);if("string"==typeof t){var s={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[t];if(void 0===s)throw Error(`Unknown file open mode: ${t}`);t=s}if(r=64&t?4095&(void 0===r?438:r)|32768:0,"object"==typeof e)var a=e;else{e=Y(e);try{a=le(e,{Eb:!(131072&t)}).node}catch(e){}}if(s=!1,64&t)if(a){if(128&t)throw new ce(20)}else a=Ae(e,r,0),s=!0;if(!a)throw new ce(44);if(8192==(61440&a.mode)&&(t&=-513),65536&t&&16384!=(61440&a.mode))throw new ce(54);if(!s&&(r=a?40960==(61440&a.mode)?32:16384==(61440&a.mode)&&("r"!==we(t)||512&t)?31:me(a,we(t)):44))throw new ce(r);if(512&t&&!s){if(!(r="string"==typeof(r=a)?le(r,{Eb:!0}).node:r).lb.qb)throw new ce(63);if(16384==(61440&r.mode))throw new ce(31);if(32768!=(61440&r.mode))throw new ce(28);if(s=me(r,"w"))throw new ce(s);r.lb.qb(r,{size:0,timestamp:Date.now()})}return t&=-131713,(a=ye({node:a,path:fe(a),flags:t,seekable:!0,position:0,nb:a.nb,Sb:[],error:!1})).nb.open&&a.nb.open(a),!n.logReadFiles||1&t||(De||={},e in De||(De[e]=1)),a}function Se(e,t,r){if(null===e.fd)throw new ce(8);if(!e.seekable||!e.nb.vb)throw new ce(70);if(0!=r&&1!=r&&2!=r)throw new ce(28);e.position=e.nb.vb(e,t,r),e.Sb=[]}function ke(){ce||(ce=function(e,t){this.name="ErrnoError",this.node=t,this.Rb=function(e){this.ub=e},this.Rb(e),this.message="FS error"},ce.prototype=Error(),ce.prototype.constructor=ce,[44].forEach((e=>{ue[e]=new ce(e),ue[e].stack="<generic error, no stack>"})))}function Fe(e,t,r){e=Y("/dev/"+e);var n=re(!!t,!!r);Le||=64;var s=Le++<<8|0;ge(s,{open(e){e.seekable=!1},close(){r?.buffer?.length&&r(10)},read(e,r,n,s){for(var a=0,o=0;o<s;o++){try{var _=t()}catch(e){throw new ce(29)}if(void 0===_&&0===a)throw new ce(6);if(null==_)break;a++,r[n+o]=_}return a&&(e.node.timestamp=Date.now()),a},write(e,t,n,s){for(var a=0;a<s;a++)try{r(t[n+a])}catch(e){throw new ce(29)}return s&&(e.node.timestamp=Date.now()),a}}),Ce(e,n,s)}var Le,Ke,De,Oe={},Be=void 0;function Me(){var e=b[+Be>>2];return Be+=4,e}var Ue,Ye={},He=0,ze=e=>{v=e,M||0<He||(n.onExit?.(e),E=!0),i(e,new D(e))};function Ge(e,t,r,n){e||=this,this.parent=e,this.rb=e.rb,this.yb=null,this.id=oe++,this.name=t,this.mode=r,this.lb={},this.nb={},this.rdev=n}Ue=()=>performance.now(),Object.defineProperties(Ge.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}}}),ke(),_e=Array(4096),Ie(te,"/"),xe("/tmp"),xe("/home"),xe("/home/web_user"),function(){xe("/dev"),ge(259,{read:()=>0,write:(e,t,r,n)=>n}),Ce("/dev/null",259),W(1280,Q),W(1536,J),Ce("/dev/tty",1280),Ce("/dev/tty1",1536);var e=new Uint8Array(1024),t=0,r=()=>(0===t&&(t=G(e).byteLength),e[--t]);Fe("random",r),Fe("urandom",r),xe("/dev/shm"),xe("/dev/shm/tmp")}(),function(){xe("/proc");var e=xe("/proc/self");xe("/proc/self/fd"),Ie({rb(){var t=ve(e,"fd",16895,73);return t.lb={lookup(e,t){var r=be(+t);return(e={parent:null,rb:{Ib:"fake"},lb:{readlink:()=>r.path}}).parent=e}},t}},"/proc/self/fd")}();var $e={f:(e,t)=>O.get(e)(t),c:function(e,t,r){Be=r;try{var n=be(e);switch(t){case 0:var s=Me();if(0>s)return-28;for(;ae[s];)s++;return ye(n,s).fd;case 1:case 2:case 6:case 7:return 0;case 3:return n.flags;case 4:return s=Me(),n.flags|=s,0;case 5:return s=Me(),p[s+0>>1]=2,0;case 16:case 8:default:return-28;case 9:return b[Ze()>>2]=28,-1}}catch(e){if(void 0===Oe||"ErrnoError"!==e.name)throw e;return-e.ub}},n:function(e,t,r){Be=r;try{var n=be(e);switch(t){case 21509:case 21510:case 21511:case 21512:case 21524:case 21515:return n.tty?0:-59;case 21505:if(!n.tty)return-59;if(n.tty.sb.Mb){t=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var s=Me();b[s>>2]=25856,b[s+4>>2]=5,b[s+8>>2]=191,b[s+12>>2]=35387;for(var a=0;32>a;a++)w[s+a+17>>0]=t[a]||0}return 0;case 21506:case 21507:case 21508:if(!n.tty)return-59;if(n.tty.sb.Nb)for(s=Me(),t=[],a=0;32>a;a++)t.push(w[s+a+17>>0]);return 0;case 21519:return n.tty?(s=Me(),b[s>>2]=0):-59;case 21520:return n.tty?-28:-59;case 21531:if(s=Me(),!n.nb.Lb)throw new ce(59);return n.nb.Lb(n,t,s);case 21523:return n.tty?(n.tty.sb.Ob&&(a=[24,80],s=Me(),p[s>>1]=a[0],p[s+2>>1]=a[1]),0):-59;default:return-28}}catch(e){if(void 0===Oe||"ErrnoError"!==e.name)throw e;return-e.ub}},e:function(e,t,r,n){Be=n;try{var s=t=t?V(m,t):"";if("/"===s.charAt(0))t=s;else{var a=-100===e?"/":be(e).path;if(0==s.length)throw new ce(44);t=Y(a+"/"+s)}return Re(t,r,n?Me():0).fd}catch(e){if(void 0===Oe||"ErrnoError"!==e.name)throw e;return-e.ub}},h:()=>{M=!1,He=0},i:(e,t)=>{if(Ye[e]&&(clearTimeout(Ye[e].id),delete Ye[e]),!t)return 0;var r=setTimeout((()=>{delete Ye[e],(e=>{if(!E)try{if(e(),!(M||0<He))try{v=e=v,ze(e)}catch(e){e instanceof D||"unwind"==e||i(1,e)}}catch(e){e instanceof D||"unwind"==e||i(1,e)}})((()=>je(e,Ue())))}),t);return Ye[e]={id:r,bc:t},0},a:()=>{N("")},j:()=>Date.now(),o:(e,t,r)=>m.copyWithin(e,t,t+r),k:e=>{var t=m.length;if(2147483648<(e>>>=0))return!1;for(var r=1;4>=r;r*=2){var n=t*(1+.2/r);n=Math.min(n,e+100663296);var s=Math;n=Math.max(e,n);e:{s=(s.min.call(s,2147483648,n+(65536-n%65536)%65536)-h.buffer.byteLength+65535)/65536;try{h.grow(s),P();var a=1;break e}catch(e){}a=void 0}if(a)return!0}return!1},b:function(e){try{var t=be(e);if(null===t.fd)throw new ce(8);t.zb&&(t.zb=null);try{t.nb.close&&t.nb.close(t)}catch(e){throw e}finally{ae[t.fd]=null}return t.fd=null,0}catch(e){if(void 0===Oe||"ErrnoError"!==e.name)throw e;return e.ub}},m:function(e,t,r,n){try{e:{var s=be(e);e=t;for(var a,o=t=0;o<r;o++){var _=y[e>>2],i=y[e+4>>2];e+=8;var c=s,u=_,l=i,f=a,d=w;if(0>l||0>f)throw new ce(28);if(null===c.fd)throw new ce(8);if(1==(2097155&c.flags))throw new ce(8);if(16384==(61440&c.node.mode))throw new ce(31);if(!c.nb.read)throw new ce(28);var h=void 0!==f;if(h){if(!c.seekable)throw new ce(70)}else f=c.position;var v=c.nb.read(c,d,u,l,f);h||(c.position+=v);var m=v;if(0>m){var p=-1;break e}if(t+=m,m<i)break;void 0!==a&&(a+=m)}p=t}return y[n>>2]=p,0}catch(e){if(void 0===Oe||"ErrnoError"!==e.name)throw e;return e.ub}},l:function(e,t,r,n,s){t=r+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*r:NaN;try{if(isNaN(t))return 61;var a=be(e);return Se(a,t,n),k=[a.position>>>0,(S=a.position,1<=+Math.abs(S)?0<S?+Math.floor(S/4294967296)>>>0:~~+Math.ceil((S-+(~~S>>>0))/4294967296)>>>0:0)],b[s>>2]=k[0],b[s+4>>2]=k[1],a.zb&&0===t&&0===n&&(a.zb=null),0}catch(e){if(void 0===Oe||"ErrnoError"!==e.name)throw e;return e.ub}},d:function(e,t,r,n){try{e:{var s=be(e);e=t;for(var a,o=t=0;o<r;o++){var _=y[e>>2],i=y[e+4>>2];e+=8;var c=s,u=_,l=i,f=a,d=w;if(0>l||0>f)throw new ce(28);if(null===c.fd)throw new ce(8);if(0==(2097155&c.flags))throw new ce(8);if(16384==(61440&c.node.mode))throw new ce(31);if(!c.nb.write)throw new ce(28);c.seekable&&1024&c.flags&&Se(c,0,2);var h=void 0!==f;if(h){if(!c.seekable)throw new ce(70)}else f=c.position;var v=c.nb.write(c,d,u,l,f,void 0);h||(c.position+=v);var m=v;if(0>m){var p=-1;break e}t+=m,void 0!==a&&(a+=m)}p=t}return y[n>>2]=p,0}catch(e){if(void 0===Oe||"ErrnoError"!==e.name)throw e;return e.ub}},g:ze},qe=function(){function e(e){return qe=e.exports,h=qe.p,P(),O=qe.kb,I.unshift(qe.q),C--,n.monitorRunDependencies?.(C),0==C&&T&&(e=T,T=null,e()),qe}var t={a:$e};if(C++,n.monitorRunDependencies?.(C),n.instantiateWasm)try{return n.instantiateWasm(t,e)}catch(e){d(`Module.instantiateWasm callback failed with error: ${e}`),r(e)}return function(e,t){return K(e,t)}(t,(function(t){e(t.instance)})).catch(r),{}}();n._vscr_error_ctx_size=()=>(n._vscr_error_ctx_size=qe.r)(),n._vscr_error_reset=e=>(n._vscr_error_reset=qe.s)(e),n._vscr_error_status=e=>(n._vscr_error_status=qe.t)(e),n._vscr_ratchet_message_new=()=>(n._vscr_ratchet_message_new=qe.u)(),n._vscr_ratchet_message_delete=e=>(n._vscr_ratchet_message_delete=qe.v)(e),n._vscr_ratchet_message_shallow_copy=e=>(n._vscr_ratchet_message_shallow_copy=qe.w)(e),n._vscr_ratchet_message_get_type=e=>(n._vscr_ratchet_message_get_type=qe.x)(e),n._vscr_ratchet_message_get_counter=e=>(n._vscr_ratchet_message_get_counter=qe.y)(e),n._vscr_ratchet_message_get_sender_identity_key_id=(e,t)=>(n._vscr_ratchet_message_get_sender_identity_key_id=qe.z)(e,t),n._vscr_ratchet_message_get_receiver_identity_key_id=(e,t)=>(n._vscr_ratchet_message_get_receiver_identity_key_id=qe.A)(e,t),n._vscr_ratchet_message_get_receiver_long_term_key_id=(e,t)=>(n._vscr_ratchet_message_get_receiver_long_term_key_id=qe.B)(e,t),n._vscr_ratchet_message_get_receiver_one_time_key_id=(e,t)=>(n._vscr_ratchet_message_get_receiver_one_time_key_id=qe.C)(e,t),n._vscr_ratchet_message_serialize_len=e=>(n._vscr_ratchet_message_serialize_len=qe.D)(e),n._vscr_ratchet_message_serialize=(e,t)=>(n._vscr_ratchet_message_serialize=qe.E)(e,t),n._vscr_ratchet_message_deserialize=(e,t)=>(n._vscr_ratchet_message_deserialize=qe.F)(e,t),n._vscr_ratchet_session_release_rng=e=>(n._vscr_ratchet_session_release_rng=qe.G)(e),n._vscr_ratchet_session_new=()=>(n._vscr_ratchet_session_new=qe.H)(),n._vscr_ratchet_session_delete=e=>(n._vscr_ratchet_session_delete=qe.I)(e),n._vscr_ratchet_session_shallow_copy=e=>(n._vscr_ratchet_session_shallow_copy=qe.J)(e),n._vscr_ratchet_session_use_rng=(e,t)=>(n._vscr_ratchet_session_use_rng=qe.K)(e,t),n._vscr_ratchet_session_setup_defaults=e=>(n._vscr_ratchet_session_setup_defaults=qe.L)(e),n._vscr_ratchet_session_initiate=(e,t,r,s,a,o,_,i,c,u)=>(n._vscr_ratchet_session_initiate=qe.M)(e,t,r,s,a,o,_,i,c,u),n._vscr_ratchet_session_initiate_no_one_time_key=(e,t,r,s,a,o,_,i)=>(n._vscr_ratchet_session_initiate_no_one_time_key=qe.N)(e,t,r,s,a,o,_,i),n._vscr_ratchet_session_respond=(e,t,r,s,a,o,_)=>(n._vscr_ratchet_session_respond=qe.O)(e,t,r,s,a,o,_),n._vscr_ratchet_session_respond_no_one_time_key=(e,t,r,s,a,o)=>(n._vscr_ratchet_session_respond_no_one_time_key=qe.P)(e,t,r,s,a,o),n._vscr_ratchet_session_is_initiator=e=>(n._vscr_ratchet_session_is_initiator=qe.Q)(e),n._vscr_ratchet_session_is_pqc_enabled=e=>(n._vscr_ratchet_session_is_pqc_enabled=qe.R)(e),n._vscr_ratchet_session_received_first_response=e=>(n._vscr_ratchet_session_received_first_response=qe.S)(e),n._vscr_ratchet_session_receiver_has_one_time_public_key=e=>(n._vscr_ratchet_session_receiver_has_one_time_public_key=qe.T)(e),n._vscr_ratchet_session_encrypt=(e,t,r)=>(n._vscr_ratchet_session_encrypt=qe.U)(e,t,r),n._vscr_ratchet_session_decrypt_len=(e,t)=>(n._vscr_ratchet_session_decrypt_len=qe.V)(e,t),n._vscr_ratchet_session_decrypt=(e,t,r)=>(n._vscr_ratchet_session_decrypt=qe.W)(e,t,r),n._vscr_ratchet_session_serialize=e=>(n._vscr_ratchet_session_serialize=qe.X)(e),n._vscr_ratchet_session_deserialize=(e,t)=>(n._vscr_ratchet_session_deserialize=qe.Y)(e,t),n._vscf_impl_api=(e,t)=>(n._vscf_impl_api=qe.Z)(e,t),n._vscf_impl_tag=e=>(n._vscf_impl_tag=qe._)(e),n._vscf_impl_shallow_copy=e=>(n._vscf_impl_shallow_copy=qe.$)(e),n._vscf_ctr_drbg_setup_defaults=e=>(n._vscf_ctr_drbg_setup_defaults=qe.aa)(e),n._vscf_ctr_drbg_enable_prediction_resistance=e=>(n._vscf_ctr_drbg_enable_prediction_resistance=qe.ba)(e),n._vscf_ctr_drbg_set_reseed_interval=(e,t)=>(n._vscf_ctr_drbg_set_reseed_interval=qe.ca)(e,t),n._vscf_ctr_drbg_set_entropy_len=(e,t)=>(n._vscf_ctr_drbg_set_entropy_len=qe.da)(e,t),n._vscf_ctr_drbg_random=(e,t,r)=>(n._vscf_ctr_drbg_random=qe.ea)(e,t,r),n._vscf_ctr_drbg_reseed=e=>(n._vscf_ctr_drbg_reseed=qe.fa)(e),n._vscf_ctr_drbg_release_entropy_source=e=>(n._vscf_ctr_drbg_release_entropy_source=qe.ga)(e),n._vscf_ctr_drbg_new=()=>(n._vscf_ctr_drbg_new=qe.ha)(),n._vscf_ctr_drbg_delete=e=>(n._vscf_ctr_drbg_delete=qe.ia)(e),n._vscf_ctr_drbg_shallow_copy=e=>(n._vscf_ctr_drbg_shallow_copy=qe.ja)(e),n._vscf_ctr_drbg_use_entropy_source=(e,t)=>(n._vscf_ctr_drbg_use_entropy_source=qe.ka)(e,t),n._vscf_hkdf_alg_id=e=>(n._vscf_hkdf_alg_id=qe.la)(e),n._vscf_hkdf_produce_alg_info=e=>(n._vscf_hkdf_produce_alg_info=qe.ma)(e),n._vscf_hkdf_restore_alg_info=(e,t)=>(n._vscf_hkdf_restore_alg_info=qe.na)(e,t),n._vscf_hkdf_derive=(e,t,r,s)=>(n._vscf_hkdf_derive=qe.oa)(e,t,r,s),n._vscf_hkdf_reset=(e,t,r)=>(n._vscf_hkdf_reset=qe.pa)(e,t,r),n._vscf_hkdf_set_info=(e,t)=>(n._vscf_hkdf_set_info=qe.qa)(e,t),n._vscf_hkdf_release_hash=e=>(n._vscf_hkdf_release_hash=qe.ra)(e),n._vscf_hkdf_new=()=>(n._vscf_hkdf_new=qe.sa)(),n._vscf_hkdf_delete=e=>(n._vscf_hkdf_delete=qe.ta)(e),n._vscf_hkdf_shallow_copy=e=>(n._vscf_hkdf_shallow_copy=qe.ua)(e),n._vscf_hkdf_use_hash=(e,t)=>(n._vscf_hkdf_use_hash=qe.va)(e,t),n._vscf_hmac_alg_id=e=>(n._vscf_hmac_alg_id=qe.wa)(e),n._vscf_hmac_produce_alg_info=e=>(n._vscf_hmac_produce_alg_info=qe.xa)(e),n._vscf_hmac_restore_alg_info=(e,t)=>(n._vscf_hmac_restore_alg_info=qe.ya)(e,t),n._vscf_hmac_digest_len=e=>(n._vscf_hmac_digest_len=qe.za)(e),n._vscf_hmac_mac=(e,t,r,s)=>(n._vscf_hmac_mac=qe.Aa)(e,t,r,s),n._vscf_hmac_start=(e,t)=>(n._vscf_hmac_start=qe.Ba)(e,t),n._vscf_hmac_finish=(e,t)=>(n._vscf_hmac_finish=qe.Ca)(e,t),n._vscf_hmac_update=(e,t)=>(n._vscf_hmac_update=qe.Da)(e,t),n._vscf_hmac_reset=e=>(n._vscf_hmac_reset=qe.Ea)(e),n._vscf_hmac_release_hash=e=>(n._vscf_hmac_release_hash=qe.Fa)(e),n._vscf_hmac_new=()=>(n._vscf_hmac_new=qe.Ga)(),n._vscf_hmac_delete=e=>(n._vscf_hmac_delete=qe.Ha)(e),n._vscf_hmac_shallow_copy=e=>(n._vscf_hmac_shallow_copy=qe.Ia)(e),n._vscf_hmac_use_hash=(e,t)=>(n._vscf_hmac_use_hash=qe.Ja)(e,t),n._vscf_sha512_alg_id=e=>(n._vscf_sha512_alg_id=qe.Ka)(e),n._vscf_sha512_produce_alg_info=e=>(n._vscf_sha512_produce_alg_info=qe.La)(e),n._vscf_sha512_restore_alg_info=(e,t)=>(n._vscf_sha512_restore_alg_info=qe.Ma)(e,t),n._vscf_sha512_hash=(e,t)=>(n._vscf_sha512_hash=qe.Na)(e,t),n._vscf_sha512_finish=(e,t)=>(n._vscf_sha512_finish=qe.Oa)(e,t),n._vscf_sha512_start=e=>(n._vscf_sha512_start=qe.Pa)(e),n._vscf_sha512_update=(e,t)=>(n._vscf_sha512_update=qe.Qa)(e,t),n._vscf_sha512_new=()=>(n._vscf_sha512_new=qe.Ra)(),n._vscf_sha512_delete=e=>(n._vscf_sha512_delete=qe.Sa)(e),n._vscf_sha512_shallow_copy=e=>(n._vscf_sha512_shallow_copy=qe.Ta)(e),n._vscf_error_ctx_size=()=>(n._vscf_error_ctx_size=qe.Ua)(),n._vscf_error_reset=e=>(n._vscf_error_reset=qe.Va)(e),n._vscf_error_status=e=>(n._vscf_error_status=qe.Wa)(e),n._vsc_buffer_new=()=>(n._vsc_buffer_new=qe.Xa)(),n._vsc_buffer_new_with_capacity=e=>(n._vsc_buffer_new_with_capacity=qe.Ya)(e),n._vsc_buffer_delete=e=>(n._vsc_buffer_delete=qe.Za)(e),n._vsc_buffer_data=(e,t)=>(n._vsc_buffer_data=qe._a)(e,t),n._vsc_buffer_make_secure=e=>(n._vsc_buffer_make_secure=qe.$a)(e),n._vsc_buffer_bytes=e=>(n._vsc_buffer_bytes=qe.ab)(e),n._vsc_buffer_len=e=>(n._vsc_buffer_len=qe.bb)(e),n._vsc_data_ctx_size=()=>(n._vsc_data_ctx_size=qe.cb)(),n._vsc_data=(e,t,r)=>(n._vsc_data=qe.db)(e,t,r),n._vsc_data_len=e=>(n._vsc_data_len=qe.eb)(e),n._vsc_data_bytes=e=>(n._vsc_data_bytes=qe.fb)(e);var Ve,Ze=()=>(Ze=qe.gb)(),je=(e,t)=>(je=qe.hb)(e,t);function We(){function e(){if(!Ve&&(Ve=!0,n.calledRun=!0,!E)){if(n.noFSInit||Ee||(Ee=!0,ke(),n.stdin=n.stdin,n.stdout=n.stdout,n.stderr=n.stderr,n.stdin?Fe("stdin",n.stdin):Te("/dev/tty","/dev/stdin"),n.stdout?Fe("stdout",null,n.stdout):Te("/dev/tty","/dev/stdout"),n.stderr?Fe("stderr",null,n.stderr):Te("/dev/tty1","/dev/stderr"),Re("/dev/stdin",0),Re("/dev/stdout",1),Re("/dev/stderr",1)),ie=!1,B(I),t(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;){var e=n.postRun.shift();A.unshift(e)}B(A)}}if(!(0<C)){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)x();B(g),0<C||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),e()}),1)):e())}}if(n._malloc=e=>(n._malloc=qe.ib)(e),n._free=e=>(n._free=qe.jb)(e),T=function e(){Ve||We(),Ve||(T=e)},n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);0<n.preInit.length;)n.preInit.pop()();return We(),e.ready});e.exports=n}(t);var r=t.exports;var n=(e,t)=>{class r extends Error{constructor(e){super(e),this.name="FoundationError",this.message=e}static handleStatusCode(e){if(0!=e){if(-1==e)throw new r("This error should not be returned if assertions is enabled.");if(-2==e)throw new r("Can be used to define that not all context prerequisites are satisfied. Note, this error should not be returned if assertions is enabled.");if(-3==e)throw new r("Define that error code from one of third-party module was not handled. Note, this error should not be returned if assertions is enabled.");if(-101==e)throw new r("Buffer capacity is not enough to hold result.");if(-200==e)throw new r("Unsupported algorithm.");if(-201==e)throw new r("Authentication failed during decryption.");if(-202==e)throw new r("Attempt to read data out of buffer bounds.");if(-203==e)throw new r("ASN.1 encoded data is corrupted.");if(-204==e)throw new r("Attempt to read ASN.1 type that is bigger then requested C type.");if(-205==e)throw new r("ASN.1 representation of PKCS#1 public key is corrupted.");if(-206==e)throw new r("ASN.1 representation of PKCS#1 private key is corrupted.");if(-207==e)throw new r("ASN.1 representation of PKCS#8 public key is corrupted.");if(-208==e)throw new r("ASN.1 representation of PKCS#8 private key is corrupted.");if(-209==e)throw new r("Encrypted data is corrupted.");if(-210==e)throw new r("Underlying random operation returns error.");if(-211==e)throw new r("Generation of the private or secret key failed.");if(-212==e)throw new r("One of the entropy sources failed.");if(-213==e)throw new r("Requested data to be generated is too big.");if(-214==e)throw new r("Base64 encoded string contains invalid characters.");if(-215==e)throw new r("PEM data is corrupted.");if(-216==e)throw new r("Exchange key return zero.");if(-217==e)throw new r("Ed25519 public key is corrupted.");if(-218==e)throw new r("Ed25519 private key is corrupted.");if(-219==e)throw new r("CURVE25519 public key is corrupted.");if(-220==e)throw new r("CURVE25519 private key is corrupted.");if(-221==e)throw new r("Elliptic curve public key format is corrupted see RFC 5480.");if(-222==e)throw new r("Elliptic curve public key format is corrupted see RFC 5915.");if(-223==e)throw new r("ASN.1 representation of a public key is corrupted.");if(-224==e)throw new r("ASN.1 representation of a private key is corrupted.");if(-225==e)throw new r("Key algorithm does not accept given type of public key.");if(-226==e)throw new r("Key algorithm does not accept given type of private key.");if(-227==e)throw new r("Post-quantum Falcon-Sign public key is corrupted.");if(-228==e)throw new r("Post-quantum Falcon-Sign private key is corrupted.");if(-229==e)throw new r("Generic Round5 library error.");if(-230==e)throw new r("Post-quantum NIST Round5 public key is corrupted.");if(-231==e)throw new r("Post-quantum NIST Round5 private key is corrupted.");if(-232==e)throw new r("Compound public key is corrupted.");if(-233==e)throw new r("Compound private key is corrupted.");if(-234==e)throw new r("Compound public hybrid key is corrupted.");if(-235==e)throw new r("Compound private hybrid key is corrupted.");if(-236==e)throw new r("ASN.1 AlgorithmIdentifer is corrupted.");if(-237==e)throw new r("ASN.1 AlgorithmIdentifer with ECParameters is corrupted.");if(-238==e)throw new r("ASN.1 AlgorithmIdentifer with CompoundKeyParams is corrupted.");if(-239==e)throw new r("ASN.1 AlgorithmIdentifer with HybridKeyParams is corrupted.");if(-301==e)throw new r("Decryption failed, because message info was not given explicitly, and was not part of an encrypted message.");if(-302==e)throw new r("Message Info is corrupted.");if(-303==e)throw new r("Recipient defined with id is not found within message info during data decryption.");if(-304==e)throw new r("Content encryption key can not be decrypted with a given private key.");if(-305==e)throw new r("Content encryption key can not be decrypted with a given password.");if(-306==e)throw new r("Custom parameter with a given key is not found within message info.");if(-307==e)throw new r("A custom parameter with a given key is found, but the requested value type does not correspond to the actual type.");if(-308==e)throw new r("Signature format is corrupted.");if(-309==e)throw new r("Message Info footer is corrupted.");if(-401==e)throw new r("Brainkey password length is out of range.");if(-402==e)throw new r("Brainkey number length should be 32 byte.");if(-403==e)throw new r("Brainkey point length should be 65 bytes.");if(-404==e)throw new r("Brainkey name is out of range.");if(-405==e)throw new r("Brainkey internal error.");if(-406==e)throw new r("Brainkey point is invalid.");if(-407==e)throw new r("Brainkey number buffer length capacity should be >= 32 byte.");if(-408==e)throw new r("Brainkey point buffer length capacity should be >= 32 byte.");if(-409==e)throw new r("Brainkey seed buffer length capacity should be >= 32 byte.");if(-410==e)throw new r("Brainkey identity secret is invalid.");if(-411==e)throw new r("KEM encapsulated key is invalid or does not correspond to the private key.");if(-501==e)throw new r("Invalid padding.");if(-601==e)throw new r("Protobuf error.");if(-701==e)throw new r("Session id doesnt match.");if(-702==e)throw new r("Epoch not found.");if(-703==e)throw new r("Wrong key type.");if(-704==e)throw new r("Invalid signature.");if(-705==e)throw new r("Ed25519 error.");if(-706==e)throw new r("Duplicate epoch.");if(-707==e)throw new r("Plain text too long.");throw new r("Unexpected status code:"+e)}}}return r};var s=(e,t)=>class{static newAndTakeCContext(r){const n=e._vscf_impl_tag(r);switch(n){case t.FoundationImplTag.SHA224:return t.Sha224.newAndTakeCContext(r);case t.FoundationImplTag.SHA256:return t.Sha256.newAndTakeCContext(r);case t.FoundationImplTag.SHA384:return t.Sha384.newAndTakeCContext(r);case t.FoundationImplTag.SHA512:return t.Sha512.newAndTakeCContext(r);case t.FoundationImplTag.AES256_GCM:return t.Aes256Gcm.newAndTakeCContext(r);case t.FoundationImplTag.AES256_CBC:return t.Aes256Cbc.newAndTakeCContext(r);case t.FoundationImplTag.ASN1RD:return t.Asn1rd.newAndTakeCContext(r);case t.FoundationImplTag.ASN1WR:return t.Asn1wr.newAndTakeCContext(r);case t.FoundationImplTag.RSA_PUBLIC_KEY:return t.RsaPublicKey.newAndTakeCContext(r);case t.FoundationImplTag.RSA_PRIVATE_KEY:return t.RsaPrivateKey.newAndTakeCContext(r);case t.FoundationImplTag.RSA:return t.Rsa.newAndTakeCContext(r);case t.FoundationImplTag.ECC_PUBLIC_KEY:return t.EccPublicKey.newAndTakeCContext(r);case t.FoundationImplTag.ECC_PRIVATE_KEY:return t.EccPrivateKey.newAndTakeCContext(r);case t.FoundationImplTag.ECC:return t.Ecc.newAndTakeCContext(r);case t.FoundationImplTag.ENTROPY_ACCUMULATOR:return t.EntropyAccumulator.newAndTakeCContext(r);case t.FoundationImplTag.CTR_DRBG:return t.CtrDrbg.newAndTakeCContext(r);case t.FoundationImplTag.HMAC:return t.Hmac.newAndTakeCContext(r);case t.FoundationImplTag.HKDF:return t.Hkdf.newAndTakeCContext(r);case t.FoundationImplTag.KDF1:return t.Kdf1.newAndTakeCContext(r);case t.FoundationImplTag.KDF2:return t.Kdf2.newAndTakeCContext(r);case t.FoundationImplTag.FAKE_RANDOM:return t.FakeRandom.newAndTakeCContext(r);case t.FoundationImplTag.PKCS5_PBKDF2:return t.Pkcs5Pbkdf2.newAndTakeCContext(r);case t.FoundationImplTag.PKCS5_PBES2:return t.Pkcs5Pbes2.newAndTakeCContext(r);case t.FoundationImplTag.SEED_ENTROPY_SOURCE:return t.SeedEntropySource.newAndTakeCContext(r);case t.FoundationImplTag.KEY_MATERIAL_RNG:return t.KeyMaterialRng.newAndTakeCContext(r);case t.FoundationImplTag.RAW_PUBLIC_KEY:return t.RawPublicKey.newAndTakeCContext(r);case t.FoundationImplTag.RAW_PRIVATE_KEY:return t.RawPrivateKey.newAndTakeCContext(r);case t.FoundationImplTag.PKCS8_SERIALIZER:return t.Pkcs8Serializer.newAndTakeCContext(r);case t.FoundationImplTag.SEC1_SERIALIZER:return t.Sec1Serializer.newAndTakeCContext(r);case t.FoundationImplTag.KEY_ASN1_SERIALIZER:return t.KeyAsn1Serializer.newAndTakeCContext(r);case t.FoundationImplTag.KEY_ASN1_DESERIALIZER:return t.KeyAsn1Deserializer.newAndTakeCContext(r);case t.FoundationImplTag.ED25519:return t.Ed25519.newAndTakeCContext(r);case t.FoundationImplTag.CURVE25519:return t.Curve25519.newAndTakeCContext(r);case t.FoundationImplTag.FALCON:return t.Falcon.newAndTakeCContext(r);case t.FoundationImplTag.ROUND5:return t.Round5.newAndTakeCContext(r);case t.FoundationImplTag.COMPOUND_KEY_ALG_INFO:return t.CompoundKeyAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.COMPOUND_PUBLIC_KEY:return t.CompoundPublicKey.newAndTakeCContext(r);case t.FoundationImplTag.COMPOUND_PRIVATE_KEY:return t.CompoundPrivateKey.newAndTakeCContext(r);case t.FoundationImplTag.COMPOUND_KEY_ALG:return t.CompoundKeyAlg.newAndTakeCContext(r);case t.FoundationImplTag.HYBRID_KEY_ALG_INFO:return t.HybridKeyAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.HYBRID_PUBLIC_KEY:return t.HybridPublicKey.newAndTakeCContext(r);case t.FoundationImplTag.HYBRID_PRIVATE_KEY:return t.HybridPrivateKey.newAndTakeCContext(r);case t.FoundationImplTag.HYBRID_KEY_ALG:return t.HybridKeyAlg.newAndTakeCContext(r);case t.FoundationImplTag.SIMPLE_ALG_INFO:return t.SimpleAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.HASH_BASED_ALG_INFO:return t.HashBasedAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.CIPHER_ALG_INFO:return t.CipherAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.SALTED_KDF_ALG_INFO:return t.SaltedKdfAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.PBE_ALG_INFO:return t.PbeAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.ECC_ALG_INFO:return t.EccAlgInfo.newAndTakeCContext(r);case t.FoundationImplTag.ALG_INFO_DER_SERIALIZER:return t.AlgInfoDerSerializer.newAndTakeCContext(r);case t.FoundationImplTag.ALG_INFO_DER_DESERIALIZER:return t.AlgInfoDerDeserializer.newAndTakeCContext(r);case t.FoundationImplTag.MESSAGE_INFO_DER_SERIALIZER:return t.MessageInfoDerSerializer.newAndTakeCContext(r);case t.FoundationImplTag.RANDOM_PADDING:return t.RandomPadding.newAndTakeCContext(r);default:throw new Error("Unexpected implementation tag found: "+n)}}static newAndUseCContext(r){return new t.FoundationInterface.newAndTakeCContext(e._vscf_impl_shallow_copy(r))}static isImplemented(t,r){return 0!=e._vscf_impl_api(t,r)}};var a=(e,t)=>Object.freeze({ALG:1,ALG_INFO:2,ALG_INFO_DESERIALIZER:3,ALG_INFO_SERIALIZER:4,ASN1_READER:5,ASN1_WRITER:6,AUTH_DECRYPT:7,AUTH_ENCRYPT:8,CIPHER:9,CIPHER_AUTH:10,CIPHER_AUTH_INFO:11,CIPHER_INFO:12,COMPUTE_SHARED_KEY:13,DECRYPT:14,ENCRYPT:15,ENTROPY_SOURCE:16,HASH:17,KDF:18,KEM:19,KEY:20,KEY_ALG:21,KEY_CIPHER:22,KEY_DESERIALIZER:23,KEY_SERIALIZER:24,KEY_SIGNER:25,MAC:26,MESSAGE_INFO_FOOTER_SERIALIZER:27,MESSAGE_INFO_SERIALIZER:28,PADDING:29,PRIVATE_KEY:30,PUBLIC_KEY:31,RANDOM:32,SALTED_KDF:33});var o=(e,t)=>Object.freeze({AES256_CBC:1,AES256_GCM:2,ALG_INFO_DER_DESERIALIZER:3,ALG_INFO_DER_SERIALIZER:4,ASN1RD:5,ASN1WR:6,CIPHER_ALG_INFO:7,COMPOUND_KEY_ALG:8,COMPOUND_KEY_ALG_INFO:9,COMPOUND_PRIVATE_KEY:10,COMPOUND_PUBLIC_KEY:11,CTR_DRBG:12,CURVE25519:13,ECC:14,ECC_ALG_INFO:15,ECC_PRIVATE_KEY:16,ECC_PUBLIC_KEY:17,ED25519:18,ENTROPY_ACCUMULATOR:19,FAKE_RANDOM:20,FALCON:21,HASH_BASED_ALG_INFO:22,HKDF:23,HMAC:24,HYBRID_KEY_ALG:25,HYBRID_KEY_ALG_INFO:26,HYBRID_PRIVATE_KEY:27,HYBRID_PUBLIC_KEY:28,KDF1:29,KDF2:30,KEY_ASN1_DESERIALIZER:31,KEY_ASN1_SERIALIZER:32,KEY_MATERIAL_RNG:33,MESSAGE_INFO_DER_SERIALIZER:34,PBE_ALG_INFO:35,PKCS5_PBES2:36,PKCS5_PBKDF2:37,PKCS8_SERIALIZER:38,RANDOM_PADDING:39,RAW_PRIVATE_KEY:40,RAW_PUBLIC_KEY:41,ROUND5:42,RSA:43,RSA_PRIVATE_KEY:44,RSA_PUBLIC_KEY:45,SALTED_KDF_ALG_INFO:46,SEC1_SERIALIZER:47,SEED_ENTROPY_SOURCE:48,SHA224:49,SHA256:50,SHA384:51,SHA512:52,SIMPLE_ALG_INFO:53}),_={};function i(e,t){if(!("number"==typeof t||t instanceof Number))throw new TypeError(`'${e}' is not a number`);if(Number.isNaN(t))throw new TypeError(`'${e}' is NaN`);if(t===1/0)throw new TypeError(`'${e}' is Infinity`);if(t===-1/0)throw new TypeError(`'${e}' is -Infinity`)}function c(e,t){if(i(e,t),0==t)throw new TypeError(`'${e}' is NULL`)}_.ensureNumber=i,_.ensureString=function(e,t){if(!("string"==typeof t||t instanceof String))throw new TypeError(`'${e}' is not a string`)},_.ensureBoolean=function(e,t){if("boolean"!=typeof t)throw new TypeError(`'${e}' is not a boolean`)},_.ensureByteArray=function(e,t){if(!(t instanceof Uint8Array))throw new TypeError(`'${e}' is not an Uint8Array`)},_.ensureClass=function(e,t,r){if(!(t instanceof r))throw new TypeError(`'${e}' is not an instance of the class ${r.name}`);c(e,t.ctxPtr)},_.ensureNotNull=c,_.ensureImplementInterface=function(e,t,r,n,s){if(c(e,t.ctxPtr),!s.isImplemented(t.ctxPtr,n))throw new TypeError(`'${e}' does not implement interface '${r}'`)};const u=_;var l=(e,t)=>{class r{static get RESEED_INTERVAL(){return 1e4}get RESEED_INTERVAL(){return r.RESEED_INTERVAL}static get ENTROPY_LEN(){return 48}get ENTROPY_LEN(){return r.ENTROPY_LEN}constructor(t){this.name="CtrDrbg",this.ctxPtr=void 0===t?e._vscf_ctr_drbg_new():t}static newAndUseCContext(t){return new r(e._vscf_ctr_drbg_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscf_ctr_drbg_delete(this.ctxPtr),this.ctxPtr=null)}set entropySource(r){u.ensureNotNull("this.ctxPtr",this.ctxPtr),u.ensureImplementInterface("entropySource",r,"Foundation.EntropySource",t.FoundationInterfaceTag.ENTROPY_SOURCE,t.FoundationInterface),e._vscf_ctr_drbg_release_entropy_source(this.ctxPtr);const n=e._vscf_ctr_drbg_use_entropy_source(this.ctxPtr,r.ctxPtr);t.FoundationError.handleStatusCode(n)}random(r){u.ensureNotNull("this.ctxPtr",this.ctxPtr),u.ensureNumber("dataLen",r);const n=r,s=e._vsc_buffer_new_with_capacity(n);try{const n=e._vscf_ctr_drbg_random(this.ctxPtr,r,s);t.FoundationError.handleStatusCode(n);const a=e._vsc_buffer_bytes(s),o=e._vsc_buffer_len(s);return e.HEAPU8.slice(a,a+o)}finally{e._vsc_buffer_delete(s)}}reseed(){u.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=e._vscf_ctr_drbg_reseed(this.ctxPtr);t.FoundationError.handleStatusCode(r)}setupDefaults(){u.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=e._vscf_ctr_drbg_setup_defaults(this.ctxPtr);t.FoundationError.handleStatusCode(r)}enablePredictionResistance(){u.ensureNotNull("this.ctxPtr",this.ctxPtr),e._vscf_ctr_drbg_enable_prediction_resistance(this.ctxPtr)}setReseedInterval(t){u.ensureNotNull("this.ctxPtr",this.ctxPtr),u.ensureNumber("interval",t),e._vscf_ctr_drbg_set_reseed_interval(this.ctxPtr,t)}setEntropyLen(t){u.ensureNotNull("this.ctxPtr",this.ctxPtr),u.ensureNumber("len",t),e._vscf_ctr_drbg_set_entropy_len(this.ctxPtr,t)}}return r};const f=_;var d=(e,t)=>{class r{constructor(t){this.name="Hmac",this.ctxPtr=void 0===t?e._vscf_hmac_new():t}static newAndUseCContext(t){return new r(e._vscf_hmac_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscf_hmac_delete(this.ctxPtr),this.ctxPtr=null)}set hash(r){f.ensureNotNull("this.ctxPtr",this.ctxPtr),f.ensureImplementInterface("hash",r,"Foundation.Hash",t.FoundationInterfaceTag.HASH,t.FoundationInterface),e._vscf_hmac_release_hash(this.ctxPtr),e._vscf_hmac_use_hash(this.ctxPtr,r.ctxPtr)}algId(){let t;return f.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscf_hmac_alg_id(this.ctxPtr),t}produceAlgInfo(){let r;f.ensureNotNull("this.ctxPtr",this.ctxPtr),r=e._vscf_hmac_produce_alg_info(this.ctxPtr);return t.FoundationInterface.newAndTakeCContext(r)}restoreAlgInfo(r){f.ensureNotNull("this.ctxPtr",this.ctxPtr),f.ensureImplementInterface("algInfo",r,"Foundation.AlgInfo",t.FoundationInterfaceTag.ALG_INFO,t.FoundationInterface);const n=e._vscf_hmac_restore_alg_info(this.ctxPtr,r.ctxPtr);t.FoundationError.handleStatusCode(n)}digestLen(){let t;return f.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscf_hmac_digest_len(this.ctxPtr),t}mac(t,r){f.ensureNotNull("this.ctxPtr",this.ctxPtr),f.ensureByteArray("key",t),f.ensureByteArray("data",r);const n=t.length*t.BYTES_PER_ELEMENT,s=e._malloc(n);e.HEAP8.set(t,s);const a=e._vsc_data_ctx_size(),o=e._malloc(a);e._vsc_data(o,s,n);const _=r.length*r.BYTES_PER_ELEMENT,i=e._malloc(_);e.HEAP8.set(r,i);const c=e._vsc_data_ctx_size(),u=e._malloc(c);e._vsc_data(u,i,_);const l=this.digestLen(),d=e._vsc_buffer_new_with_capacity(l);try{e._vscf_hmac_mac(this.ctxPtr,o,u,d);const t=e._vsc_buffer_bytes(d),r=e._vsc_buffer_len(d);return e.HEAPU8.slice(t,t+r)}finally{e._free(s),e._free(o),e._free(i),e._free(u),e._vsc_buffer_delete(d)}}start(t){f.ensureNotNull("this.ctxPtr",this.ctxPtr),f.ensureByteArray("key",t);const r=t.length*t.BYTES_PER_ELEMENT,n=e._malloc(r);e.HEAP8.set(t,n);const s=e._vsc_data_ctx_size(),a=e._malloc(s);e._vsc_data(a,n,r);try{e._vscf_hmac_start(this.ctxPtr,a)}finally{e._free(n),e._free(a)}}update(t){f.ensureNotNull("this.ctxPtr",this.ctxPtr),f.ensureByteArray("data",t);const r=t.length*t.BYTES_PER_ELEMENT,n=e._malloc(r);e.HEAP8.set(t,n);const s=e._vsc_data_ctx_size(),a=e._malloc(s);e._vsc_data(a,n,r);try{e._vscf_hmac_update(this.ctxPtr,a)}finally{e._free(n),e._free(a)}}finish(){f.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=this.digestLen(),r=e._vsc_buffer_new_with_capacity(t);try{e._vscf_hmac_finish(this.ctxPtr,r);const t=e._vsc_buffer_bytes(r),n=e._vsc_buffer_len(r);return e.HEAPU8.slice(t,t+n)}finally{e._vsc_buffer_delete(r)}}reset(){f.ensureNotNull("this.ctxPtr",this.ctxPtr),e._vscf_hmac_reset(this.ctxPtr)}}return r};const h=_;var v=(e,t)=>{class r{constructor(t){this.name="Hkdf",this.ctxPtr=void 0===t?e._vscf_hkdf_new():t}static newAndUseCContext(t){return new r(e._vscf_hkdf_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscf_hkdf_delete(this.ctxPtr),this.ctxPtr=null)}set hash(r){h.ensureNotNull("this.ctxPtr",this.ctxPtr),h.ensureImplementInterface("hash",r,"Foundation.Hash",t.FoundationInterfaceTag.HASH,t.FoundationInterface),e._vscf_hkdf_release_hash(this.ctxPtr),e._vscf_hkdf_use_hash(this.ctxPtr,r.ctxPtr)}algId(){let t;return h.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscf_hkdf_alg_id(this.ctxPtr),t}produceAlgInfo(){let r;h.ensureNotNull("this.ctxPtr",this.ctxPtr),r=e._vscf_hkdf_produce_alg_info(this.ctxPtr);return t.FoundationInterface.newAndTakeCContext(r)}restoreAlgInfo(r){h.ensureNotNull("this.ctxPtr",this.ctxPtr),h.ensureImplementInterface("algInfo",r,"Foundation.AlgInfo",t.FoundationInterfaceTag.ALG_INFO,t.FoundationInterface);const n=e._vscf_hkdf_restore_alg_info(this.ctxPtr,r.ctxPtr);t.FoundationError.handleStatusCode(n)}derive(t,r){h.ensureNotNull("this.ctxPtr",this.ctxPtr),h.ensureByteArray("data",t),h.ensureNumber("keyLen",r);const n=t.length*t.BYTES_PER_ELEMENT,s=e._malloc(n);e.HEAP8.set(t,s);const a=e._vsc_data_ctx_size(),o=e._malloc(a);e._vsc_data(o,s,n);const _=r,i=e._vsc_buffer_new_with_capacity(_);try{e._vscf_hkdf_derive(this.ctxPtr,o,r,i);const t=e._vsc_buffer_bytes(i),n=e._vsc_buffer_len(i);return e.HEAPU8.slice(t,t+n)}finally{e._free(s),e._free(o),e._vsc_buffer_delete(i)}}reset(t,r){h.ensureNotNull("this.ctxPtr",this.ctxPtr),h.ensureByteArray("salt",t),h.ensureNumber("iterationCount",r);const n=t.length*t.BYTES_PER_ELEMENT,s=e._malloc(n);e.HEAP8.set(t,s);const a=e._vsc_data_ctx_size(),o=e._malloc(a);e._vsc_data(o,s,n);try{e._vscf_hkdf_reset(this.ctxPtr,o,r)}finally{e._free(s),e._free(o)}}setInfo(t){h.ensureNotNull("this.ctxPtr",this.ctxPtr),h.ensureByteArray("info",t);const r=t.length*t.BYTES_PER_ELEMENT,n=e._malloc(r);e.HEAP8.set(t,n);const s=e._vsc_data_ctx_size(),a=e._malloc(s);e._vsc_data(a,n,r);try{e._vscf_hkdf_set_info(this.ctxPtr,a)}finally{e._free(n),e._free(a)}}}return r};const w=_;var m=(e,t)=>{class r{static get DIGEST_LEN(){return 64}get DIGEST_LEN(){return r.DIGEST_LEN}static get BLOCK_LEN(){return 128}get BLOCK_LEN(){return r.BLOCK_LEN}constructor(t){this.name="Sha512",this.ctxPtr=void 0===t?e._vscf_sha512_new():t}static newAndUseCContext(t){return new r(e._vscf_sha512_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscf_sha512_delete(this.ctxPtr),this.ctxPtr=null)}algId(){let t;return w.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscf_sha512_alg_id(this.ctxPtr),t}produceAlgInfo(){let r;w.ensureNotNull("this.ctxPtr",this.ctxPtr),r=e._vscf_sha512_produce_alg_info(this.ctxPtr);return t.FoundationInterface.newAndTakeCContext(r)}restoreAlgInfo(r){w.ensureNotNull("this.ctxPtr",this.ctxPtr),w.ensureImplementInterface("algInfo",r,"Foundation.AlgInfo",t.FoundationInterfaceTag.ALG_INFO,t.FoundationInterface);const n=e._vscf_sha512_restore_alg_info(this.ctxPtr,r.ctxPtr);t.FoundationError.handleStatusCode(n)}hash(t){w.ensureByteArray("data",t);const r=t.length*t.BYTES_PER_ELEMENT,n=e._malloc(r);e.HEAP8.set(t,n);const s=e._vsc_data_ctx_size(),a=e._malloc(s);e._vsc_data(a,n,r);const o=this.DIGEST_LEN,_=e._vsc_buffer_new_with_capacity(o);try{e._vscf_sha512_hash(a,_);const t=e._vsc_buffer_bytes(_),r=e._vsc_buffer_len(_);return e.HEAPU8.slice(t,t+r)}finally{e._free(n),e._free(a),e._vsc_buffer_delete(_)}}start(){w.ensureNotNull("this.ctxPtr",this.ctxPtr),e._vscf_sha512_start(this.ctxPtr)}update(t){w.ensureNotNull("this.ctxPtr",this.ctxPtr),w.ensureByteArray("data",t);const r=t.length*t.BYTES_PER_ELEMENT,n=e._malloc(r);e.HEAP8.set(t,n);const s=e._vsc_data_ctx_size(),a=e._malloc(s);e._vsc_data(a,n,r);try{e._vscf_sha512_update(this.ctxPtr,a)}finally{e._free(n),e._free(a)}}finish(){w.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=this.DIGEST_LEN,r=e._vsc_buffer_new_with_capacity(t);try{e._vscf_sha512_finish(this.ctxPtr,r);const t=e._vsc_buffer_bytes(r),n=e._vsc_buffer_len(r);return e.HEAPU8.slice(t,t+n)}finally{e._vsc_buffer_delete(r)}}}return r};var p=(e,t)=>{class r extends Error{constructor(e){super(e),this.name="RatchetError",this.message=e}static handleStatusCode(e){if(0!=e){if(-1==e)throw new r("Error during protobuf deserialization.");if(-2==e)throw new r("Bad message type.");if(-3==e)throw new r("AES error.");if(-4==e)throw new r("RNG failed.");if(-5==e)throw new r("Curve25519 error.");if(-6==e)throw new r("Curve25519 error.");if(-7==e)throw new r("Key deserialization failed.");if(-8==e)throw new r("Invalid key type.");if(-9==e)throw new r("Identity key doesn't match.");if(-10==e)throw new r("Message already decrypted.");if(-11==e)throw new r("Too many lost messages.");if(-12==e)throw new r("Sender chain missing.");if(-13==e)throw new r("Skipped message missing.");if(-14==e)throw new r("Session is not initialized.");if(-15==e)throw new r("Exceeded max plain text len.");if(-16==e)throw new r("Too many messages for sender chain.");if(-17==e)throw new r("Too many messages for receiver chain.");if(-18==e)throw new r("Invalid padding.");if(-19==e)throw new r("Too many participants.");if(-20==e)throw new r("Too few participants.");if(-21==e)throw new r("Sender not found.");if(-22==e)throw new r("Cannot decrypt own messages.");if(-23==e)throw new r("Invalid signature.");if(-24==e)throw new r("Cannot remove myself.");if(-25==e)throw new r("Epoch mismatch.");if(-26==e)throw new r("Epoch not found.");if(-27==e)throw new r("Session id mismatch.");if(-28==e)throw new r("Simultaneous group user operation.");if(-29==e)throw new r("Myself is included in info.");if(-30==e)throw new r("Round5 error.");if(-31==e)throw new r("Falcon error.");if(-32==e)throw new r("Decaps signature is invalid.");if(-33==e)throw new r("Error importing round5 key.");throw new r("Unexpected status code:"+e)}}}return r};var b=(e,t)=>Object.freeze({REGULAR:0,PREKEY:1});var y=(e,t)=>Object.freeze({GROUP_INFO:0,REGULAR:1}),E={};function P(e,t){if(!("number"==typeof t||t instanceof Number))throw new TypeError(`'${e}' is not a number`);if(Number.isNaN(t))throw new TypeError(`'${e}' is NaN`);if(t===1/0)throw new TypeError(`'${e}' is Infinity`);if(t===-1/0)throw new TypeError(`'${e}' is -Infinity`)}function g(e,t){if(P(e,t),0==t)throw new TypeError(`'${e}' is NULL`)}E.ensureNumber=P,E.ensureString=function(e,t){if(!("string"==typeof t||t instanceof String))throw new TypeError(`'${e}' is not a string`)},E.ensureBoolean=function(e,t){if("boolean"!=typeof t)throw new TypeError(`'${e}' is not a boolean`)},E.ensureByteArray=function(e,t){if(!(t instanceof Uint8Array))throw new TypeError(`'${e}' is not an Uint8Array`)},E.ensureClass=function(e,t,r){if(!(t instanceof r))throw new TypeError(`'${e}' is not an instance of the class ${r.name}`);g(e,t.ctxPtr)},E.ensureNotNull=g,E.ensureImplementInterface=function(e,t,r,n,s){if(g(e,t.ctxPtr),!s.isImplemented(t.ctxPtr,n))throw new TypeError(`'${e}' does not implement interface '${r}'`)};const I=E;const A=E;const x=r,C=n,T=s,N=a,R=o,S=l,k=d,F=v,L=m,K=p,D=b,O=y,B=(e,t)=>{class r{static get MAX_PLAIN_TEXT_LEN(){return 3e4}get MAX_PLAIN_TEXT_LEN(){return r.MAX_PLAIN_TEXT_LEN}static get MAX_MESSAGE_LEN(){return 35583}get MAX_MESSAGE_LEN(){return r.MAX_MESSAGE_LEN}static get KEY_ID_LEN(){return 8}get KEY_ID_LEN(){return r.KEY_ID_LEN}static get PARTICIPANT_ID_LEN(){return 32}get PARTICIPANT_ID_LEN(){return r.PARTICIPANT_ID_LEN}static get SESSION_ID_LEN(){return 32}get SESSION_ID_LEN(){return r.SESSION_ID_LEN}static get MAX_PARTICIPANTS_COUNT(){return 100}get MAX_PARTICIPANTS_COUNT(){return r.MAX_PARTICIPANTS_COUNT}static get MIN_PARTICIPANTS_COUNT(){return 2}get MIN_PARTICIPANTS_COUNT(){return r.MIN_PARTICIPANTS_COUNT}static get MAX_GROUP_MESSAGE_LEN(){return 32918}get MAX_GROUP_MESSAGE_LEN(){return r.MAX_GROUP_MESSAGE_LEN}}return r},M=(e,t)=>{class r{constructor(t){this.name="RatchetMessage",this.ctxPtr=void 0===t?e._vscr_ratchet_message_new():t}static newAndUseCContext(t){return new r(e._vscr_ratchet_message_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscr_ratchet_message_delete(this.ctxPtr),this.ctxPtr=null)}getType(){let t;return I.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_message_get_type(this.ctxPtr),t}getCounter(){let t;return I.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_message_get_counter(this.ctxPtr),t}getSenderIdentityKeyId(){I.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=e._vsc_data_ctx_size(),r=e._malloc(t);try{e._vscr_ratchet_message_get_sender_identity_key_id(r,this.ctxPtr);const t=e._vsc_data_len(r),n=e._vsc_data_bytes(r);return e.HEAPU8.slice(n,n+t)}finally{e._free(r)}}getReceiverIdentityKeyId(){I.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=e._vsc_data_ctx_size(),r=e._malloc(t);try{e._vscr_ratchet_message_get_receiver_identity_key_id(r,this.ctxPtr);const t=e._vsc_data_len(r),n=e._vsc_data_bytes(r);return e.HEAPU8.slice(n,n+t)}finally{e._free(r)}}getReceiverLongTermKeyId(){I.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=e._vsc_data_ctx_size(),r=e._malloc(t);try{e._vscr_ratchet_message_get_receiver_long_term_key_id(r,this.ctxPtr);const t=e._vsc_data_len(r),n=e._vsc_data_bytes(r);return e.HEAPU8.slice(n,n+t)}finally{e._free(r)}}getReceiverOneTimeKeyId(){I.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=e._vsc_data_ctx_size(),r=e._malloc(t);try{e._vscr_ratchet_message_get_receiver_one_time_key_id(r,this.ctxPtr);const t=e._vsc_data_len(r),n=e._vsc_data_bytes(r);return e.HEAPU8.slice(n,n+t)}finally{e._free(r)}}serializeLen(){let t;return I.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_message_serialize_len(this.ctxPtr),t}serialize(){I.ensureNotNull("this.ctxPtr",this.ctxPtr);const t=this.serializeLen(),r=e._vsc_buffer_new_with_capacity(t);try{e._vscr_ratchet_message_serialize(this.ctxPtr,r);const t=e._vsc_buffer_bytes(r),n=e._vsc_buffer_len(r);return e.HEAPU8.slice(t,t+n)}finally{e._vsc_buffer_delete(r)}}static deserialize(n){I.ensureByteArray("input",n);const s=n.length*n.BYTES_PER_ELEMENT,a=e._malloc(s);e.HEAP8.set(n,a);const o=e._vsc_data_ctx_size(),_=e._malloc(o);e._vsc_data(_,a,s);const i=e._vscr_error_ctx_size(),c=e._malloc(i);let u;e._vscr_error_reset(c);try{u=e._vscr_ratchet_message_deserialize(_,c);const n=e._vscr_error_status(c);t.RatchetError.handleStatusCode(n);return r.newAndTakeCContext(u)}finally{e._free(a),e._free(_),e._free(c)}}}return r},U=(e,t)=>{class r{constructor(t){this.name="RatchetSession",this.ctxPtr=void 0===t?e._vscr_ratchet_session_new():t}static newAndUseCContext(t){return new r(e._vscr_ratchet_session_shallow_copy(t))}static newAndTakeCContext(e){return new r(e)}delete(){void 0!==this.ctxPtr&&null!==this.ctxPtr&&(e._vscr_ratchet_session_delete(this.ctxPtr),this.ctxPtr=null)}set rng(r){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureImplementInterface("rng",r,"Foundation.Random",t.FoundationInterfaceTag.RANDOM,t.FoundationInterface),e._vscr_ratchet_session_release_rng(this.ctxPtr),e._vscr_ratchet_session_use_rng(this.ctxPtr,r.ctxPtr)}setupDefaults(){A.ensureNotNull("this.ctxPtr",this.ctxPtr);const r=e._vscr_ratchet_session_setup_defaults(this.ctxPtr);t.RatchetError.handleStatusCode(r)}initiate(r,n,s,a,o,_,i,c,u){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureImplementInterface("senderIdentityPrivateKey",r,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureByteArray("senderIdentityKeyId",n),A.ensureImplementInterface("receiverIdentityPublicKey",s,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureByteArray("receiverIdentityKeyId",a),A.ensureImplementInterface("receiverLongTermPublicKey",o,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureByteArray("receiverLongTermKeyId",_),A.ensureImplementInterface("receiverOneTimePublicKey",i,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureByteArray("receiverOneTimeKeyId",c),A.ensureBoolean("enablePostQuantum",u);const l=n.length*n.BYTES_PER_ELEMENT,f=e._malloc(l);e.HEAP8.set(n,f);const d=e._vsc_data_ctx_size(),h=e._malloc(d);e._vsc_data(h,f,l);const v=a.length*a.BYTES_PER_ELEMENT,w=e._malloc(v);e.HEAP8.set(a,w);const m=e._vsc_data_ctx_size(),p=e._malloc(m);e._vsc_data(p,w,v);const b=_.length*_.BYTES_PER_ELEMENT,y=e._malloc(b);e.HEAP8.set(_,y);const E=e._vsc_data_ctx_size(),P=e._malloc(E);e._vsc_data(P,y,b);const g=c.length*c.BYTES_PER_ELEMENT,I=e._malloc(g);e.HEAP8.set(c,I);const x=e._vsc_data_ctx_size(),C=e._malloc(x);e._vsc_data(C,I,g);try{const n=e._vscr_ratchet_session_initiate(this.ctxPtr,r.ctxPtr,h,s.ctxPtr,p,o.ctxPtr,P,i.ctxPtr,C,u);t.RatchetError.handleStatusCode(n)}finally{e._free(f),e._free(h),e._free(w),e._free(p),e._free(y),e._free(P),e._free(I),e._free(C)}}initiateNoOneTimeKey(r,n,s,a,o,_,i){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureImplementInterface("senderIdentityPrivateKey",r,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureByteArray("senderIdentityKeyId",n),A.ensureImplementInterface("receiverIdentityPublicKey",s,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureByteArray("receiverIdentityKeyId",a),A.ensureImplementInterface("receiverLongTermPublicKey",o,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureByteArray("receiverLongTermKeyId",_),A.ensureBoolean("enablePostQuantum",i);const c=n.length*n.BYTES_PER_ELEMENT,u=e._malloc(c);e.HEAP8.set(n,u);const l=e._vsc_data_ctx_size(),f=e._malloc(l);e._vsc_data(f,u,c);const d=a.length*a.BYTES_PER_ELEMENT,h=e._malloc(d);e.HEAP8.set(a,h);const v=e._vsc_data_ctx_size(),w=e._malloc(v);e._vsc_data(w,h,d);const m=_.length*_.BYTES_PER_ELEMENT,p=e._malloc(m);e.HEAP8.set(_,p);const b=e._vsc_data_ctx_size(),y=e._malloc(b);e._vsc_data(y,p,m);try{const n=e._vscr_ratchet_session_initiate_no_one_time_key(this.ctxPtr,r.ctxPtr,f,s.ctxPtr,w,o.ctxPtr,y,i);t.RatchetError.handleStatusCode(n)}finally{e._free(u),e._free(f),e._free(h),e._free(w),e._free(p),e._free(y)}}respond(r,n,s,a,o,_){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureImplementInterface("senderIdentityPublicKey",r,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureImplementInterface("receiverIdentityPrivateKey",n,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureImplementInterface("receiverLongTermPrivateKey",s,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureImplementInterface("receiverOneTimePrivateKey",a,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureClass("message",o,t.RatchetMessage),A.ensureBoolean("enablePostQuantum",_);const i=e._vscr_ratchet_session_respond(this.ctxPtr,r.ctxPtr,n.ctxPtr,s.ctxPtr,a.ctxPtr,o.ctxPtr,_);t.RatchetError.handleStatusCode(i)}respondNoOneTimeKey(r,n,s,a,o){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureImplementInterface("senderIdentityPublicKey",r,"Foundation.PublicKey",t.FoundationInterfaceTag.PUBLIC_KEY,t.FoundationInterface),A.ensureImplementInterface("receiverIdentityPrivateKey",n,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureImplementInterface("receiverLongTermPrivateKey",s,"Foundation.PrivateKey",t.FoundationInterfaceTag.PRIVATE_KEY,t.FoundationInterface),A.ensureClass("message",a,t.RatchetMessage),A.ensureBoolean("enablePostQuantum",o);const _=e._vscr_ratchet_session_respond_no_one_time_key(this.ctxPtr,r.ctxPtr,n.ctxPtr,s.ctxPtr,a.ctxPtr,o);t.RatchetError.handleStatusCode(_)}isInitiator(){let t;A.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_session_is_initiator(this.ctxPtr);return!!t}isPqcEnabled(){let t;A.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_session_is_pqc_enabled(this.ctxPtr);return!!t}receivedFirstResponse(){let t;A.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_session_received_first_response(this.ctxPtr);return!!t}receiverHasOneTimePublicKey(){let t;A.ensureNotNull("this.ctxPtr",this.ctxPtr),t=e._vscr_ratchet_session_receiver_has_one_time_public_key(this.ctxPtr);return!!t}encrypt(r){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureByteArray("plainText",r);const n=r.length*r.BYTES_PER_ELEMENT,s=e._malloc(n);e.HEAP8.set(r,s);const a=e._vsc_data_ctx_size(),o=e._malloc(a);e._vsc_data(o,s,n);const _=e._vscr_error_ctx_size(),i=e._malloc(_);let c;e._vscr_error_reset(i);try{c=e._vscr_ratchet_session_encrypt(this.ctxPtr,o,i);const r=e._vscr_error_status(i);t.RatchetError.handleStatusCode(r);return t.RatchetMessage.newAndTakeCContext(c)}finally{e._free(s),e._free(o),e._free(i)}}decryptLen(r){let n;return A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureClass("message",r,t.RatchetMessage),n=e._vscr_ratchet_session_decrypt_len(this.ctxPtr,r.ctxPtr),n}decrypt(r){A.ensureNotNull("this.ctxPtr",this.ctxPtr),A.ensureClass("message",r,t.RatchetMessage);const n=this.decryptLen(r),s=e._vsc_buffer_new_with_capacity(n);try{const n=e._vscr_ratchet_session_decrypt(this.ctxPtr,r.ctxPtr,s);t.RatchetError.handleStatusCode(n);const a=e._vsc_buffer_bytes(s),o=e._vsc_buffer_len(s);return e.HEAPU8.slice(a,a+o)}finally{e._vsc_buffer_delete(s)}}serialize(){let t;A.ensureNotNull("this.ctxPtr",this.ctxPtr);try{t=e._vscr_ratchet_session_serialize(this.ctxPtr);const r=e._vsc_buffer_len(t),n=e._vsc_buffer_bytes(t);return e.HEAPU8.slice(n,n+r)}finally{e._vsc_buffer_delete(t)}}static deserialize(n){A.ensureByteArray("input",n);const s=n.length*n.BYTES_PER_ELEMENT,a=e._malloc(s);e.HEAP8.set(n,a);const o=e._vsc_data_ctx_size(),_=e._malloc(o);e._vsc_data(_,a,s);const i=e._vscr_error_ctx_size(),c=e._malloc(i);let u;e._vscr_error_reset(c);try{u=e._vscr_ratchet_session_deserialize(_,c);const n=e._vscr_error_status(c);t.RatchetError.handleStatusCode(n);return r.newAndTakeCContext(u)}finally{e._free(a),e._free(_),e._free(c)}}}return r};var Y=e((e=>new Promise(((t,r)=>{x(e).then((e=>{const r={};r.FoundationError=C(),r.FoundationInterface=T(e,r),r.FoundationInterfaceTag=N(),r.FoundationImplTag=R(),r.CtrDrbg=S(e,r),r.Hmac=k(e,r),r.Hkdf=F(e,r),r.Sha512=L(e,r),r.RatchetError=K(),r.MsgType=D(),r.GroupMsgType=O(),r.RatchetCommon=B(),r.RatchetMessage=M(e,r),r.RatchetSession=U(e,r),t(r)})).catch((e=>{r(e)}))}))));export{Y as default};
